!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("filesafe-js")):"function"==typeof define&&define.amd?define("EditorKit",["filesafe-js"],t):"object"==typeof exports?exports.EditorKit=t(require("filesafe-js")):e.EditorKit=t(e["filesafe-js"])}(self,(function(__WEBPACK_EXTERNAL_MODULE_filesafe_js__){return(()=>{var __webpack_modules__={"../component-relay/dist/dist.js":module=>{eval('!function(e,t){ true?module.exports=t():0}(self,(function(){return(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};let s,n,i,o;var a;e.d(t,{default:()=>w}),function(e){e.SetSize="set-size",e.StreamItems="stream-items",e.StreamContextItem="stream-context-item",e.SaveItems="save-items",e.SelectItem="select-item",e.AssociateItem="associate-item",e.DeassociateItem="deassociate-item",e.ClearSelection="clear-selection",e.CreateItem="create-item",e.CreateItems="create-items",e.DeleteItems="delete-items",e.SetComponentData="set-component-data",e.InstallLocalComponent="install-local-component",e.ToggleActivateComponent="toggle-activate-component",e.RequestPermissions="request-permissions",e.PresentConflictResolution="present-conflict-resolution",e.DuplicateItem="duplicate-item",e.ComponentRegistered="component-registered",e.ActivateThemes="themes",e.Reply="reply",e.SaveSuccess="save-success",e.SaveError="save-error",e.ThemesActivated="themes-activated",e.KeyDown="key-down",e.KeyUp="key-up",e.Click="click"}(s||(s={})),function(e){e[e.Web=1]="Web",e[e.Desktop=2]="Desktop",e[e.Mobile=3]="Mobile"}(n||(n={})),function(e){e.Any="*",e.Item="SF|Item",e.RootKey="SN|RootKey|NoSync",e.ItemsKey="SN|ItemsKey",e.EncryptedStorage="SN|EncryptedStorage",e.Note="Note",e.Tag="Tag",e.SmartTag="SN|SmartTag",e.Component="SN|Component",e.Editor="SN|Editor",e.ActionsExtension="Extension",e.UserPrefs="SN|UserPreferences",e.HistorySession="SN|HistorySession",e.Theme="SN|Theme",e.Mfa="SF|MFA",e.ServerExtension="SF|Extension",e.FilesafeCredentials="SN|FileSafe|Credentials",e.FilesafeFileMetadata="SN|FileSafe|FileMetadata",e.FilesafeIntegration="SN|FileSafe|Integration",e.ExtensionRepo="SN|ExtensionRepo"}(i||(i={})),function(e){e.Pinned="pinned",e.Archived="archived",e.Locked="locked",e.UserModifiedDate="client_updated_at",e.DefaultEditor="defaultEditor",e.MobileRules="mobileRules",e.NotAvailableOnMobile="notAvailableOnMobile",e.MobileActive="mobileActive",e.LastSize="lastSize",e.PrefersPlainEditor="prefersPlainEditor",e.ComponentInstallError="installError"}(o||(o={}));var r=new Uint8Array(16);function c(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(r)}const m=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=function(e){return"string"==typeof e&&m.test(e)};for(var d=[],h=0;h<256;++h)d.push((h+256).toString(16).substr(1));const p=function(e,t,s){var n=(e=e||{}).random||(e.rng||c)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){s=s||0;for(var i=0;i<16;++i)t[s+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!l(s))throw TypeError("Stringified UUID is invalid");return s}(n)},v=e=>{var t;const s={[n.Web]:"web",[n.Desktop]:"desktop",[n.Mobile]:"mobile"};return null!==(t=s[e])&&void 0!==t?t:s[n.Web]},u=e=>null!=e,g=()=>{};class f{static get isSupported(){return!(!window.console&&!console)}static get info(){return f.isSupported&&this.enabled?console.log.bind(console):g}static get error(){return f.isSupported?console.error.bind(console):g}}var y,S,b,I;function k(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function E(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?k(Object(s),!0).forEach((function(t){C(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):k(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function C(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}(S="enabled")in(y=f)?Object.defineProperty(y,S,{value:false,enumerable:!0,configurable:!0,writable:!0}):y[S]=false,function(e){e.Component="component"}(b||(b={})),function(e){e.Shift="Shift",e.Ctrl="Control",e.Meta="Meta"}(I||(I={}));class w{constructor(e){if(C(this,"contentWindow",void 0),C(this,"initialPermissions",void 0),C(this,"onReadyCallback",void 0),C(this,"component",{activeThemes:[],acceptsThemes:!0}),C(this,"sentMessages",[]),C(this,"messageQueue",[]),C(this,"lastStreamedItem",void 0),C(this,"pendingSaveItems",void 0),C(this,"pendingSaveTimeout",void 0),C(this,"pendingSaveParams",void 0),C(this,"coallesedSaving",!0),C(this,"coallesedSavingDelay",250),C(this,"messageHandler",void 0),C(this,"keyDownEventListener",void 0),C(this,"keyUpEventListener",void 0),C(this,"clickEventListener",void 0),C(this,"onThemesChangeCallback",void 0),!e||!e.targetWindow)throw new Error("contentWindow must be a valid Window object.");this.contentWindow=e.targetWindow,this.processParameters(e),this.registerMessageHandler(),this.registerKeyboardEventListeners(),this.registerMouseEventListeners()}processParameters(e){var t;const{initialPermissions:s,options:n,onReady:i,onThemesChange:o}=e;var a;s&&s.length>0&&(this.initialPermissions=s),u(null==n?void 0:n.coallesedSaving)&&(this.coallesedSaving=n.coallesedSaving),u(null==n?void 0:n.coallesedSavingDelay)&&(this.coallesedSavingDelay=n.coallesedSavingDelay),u(null==n?void 0:n.acceptsThemes)&&(this.component.acceptsThemes=null===(a=null==n?void 0:n.acceptsThemes)||void 0===a||a),u(i)&&(this.onReadyCallback=i),u(o)&&(this.onThemesChangeCallback=o),f.enabled=null!==(t=null==n?void 0:n.debug)&&void 0!==t&&t}deinit(){this.onReadyCallback=void 0,this.component={acceptsThemes:!0,activeThemes:[]},this.messageQueue=[],this.sentMessages=[],this.lastStreamedItem=void 0,this.pendingSaveItems=void 0,this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0,this.messageHandler&&(this.contentWindow.document.removeEventListener("message",this.messageHandler),this.contentWindow.removeEventListener("message",this.messageHandler)),this.keyDownEventListener&&this.contentWindow.removeEventListener("keydown",this.keyDownEventListener),this.keyUpEventListener&&this.contentWindow.removeEventListener("keyup",this.keyUpEventListener),this.clickEventListener&&this.contentWindow.removeEventListener("click",this.clickEventListener)}registerMessageHandler(){this.messageHandler=e=>{if(f.info("Components API Message received:",e.data),document.referrer&&new URL(document.referrer).origin!==new URL(e.origin).origin)return;const{data:t}=e,n=(e=>{if("string"!=typeof e)return!1;try{const t=JSON.parse(e),s=Object.prototype.toString.call(t);return"[object Object]"===s||"[object Array]"===s}catch(e){return!1}})(t)?JSON.parse(t):t;if(n){if(void 0===this.component.origin&&n.action===s.ComponentRegistered)this.component.origin=e.origin;else if(e.origin!==this.component.origin)return;this.handleMessage(n)}else f.error("Invalid data received. Skipping...")},this.contentWindow.document.addEventListener("message",this.messageHandler,!1),this.contentWindow.addEventListener("message",this.messageHandler,!1),f.info("Waiting for messages...")}registerKeyboardEventListeners(){this.keyDownEventListener=e=>{f.info("A key has been pressed: ".concat(e.key)),e.ctrlKey?this.keyDownEvent(I.Ctrl):e.shiftKey?this.keyDownEvent(I.Shift):(e.metaKey||"Meta"===e.key)&&this.keyDownEvent(I.Meta)},this.keyUpEventListener=e=>{f.info("A key has been released: ".concat(e.key)),"Control"===e.key?this.keyUpEvent(I.Ctrl):"Shift"===e.key?this.keyUpEvent(I.Shift):"Meta"===e.key&&this.keyUpEvent(I.Meta)},this.contentWindow.addEventListener("keydown",this.keyDownEventListener,!1),this.contentWindow.addEventListener("keyup",this.keyUpEventListener,!1)}registerMouseEventListeners(){this.clickEventListener=e=>{f.info("A click has been performed."),this.mouseClickEvent()},this.contentWindow.addEventListener("click",this.clickEventListener,!1)}handleMessage(e){switch(e.action){case s.ComponentRegistered:this.component.sessionKey=e.sessionKey,e.componentData&&(this.component.data=e.componentData),this.onReady(e.data),f.info("Component successfully registered with payload:",e);break;case s.ActivateThemes:this.activateThemes(e.data.themes);break;default:{var t,n;if(!e.original)return;const s=null===(t=this.sentMessages)||void 0===t?void 0:t.filter((t=>{var s;return t.messageId===(null===(s=e.original)||void 0===s?void 0:s.messageId)}))[0];if(!s){const e=this.contentWindow.document.title,t=("The extension \'".concat(e,"\' is attempting to communicate with Standard Notes, ")+"but an error is preventing it from doing so. Please restart this extension and try again.").replace("  "," ");return void f.info(t)}null==s||null===(n=s.callback)||void 0===n||n.call(s,e.data);break}}}onReady(e){this.component.environment=e.environment,this.component.platform=e.platform,this.component.uuid=e.uuid,this.initialPermissions&&this.initialPermissions.length>0&&this.requestPermissions(this.initialPermissions);for(const e of this.messageQueue)this.postMessage(e.action,e.data,e.callback);this.messageQueue=[],f.info("Data passed to onReady:",e),this.activateThemes(e.activeThemeUrls||[]),this.postMessage(s.ThemesActivated,{}),this.onReadyCallback&&this.onReadyCallback()}getSelfComponentUUID(){return this.component.uuid}isRunningInDesktopApplication(){return this.component.environment===v(n.Desktop)}isRunningInMobileApplication(){return this.component.environment===v(n.Mobile)}getComponentDataValueForKey(e){if(this.component.data)return this.component.data[e]}setComponentDataValueForKey(e,t){if(!this.component.data)throw new Error("The component has not been initialized.");if(!e||e&&0===e.length)throw new Error("The key for the data value should be a valid string.");this.component.data=E(E({},this.component.data),{},{[e]:t}),this.postMessage(s.SetComponentData,{componentData:this.component.data})}clearComponentData(){this.component.data={},this.postMessage(s.SetComponentData,{componentData:this.component.data})}postMessage(e,t,s){if(!this.component.sessionKey)return void this.messageQueue.push({action:e,data:t,api:b.Component,callback:s});const n={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.component.sessionKey,api:b.Component},i=JSON.parse(JSON.stringify(n));let o;i.callback=s,this.sentMessages.push(i),o=this.isRunningInMobileApplication()?JSON.stringify(n):n,f.info("Posting message:",o),this.contentWindow.parent.postMessage(o,this.component.origin)}requestPermissions(e,t){this.postMessage(s.RequestPermissions,{permissions:e},(()=>{t&&t()}))}activateThemes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.component.acceptsThemes)return;f.info("Incoming themes:",e);const{activeThemes:t}=this.component;if(t&&t.sort().toString()==e.sort().toString())return;let s=e;const n=[];for(const i of t)e.includes(i)?s=s.filter((e=>e!==i)):n.push(i);f.info("Deactivating themes:",n),f.info("Activating themes:",s);for(const e of n)this.deactivateTheme(e);this.component.activeThemes=e;for(const e of s){if(!e)continue;const t=this.contentWindow.document.createElement("link");t.id=btoa(e),t.href=e,t.type="text/css",t.rel="stylesheet",t.media="screen,print",t.className="custom-theme",this.contentWindow.document.getElementsByTagName("head")[0].appendChild(t)}this.onThemesChangeCallback&&this.onThemesChangeCallback()}themeElementForUrl(e){return Array.from(this.contentWindow.document.getElementsByClassName("custom-theme")).slice().find((t=>t.id==btoa(e)))}deactivateTheme(e){const t=this.themeElementForUrl(e);t&&t.parentNode&&(t.setAttribute("disabled","true"),t.parentNode.removeChild(t))}generateUUID(){return p()}get platform(){return this.component.platform}get environment(){return this.component.environment}streamItems(e,t){this.postMessage(s.StreamItems,{content_types:e},(e=>{t(e.items)}))}streamContextItem(e){this.postMessage(s.StreamContextItem,{},(t=>{const{item:s}=t;(!this.lastStreamedItem||this.lastStreamedItem.uuid!==s.uuid)&&this.pendingSaveTimeout&&(clearTimeout(this.pendingSaveTimeout),this._performSavingOfItems(this.pendingSaveParams),this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0),this.lastStreamedItem=s,e(this.lastStreamedItem)}))}selectItem(e){this.postMessage(s.SelectItem,{item:this.jsonObjectForItem(e)})}clearSelection(){this.postMessage(s.ClearSelection,{content_type:i.Tag})}createItem(e,t){this.postMessage(s.CreateItem,{item:this.jsonObjectForItem(e)},(e=>{let{item:s}=e;!s&&e.items&&e.items.length>0&&(s=e.items[0]),this.associateItem(s),t&&t(s)}))}createItems(e,t){const n=e.map((e=>this.jsonObjectForItem(e)));this.postMessage(s.CreateItems,{items:n},(e=>{t&&t(e.items)}))}associateItem(e){this.postMessage(s.AssociateItem,{item:this.jsonObjectForItem(e)})}deassociateItem(e){this.postMessage(s.DeassociateItem,{item:this.jsonObjectForItem(e)})}deleteItem(e,t){this.deleteItems([e],t)}deleteItems(e,t){const n={items:e.map((e=>this.jsonObjectForItem(e)))};this.postMessage(s.DeleteItems,n,(e=>{t&&t(e)}))}sendCustomEvent(e,t,s){this.postMessage(e,t,(e=>{s&&s(e)}))}saveItem(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,s)}saveItemWithPresave(e,t,s){this.saveItemsWithPresave([e],t,s)}saveItemsWithPresave(e,t,s){this.saveItems(e,s,!1,t)}_performSavingOfItems(e){let{items:t,presave:n,callback:i}=e;n&&n();const o=[];for(const e of t)o.push(this.jsonObjectForItem(e));this.postMessage(s.SaveItems,{items:o},(()=>{i&&i()}))}saveItems(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;if(this.pendingSaveItems||(this.pendingSaveItems=[]),this.coallesedSaving&&!s){this.pendingSaveTimeout&&clearTimeout(this.pendingSaveTimeout);const s=e.map((e=>e.uuid)),i=this.pendingSaveItems.filter((e=>!s.includes(e.uuid)));this.pendingSaveItems=i.concat(e),this.pendingSaveParams={items:this.pendingSaveItems,presave:n,callback:t},this.pendingSaveTimeout=setTimeout((()=>{this._performSavingOfItems(this.pendingSaveParams),this.pendingSaveItems=[],this.pendingSaveTimeout=void 0,this.pendingSaveParams=null}),this.coallesedSavingDelay)}else this._performSavingOfItems({items:e,presave:n,callback:t})}setSize(e,t){this.postMessage(s.SetSize,{type:"container",width:e,height:t})}keyDownEvent(e){this.postMessage(s.KeyDown,{keyboardModifier:e})}keyUpEvent(e){this.postMessage(s.KeyUp,{keyboardModifier:e})}mouseClickEvent(){this.postMessage(s.Click,{})}jsonObjectForItem(e){const t=Object.assign({},e);return t.children=null,t.parent=null,t}getItemAppDataValue(e,t){var s,n;return null==e||null===(s=e.content)||void 0===s||null===(n=s.appData)||void 0===n?void 0:n["org.standardnotes.sn"][t]}}return t.default})()}));\n//# sourceMappingURL=dist.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vY29tcG9uZW50LXJlbGF5L2Rpc3QvZGlzdC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL0VkaXRvcktpdC8uLi9jb21wb25lbnQtcmVsYXkvZGlzdC9kaXN0LmpzP2FjZDEiXSwic291cmNlc0NvbnRlbnQiOlsiIWZ1bmN0aW9uKGUsdCl7XCJvYmplY3RcIj09dHlwZW9mIGV4cG9ydHMmJlwib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGU/bW9kdWxlLmV4cG9ydHM9dCgpOlwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoXCJDb21wb25lbnRSZWxheVwiLFtdLHQpOlwib2JqZWN0XCI9PXR5cGVvZiBleHBvcnRzP2V4cG9ydHMuQ29tcG9uZW50UmVsYXk9dCgpOmUuQ29tcG9uZW50UmVsYXk9dCgpfShzZWxmLChmdW5jdGlvbigpe3JldHVybigoKT0+e1widXNlIHN0cmljdFwiO3ZhciBlPXtkOih0LHMpPT57Zm9yKHZhciBuIGluIHMpZS5vKHMsbikmJiFlLm8odCxuKSYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsbix7ZW51bWVyYWJsZTohMCxnZXQ6c1tuXX0pfSxvOihlLHQpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KX0sdD17fTtsZXQgcyxuLGksbzt2YXIgYTtlLmQodCx7ZGVmYXVsdDooKT0+d30pLGZ1bmN0aW9uKGUpe2UuU2V0U2l6ZT1cInNldC1zaXplXCIsZS5TdHJlYW1JdGVtcz1cInN0cmVhbS1pdGVtc1wiLGUuU3RyZWFtQ29udGV4dEl0ZW09XCJzdHJlYW0tY29udGV4dC1pdGVtXCIsZS5TYXZlSXRlbXM9XCJzYXZlLWl0ZW1zXCIsZS5TZWxlY3RJdGVtPVwic2VsZWN0LWl0ZW1cIixlLkFzc29jaWF0ZUl0ZW09XCJhc3NvY2lhdGUtaXRlbVwiLGUuRGVhc3NvY2lhdGVJdGVtPVwiZGVhc3NvY2lhdGUtaXRlbVwiLGUuQ2xlYXJTZWxlY3Rpb249XCJjbGVhci1zZWxlY3Rpb25cIixlLkNyZWF0ZUl0ZW09XCJjcmVhdGUtaXRlbVwiLGUuQ3JlYXRlSXRlbXM9XCJjcmVhdGUtaXRlbXNcIixlLkRlbGV0ZUl0ZW1zPVwiZGVsZXRlLWl0ZW1zXCIsZS5TZXRDb21wb25lbnREYXRhPVwic2V0LWNvbXBvbmVudC1kYXRhXCIsZS5JbnN0YWxsTG9jYWxDb21wb25lbnQ9XCJpbnN0YWxsLWxvY2FsLWNvbXBvbmVudFwiLGUuVG9nZ2xlQWN0aXZhdGVDb21wb25lbnQ9XCJ0b2dnbGUtYWN0aXZhdGUtY29tcG9uZW50XCIsZS5SZXF1ZXN0UGVybWlzc2lvbnM9XCJyZXF1ZXN0LXBlcm1pc3Npb25zXCIsZS5QcmVzZW50Q29uZmxpY3RSZXNvbHV0aW9uPVwicHJlc2VudC1jb25mbGljdC1yZXNvbHV0aW9uXCIsZS5EdXBsaWNhdGVJdGVtPVwiZHVwbGljYXRlLWl0ZW1cIixlLkNvbXBvbmVudFJlZ2lzdGVyZWQ9XCJjb21wb25lbnQtcmVnaXN0ZXJlZFwiLGUuQWN0aXZhdGVUaGVtZXM9XCJ0aGVtZXNcIixlLlJlcGx5PVwicmVwbHlcIixlLlNhdmVTdWNjZXNzPVwic2F2ZS1zdWNjZXNzXCIsZS5TYXZlRXJyb3I9XCJzYXZlLWVycm9yXCIsZS5UaGVtZXNBY3RpdmF0ZWQ9XCJ0aGVtZXMtYWN0aXZhdGVkXCIsZS5LZXlEb3duPVwia2V5LWRvd25cIixlLktleVVwPVwia2V5LXVwXCIsZS5DbGljaz1cImNsaWNrXCJ9KHN8fChzPXt9KSksZnVuY3Rpb24oZSl7ZVtlLldlYj0xXT1cIldlYlwiLGVbZS5EZXNrdG9wPTJdPVwiRGVza3RvcFwiLGVbZS5Nb2JpbGU9M109XCJNb2JpbGVcIn0obnx8KG49e30pKSxmdW5jdGlvbihlKXtlLkFueT1cIipcIixlLkl0ZW09XCJTRnxJdGVtXCIsZS5Sb290S2V5PVwiU058Um9vdEtleXxOb1N5bmNcIixlLkl0ZW1zS2V5PVwiU058SXRlbXNLZXlcIixlLkVuY3J5cHRlZFN0b3JhZ2U9XCJTTnxFbmNyeXB0ZWRTdG9yYWdlXCIsZS5Ob3RlPVwiTm90ZVwiLGUuVGFnPVwiVGFnXCIsZS5TbWFydFRhZz1cIlNOfFNtYXJ0VGFnXCIsZS5Db21wb25lbnQ9XCJTTnxDb21wb25lbnRcIixlLkVkaXRvcj1cIlNOfEVkaXRvclwiLGUuQWN0aW9uc0V4dGVuc2lvbj1cIkV4dGVuc2lvblwiLGUuVXNlclByZWZzPVwiU058VXNlclByZWZlcmVuY2VzXCIsZS5IaXN0b3J5U2Vzc2lvbj1cIlNOfEhpc3RvcnlTZXNzaW9uXCIsZS5UaGVtZT1cIlNOfFRoZW1lXCIsZS5NZmE9XCJTRnxNRkFcIixlLlNlcnZlckV4dGVuc2lvbj1cIlNGfEV4dGVuc2lvblwiLGUuRmlsZXNhZmVDcmVkZW50aWFscz1cIlNOfEZpbGVTYWZlfENyZWRlbnRpYWxzXCIsZS5GaWxlc2FmZUZpbGVNZXRhZGF0YT1cIlNOfEZpbGVTYWZlfEZpbGVNZXRhZGF0YVwiLGUuRmlsZXNhZmVJbnRlZ3JhdGlvbj1cIlNOfEZpbGVTYWZlfEludGVncmF0aW9uXCIsZS5FeHRlbnNpb25SZXBvPVwiU058RXh0ZW5zaW9uUmVwb1wifShpfHwoaT17fSkpLGZ1bmN0aW9uKGUpe2UuUGlubmVkPVwicGlubmVkXCIsZS5BcmNoaXZlZD1cImFyY2hpdmVkXCIsZS5Mb2NrZWQ9XCJsb2NrZWRcIixlLlVzZXJNb2RpZmllZERhdGU9XCJjbGllbnRfdXBkYXRlZF9hdFwiLGUuRGVmYXVsdEVkaXRvcj1cImRlZmF1bHRFZGl0b3JcIixlLk1vYmlsZVJ1bGVzPVwibW9iaWxlUnVsZXNcIixlLk5vdEF2YWlsYWJsZU9uTW9iaWxlPVwibm90QXZhaWxhYmxlT25Nb2JpbGVcIixlLk1vYmlsZUFjdGl2ZT1cIm1vYmlsZUFjdGl2ZVwiLGUuTGFzdFNpemU9XCJsYXN0U2l6ZVwiLGUuUHJlZmVyc1BsYWluRWRpdG9yPVwicHJlZmVyc1BsYWluRWRpdG9yXCIsZS5Db21wb25lbnRJbnN0YWxsRXJyb3I9XCJpbnN0YWxsRXJyb3JcIn0ob3x8KG89e30pKTt2YXIgcj1uZXcgVWludDhBcnJheSgxNik7ZnVuY3Rpb24gYygpe2lmKCFhJiYhKGE9XCJ1bmRlZmluZWRcIiE9dHlwZW9mIGNyeXB0byYmY3J5cHRvLmdldFJhbmRvbVZhbHVlcyYmY3J5cHRvLmdldFJhbmRvbVZhbHVlcy5iaW5kKGNyeXB0byl8fFwidW5kZWZpbmVkXCIhPXR5cGVvZiBtc0NyeXB0byYmXCJmdW5jdGlvblwiPT10eXBlb2YgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzJiZtc0NyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChtc0NyeXB0bykpKXRocm93IG5ldyBFcnJvcihcImNyeXB0by5nZXRSYW5kb21WYWx1ZXMoKSBub3Qgc3VwcG9ydGVkLiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL3V1aWRqcy91dWlkI2dldHJhbmRvbXZhbHVlcy1ub3Qtc3VwcG9ydGVkXCIpO3JldHVybiBhKHIpfWNvbnN0IG09L14oPzpbMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMS01XVswLTlhLWZdezN9LVs4OWFiXVswLTlhLWZdezN9LVswLTlhLWZdezEyfXwwMDAwMDAwMC0wMDAwLTAwMDAtMDAwMC0wMDAwMDAwMDAwMDApJC9pLGw9ZnVuY3Rpb24oZSl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIGUmJm0udGVzdChlKX07Zm9yKHZhciBkPVtdLGg9MDtoPDI1NjsrK2gpZC5wdXNoKChoKzI1NikudG9TdHJpbmcoMTYpLnN1YnN0cigxKSk7Y29uc3QgcD1mdW5jdGlvbihlLHQscyl7dmFyIG49KGU9ZXx8e30pLnJhbmRvbXx8KGUucm5nfHxjKSgpO2lmKG5bNl09MTUmbls2XXw2NCxuWzhdPTYzJm5bOF18MTI4LHQpe3M9c3x8MDtmb3IodmFyIGk9MDtpPDE2OysraSl0W3MraV09bltpXTtyZXR1cm4gdH1yZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjAscz0oZFtlW3QrMF1dK2RbZVt0KzFdXStkW2VbdCsyXV0rZFtlW3QrM11dK1wiLVwiK2RbZVt0KzRdXStkW2VbdCs1XV0rXCItXCIrZFtlW3QrNl1dK2RbZVt0KzddXStcIi1cIitkW2VbdCs4XV0rZFtlW3QrOV1dK1wiLVwiK2RbZVt0KzEwXV0rZFtlW3QrMTFdXStkW2VbdCsxMl1dK2RbZVt0KzEzXV0rZFtlW3QrMTRdXStkW2VbdCsxNV1dKS50b0xvd2VyQ2FzZSgpO2lmKCFsKHMpKXRocm93IFR5cGVFcnJvcihcIlN0cmluZ2lmaWVkIFVVSUQgaXMgaW52YWxpZFwiKTtyZXR1cm4gc30obil9LHY9ZT0+e3ZhciB0O2NvbnN0IHM9e1tuLldlYl06XCJ3ZWJcIixbbi5EZXNrdG9wXTpcImRlc2t0b3BcIixbbi5Nb2JpbGVdOlwibW9iaWxlXCJ9O3JldHVybiBudWxsIT09KHQ9c1tlXSkmJnZvaWQgMCE9PXQ/dDpzW24uV2ViXX0sdT1lPT5udWxsIT1lLGc9KCk9Pnt9O2NsYXNzIGZ7c3RhdGljIGdldCBpc1N1cHBvcnRlZCgpe3JldHVybiEoIXdpbmRvdy5jb25zb2xlJiYhY29uc29sZSl9c3RhdGljIGdldCBpbmZvKCl7cmV0dXJuIGYuaXNTdXBwb3J0ZWQmJnRoaXMuZW5hYmxlZD9jb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpOmd9c3RhdGljIGdldCBlcnJvcigpe3JldHVybiBmLmlzU3VwcG9ydGVkP2NvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKTpnfX12YXIgeSxTLGIsSTtmdW5jdGlvbiBrKGUsdCl7dmFyIHM9T2JqZWN0LmtleXMoZSk7aWYoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyl7dmFyIG49T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTt0JiYobj1uLmZpbHRlcigoZnVuY3Rpb24odCl7cmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZSx0KS5lbnVtZXJhYmxlfSkpKSxzLnB1c2guYXBwbHkocyxuKX1yZXR1cm4gc31mdW5jdGlvbiBFKGUpe2Zvcih2YXIgdD0xO3Q8YXJndW1lbnRzLmxlbmd0aDt0Kyspe3ZhciBzPW51bGwhPWFyZ3VtZW50c1t0XT9hcmd1bWVudHNbdF06e307dCUyP2soT2JqZWN0KHMpLCEwKS5mb3JFYWNoKChmdW5jdGlvbih0KXtDKGUsdCxzW3RdKX0pKTpPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycz9PYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHMpKTprKE9iamVjdChzKSkuZm9yRWFjaCgoZnVuY3Rpb24odCl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCxPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHMsdCkpfSkpfXJldHVybiBlfWZ1bmN0aW9uIEMoZSx0LHMpe3JldHVybiB0IGluIGU/T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6cyxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOmVbdF09cyxlfShTPVwiZW5hYmxlZFwiKWluKHk9Zik/T2JqZWN0LmRlZmluZVByb3BlcnR5KHksUyx7dmFsdWU6ZmFsc2UsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTp5W1NdPWZhbHNlLGZ1bmN0aW9uKGUpe2UuQ29tcG9uZW50PVwiY29tcG9uZW50XCJ9KGJ8fChiPXt9KSksZnVuY3Rpb24oZSl7ZS5TaGlmdD1cIlNoaWZ0XCIsZS5DdHJsPVwiQ29udHJvbFwiLGUuTWV0YT1cIk1ldGFcIn0oSXx8KEk9e30pKTtjbGFzcyB3e2NvbnN0cnVjdG9yKGUpe2lmKEModGhpcyxcImNvbnRlbnRXaW5kb3dcIix2b2lkIDApLEModGhpcyxcImluaXRpYWxQZXJtaXNzaW9uc1wiLHZvaWQgMCksQyh0aGlzLFwib25SZWFkeUNhbGxiYWNrXCIsdm9pZCAwKSxDKHRoaXMsXCJjb21wb25lbnRcIix7YWN0aXZlVGhlbWVzOltdLGFjY2VwdHNUaGVtZXM6ITB9KSxDKHRoaXMsXCJzZW50TWVzc2FnZXNcIixbXSksQyh0aGlzLFwibWVzc2FnZVF1ZXVlXCIsW10pLEModGhpcyxcImxhc3RTdHJlYW1lZEl0ZW1cIix2b2lkIDApLEModGhpcyxcInBlbmRpbmdTYXZlSXRlbXNcIix2b2lkIDApLEModGhpcyxcInBlbmRpbmdTYXZlVGltZW91dFwiLHZvaWQgMCksQyh0aGlzLFwicGVuZGluZ1NhdmVQYXJhbXNcIix2b2lkIDApLEModGhpcyxcImNvYWxsZXNlZFNhdmluZ1wiLCEwKSxDKHRoaXMsXCJjb2FsbGVzZWRTYXZpbmdEZWxheVwiLDI1MCksQyh0aGlzLFwibWVzc2FnZUhhbmRsZXJcIix2b2lkIDApLEModGhpcyxcImtleURvd25FdmVudExpc3RlbmVyXCIsdm9pZCAwKSxDKHRoaXMsXCJrZXlVcEV2ZW50TGlzdGVuZXJcIix2b2lkIDApLEModGhpcyxcImNsaWNrRXZlbnRMaXN0ZW5lclwiLHZvaWQgMCksQyh0aGlzLFwib25UaGVtZXNDaGFuZ2VDYWxsYmFja1wiLHZvaWQgMCksIWV8fCFlLnRhcmdldFdpbmRvdyl0aHJvdyBuZXcgRXJyb3IoXCJjb250ZW50V2luZG93IG11c3QgYmUgYSB2YWxpZCBXaW5kb3cgb2JqZWN0LlwiKTt0aGlzLmNvbnRlbnRXaW5kb3c9ZS50YXJnZXRXaW5kb3csdGhpcy5wcm9jZXNzUGFyYW1ldGVycyhlKSx0aGlzLnJlZ2lzdGVyTWVzc2FnZUhhbmRsZXIoKSx0aGlzLnJlZ2lzdGVyS2V5Ym9hcmRFdmVudExpc3RlbmVycygpLHRoaXMucmVnaXN0ZXJNb3VzZUV2ZW50TGlzdGVuZXJzKCl9cHJvY2Vzc1BhcmFtZXRlcnMoZSl7dmFyIHQ7Y29uc3R7aW5pdGlhbFBlcm1pc3Npb25zOnMsb3B0aW9uczpuLG9uUmVhZHk6aSxvblRoZW1lc0NoYW5nZTpvfT1lO3ZhciBhO3MmJnMubGVuZ3RoPjAmJih0aGlzLmluaXRpYWxQZXJtaXNzaW9ucz1zKSx1KG51bGw9PW4/dm9pZCAwOm4uY29hbGxlc2VkU2F2aW5nKSYmKHRoaXMuY29hbGxlc2VkU2F2aW5nPW4uY29hbGxlc2VkU2F2aW5nKSx1KG51bGw9PW4/dm9pZCAwOm4uY29hbGxlc2VkU2F2aW5nRGVsYXkpJiYodGhpcy5jb2FsbGVzZWRTYXZpbmdEZWxheT1uLmNvYWxsZXNlZFNhdmluZ0RlbGF5KSx1KG51bGw9PW4/dm9pZCAwOm4uYWNjZXB0c1RoZW1lcykmJih0aGlzLmNvbXBvbmVudC5hY2NlcHRzVGhlbWVzPW51bGw9PT0oYT1udWxsPT1uP3ZvaWQgMDpuLmFjY2VwdHNUaGVtZXMpfHx2b2lkIDA9PT1hfHxhKSx1KGkpJiYodGhpcy5vblJlYWR5Q2FsbGJhY2s9aSksdShvKSYmKHRoaXMub25UaGVtZXNDaGFuZ2VDYWxsYmFjaz1vKSxmLmVuYWJsZWQ9bnVsbCE9PSh0PW51bGw9PW4/dm9pZCAwOm4uZGVidWcpJiZ2b2lkIDAhPT10JiZ0fWRlaW5pdCgpe3RoaXMub25SZWFkeUNhbGxiYWNrPXZvaWQgMCx0aGlzLmNvbXBvbmVudD17YWNjZXB0c1RoZW1lczohMCxhY3RpdmVUaGVtZXM6W119LHRoaXMubWVzc2FnZVF1ZXVlPVtdLHRoaXMuc2VudE1lc3NhZ2VzPVtdLHRoaXMubGFzdFN0cmVhbWVkSXRlbT12b2lkIDAsdGhpcy5wZW5kaW5nU2F2ZUl0ZW1zPXZvaWQgMCx0aGlzLnBlbmRpbmdTYXZlVGltZW91dD12b2lkIDAsdGhpcy5wZW5kaW5nU2F2ZVBhcmFtcz12b2lkIDAsdGhpcy5tZXNzYWdlSGFuZGxlciYmKHRoaXMuY29udGVudFdpbmRvdy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLHRoaXMubWVzc2FnZUhhbmRsZXIpLHRoaXMuY29udGVudFdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLHRoaXMubWVzc2FnZUhhbmRsZXIpKSx0aGlzLmtleURvd25FdmVudExpc3RlbmVyJiZ0aGlzLmNvbnRlbnRXaW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIix0aGlzLmtleURvd25FdmVudExpc3RlbmVyKSx0aGlzLmtleVVwRXZlbnRMaXN0ZW5lciYmdGhpcy5jb250ZW50V2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLHRoaXMua2V5VXBFdmVudExpc3RlbmVyKSx0aGlzLmNsaWNrRXZlbnRMaXN0ZW5lciYmdGhpcy5jb250ZW50V2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLHRoaXMuY2xpY2tFdmVudExpc3RlbmVyKX1yZWdpc3Rlck1lc3NhZ2VIYW5kbGVyKCl7dGhpcy5tZXNzYWdlSGFuZGxlcj1lPT57aWYoZi5pbmZvKFwiQ29tcG9uZW50cyBBUEkgTWVzc2FnZSByZWNlaXZlZDpcIixlLmRhdGEpLGRvY3VtZW50LnJlZmVycmVyJiZuZXcgVVJMKGRvY3VtZW50LnJlZmVycmVyKS5vcmlnaW4hPT1uZXcgVVJMKGUub3JpZ2luKS5vcmlnaW4pcmV0dXJuO2NvbnN0e2RhdGE6dH09ZSxuPShlPT57aWYoXCJzdHJpbmdcIiE9dHlwZW9mIGUpcmV0dXJuITE7dHJ5e2NvbnN0IHQ9SlNPTi5wYXJzZShlKSxzPU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0KTtyZXR1cm5cIltvYmplY3QgT2JqZWN0XVwiPT09c3x8XCJbb2JqZWN0IEFycmF5XVwiPT09c31jYXRjaChlKXtyZXR1cm4hMX19KSh0KT9KU09OLnBhcnNlKHQpOnQ7aWYobil7aWYodm9pZCAwPT09dGhpcy5jb21wb25lbnQub3JpZ2luJiZuLmFjdGlvbj09PXMuQ29tcG9uZW50UmVnaXN0ZXJlZCl0aGlzLmNvbXBvbmVudC5vcmlnaW49ZS5vcmlnaW47ZWxzZSBpZihlLm9yaWdpbiE9PXRoaXMuY29tcG9uZW50Lm9yaWdpbilyZXR1cm47dGhpcy5oYW5kbGVNZXNzYWdlKG4pfWVsc2UgZi5lcnJvcihcIkludmFsaWQgZGF0YSByZWNlaXZlZC4gU2tpcHBpbmcuLi5cIil9LHRoaXMuY29udGVudFdpbmRvdy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLHRoaXMubWVzc2FnZUhhbmRsZXIsITEpLHRoaXMuY29udGVudFdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLHRoaXMubWVzc2FnZUhhbmRsZXIsITEpLGYuaW5mbyhcIldhaXRpbmcgZm9yIG1lc3NhZ2VzLi4uXCIpfXJlZ2lzdGVyS2V5Ym9hcmRFdmVudExpc3RlbmVycygpe3RoaXMua2V5RG93bkV2ZW50TGlzdGVuZXI9ZT0+e2YuaW5mbyhcIkEga2V5IGhhcyBiZWVuIHByZXNzZWQ6IFwiLmNvbmNhdChlLmtleSkpLGUuY3RybEtleT90aGlzLmtleURvd25FdmVudChJLkN0cmwpOmUuc2hpZnRLZXk/dGhpcy5rZXlEb3duRXZlbnQoSS5TaGlmdCk6KGUubWV0YUtleXx8XCJNZXRhXCI9PT1lLmtleSkmJnRoaXMua2V5RG93bkV2ZW50KEkuTWV0YSl9LHRoaXMua2V5VXBFdmVudExpc3RlbmVyPWU9PntmLmluZm8oXCJBIGtleSBoYXMgYmVlbiByZWxlYXNlZDogXCIuY29uY2F0KGUua2V5KSksXCJDb250cm9sXCI9PT1lLmtleT90aGlzLmtleVVwRXZlbnQoSS5DdHJsKTpcIlNoaWZ0XCI9PT1lLmtleT90aGlzLmtleVVwRXZlbnQoSS5TaGlmdCk6XCJNZXRhXCI9PT1lLmtleSYmdGhpcy5rZXlVcEV2ZW50KEkuTWV0YSl9LHRoaXMuY29udGVudFdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLHRoaXMua2V5RG93bkV2ZW50TGlzdGVuZXIsITEpLHRoaXMuY29udGVudFdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIix0aGlzLmtleVVwRXZlbnRMaXN0ZW5lciwhMSl9cmVnaXN0ZXJNb3VzZUV2ZW50TGlzdGVuZXJzKCl7dGhpcy5jbGlja0V2ZW50TGlzdGVuZXI9ZT0+e2YuaW5mbyhcIkEgY2xpY2sgaGFzIGJlZW4gcGVyZm9ybWVkLlwiKSx0aGlzLm1vdXNlQ2xpY2tFdmVudCgpfSx0aGlzLmNvbnRlbnRXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsdGhpcy5jbGlja0V2ZW50TGlzdGVuZXIsITEpfWhhbmRsZU1lc3NhZ2UoZSl7c3dpdGNoKGUuYWN0aW9uKXtjYXNlIHMuQ29tcG9uZW50UmVnaXN0ZXJlZDp0aGlzLmNvbXBvbmVudC5zZXNzaW9uS2V5PWUuc2Vzc2lvbktleSxlLmNvbXBvbmVudERhdGEmJih0aGlzLmNvbXBvbmVudC5kYXRhPWUuY29tcG9uZW50RGF0YSksdGhpcy5vblJlYWR5KGUuZGF0YSksZi5pbmZvKFwiQ29tcG9uZW50IHN1Y2Nlc3NmdWxseSByZWdpc3RlcmVkIHdpdGggcGF5bG9hZDpcIixlKTticmVhaztjYXNlIHMuQWN0aXZhdGVUaGVtZXM6dGhpcy5hY3RpdmF0ZVRoZW1lcyhlLmRhdGEudGhlbWVzKTticmVhaztkZWZhdWx0Ont2YXIgdCxuO2lmKCFlLm9yaWdpbmFsKXJldHVybjtjb25zdCBzPW51bGw9PT0odD10aGlzLnNlbnRNZXNzYWdlcyl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuZmlsdGVyKCh0PT57dmFyIHM7cmV0dXJuIHQubWVzc2FnZUlkPT09KG51bGw9PT0ocz1lLm9yaWdpbmFsKXx8dm9pZCAwPT09cz92b2lkIDA6cy5tZXNzYWdlSWQpfSkpWzBdO2lmKCFzKXtjb25zdCBlPXRoaXMuY29udGVudFdpbmRvdy5kb2N1bWVudC50aXRsZSx0PShcIlRoZSBleHRlbnNpb24gJ1wiLmNvbmNhdChlLFwiJyBpcyBhdHRlbXB0aW5nIHRvIGNvbW11bmljYXRlIHdpdGggU3RhbmRhcmQgTm90ZXMsIFwiKStcImJ1dCBhbiBlcnJvciBpcyBwcmV2ZW50aW5nIGl0IGZyb20gZG9pbmcgc28uIFBsZWFzZSByZXN0YXJ0IHRoaXMgZXh0ZW5zaW9uIGFuZCB0cnkgYWdhaW4uXCIpLnJlcGxhY2UoXCIgIFwiLFwiIFwiKTtyZXR1cm4gdm9pZCBmLmluZm8odCl9bnVsbD09c3x8bnVsbD09PShuPXMuY2FsbGJhY2spfHx2b2lkIDA9PT1ufHxuLmNhbGwocyxlLmRhdGEpO2JyZWFrfX19b25SZWFkeShlKXt0aGlzLmNvbXBvbmVudC5lbnZpcm9ubWVudD1lLmVudmlyb25tZW50LHRoaXMuY29tcG9uZW50LnBsYXRmb3JtPWUucGxhdGZvcm0sdGhpcy5jb21wb25lbnQudXVpZD1lLnV1aWQsdGhpcy5pbml0aWFsUGVybWlzc2lvbnMmJnRoaXMuaW5pdGlhbFBlcm1pc3Npb25zLmxlbmd0aD4wJiZ0aGlzLnJlcXVlc3RQZXJtaXNzaW9ucyh0aGlzLmluaXRpYWxQZXJtaXNzaW9ucyk7Zm9yKGNvbnN0IGUgb2YgdGhpcy5tZXNzYWdlUXVldWUpdGhpcy5wb3N0TWVzc2FnZShlLmFjdGlvbixlLmRhdGEsZS5jYWxsYmFjayk7dGhpcy5tZXNzYWdlUXVldWU9W10sZi5pbmZvKFwiRGF0YSBwYXNzZWQgdG8gb25SZWFkeTpcIixlKSx0aGlzLmFjdGl2YXRlVGhlbWVzKGUuYWN0aXZlVGhlbWVVcmxzfHxbXSksdGhpcy5wb3N0TWVzc2FnZShzLlRoZW1lc0FjdGl2YXRlZCx7fSksdGhpcy5vblJlYWR5Q2FsbGJhY2smJnRoaXMub25SZWFkeUNhbGxiYWNrKCl9Z2V0U2VsZkNvbXBvbmVudFVVSUQoKXtyZXR1cm4gdGhpcy5jb21wb25lbnQudXVpZH1pc1J1bm5pbmdJbkRlc2t0b3BBcHBsaWNhdGlvbigpe3JldHVybiB0aGlzLmNvbXBvbmVudC5lbnZpcm9ubWVudD09PXYobi5EZXNrdG9wKX1pc1J1bm5pbmdJbk1vYmlsZUFwcGxpY2F0aW9uKCl7cmV0dXJuIHRoaXMuY29tcG9uZW50LmVudmlyb25tZW50PT09dihuLk1vYmlsZSl9Z2V0Q29tcG9uZW50RGF0YVZhbHVlRm9yS2V5KGUpe2lmKHRoaXMuY29tcG9uZW50LmRhdGEpcmV0dXJuIHRoaXMuY29tcG9uZW50LmRhdGFbZV19c2V0Q29tcG9uZW50RGF0YVZhbHVlRm9yS2V5KGUsdCl7aWYoIXRoaXMuY29tcG9uZW50LmRhdGEpdGhyb3cgbmV3IEVycm9yKFwiVGhlIGNvbXBvbmVudCBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQuXCIpO2lmKCFlfHxlJiYwPT09ZS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKFwiVGhlIGtleSBmb3IgdGhlIGRhdGEgdmFsdWUgc2hvdWxkIGJlIGEgdmFsaWQgc3RyaW5nLlwiKTt0aGlzLmNvbXBvbmVudC5kYXRhPUUoRSh7fSx0aGlzLmNvbXBvbmVudC5kYXRhKSx7fSx7W2VdOnR9KSx0aGlzLnBvc3RNZXNzYWdlKHMuU2V0Q29tcG9uZW50RGF0YSx7Y29tcG9uZW50RGF0YTp0aGlzLmNvbXBvbmVudC5kYXRhfSl9Y2xlYXJDb21wb25lbnREYXRhKCl7dGhpcy5jb21wb25lbnQuZGF0YT17fSx0aGlzLnBvc3RNZXNzYWdlKHMuU2V0Q29tcG9uZW50RGF0YSx7Y29tcG9uZW50RGF0YTp0aGlzLmNvbXBvbmVudC5kYXRhfSl9cG9zdE1lc3NhZ2UoZSx0LHMpe2lmKCF0aGlzLmNvbXBvbmVudC5zZXNzaW9uS2V5KXJldHVybiB2b2lkIHRoaXMubWVzc2FnZVF1ZXVlLnB1c2goe2FjdGlvbjplLGRhdGE6dCxhcGk6Yi5Db21wb25lbnQsY2FsbGJhY2s6c30pO2NvbnN0IG49e2FjdGlvbjplLGRhdGE6dCxtZXNzYWdlSWQ6dGhpcy5nZW5lcmF0ZVVVSUQoKSxzZXNzaW9uS2V5OnRoaXMuY29tcG9uZW50LnNlc3Npb25LZXksYXBpOmIuQ29tcG9uZW50fSxpPUpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobikpO2xldCBvO2kuY2FsbGJhY2s9cyx0aGlzLnNlbnRNZXNzYWdlcy5wdXNoKGkpLG89dGhpcy5pc1J1bm5pbmdJbk1vYmlsZUFwcGxpY2F0aW9uKCk/SlNPTi5zdHJpbmdpZnkobik6bixmLmluZm8oXCJQb3N0aW5nIG1lc3NhZ2U6XCIsbyksdGhpcy5jb250ZW50V2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShvLHRoaXMuY29tcG9uZW50Lm9yaWdpbil9cmVxdWVzdFBlcm1pc3Npb25zKGUsdCl7dGhpcy5wb3N0TWVzc2FnZShzLlJlcXVlc3RQZXJtaXNzaW9ucyx7cGVybWlzc2lvbnM6ZX0sKCgpPT57dCYmdCgpfSkpfWFjdGl2YXRlVGhlbWVzKCl7bGV0IGU9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOltdO2lmKCF0aGlzLmNvbXBvbmVudC5hY2NlcHRzVGhlbWVzKXJldHVybjtmLmluZm8oXCJJbmNvbWluZyB0aGVtZXM6XCIsZSk7Y29uc3R7YWN0aXZlVGhlbWVzOnR9PXRoaXMuY29tcG9uZW50O2lmKHQmJnQuc29ydCgpLnRvU3RyaW5nKCk9PWUuc29ydCgpLnRvU3RyaW5nKCkpcmV0dXJuO2xldCBzPWU7Y29uc3Qgbj1bXTtmb3IoY29uc3QgaSBvZiB0KWUuaW5jbHVkZXMoaSk/cz1zLmZpbHRlcigoZT0+ZSE9PWkpKTpuLnB1c2goaSk7Zi5pbmZvKFwiRGVhY3RpdmF0aW5nIHRoZW1lczpcIixuKSxmLmluZm8oXCJBY3RpdmF0aW5nIHRoZW1lczpcIixzKTtmb3IoY29uc3QgZSBvZiBuKXRoaXMuZGVhY3RpdmF0ZVRoZW1lKGUpO3RoaXMuY29tcG9uZW50LmFjdGl2ZVRoZW1lcz1lO2Zvcihjb25zdCBlIG9mIHMpe2lmKCFlKWNvbnRpbnVlO2NvbnN0IHQ9dGhpcy5jb250ZW50V2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaW5rXCIpO3QuaWQ9YnRvYShlKSx0LmhyZWY9ZSx0LnR5cGU9XCJ0ZXh0L2Nzc1wiLHQucmVsPVwic3R5bGVzaGVldFwiLHQubWVkaWE9XCJzY3JlZW4scHJpbnRcIix0LmNsYXNzTmFtZT1cImN1c3RvbS10aGVtZVwiLHRoaXMuY29udGVudFdpbmRvdy5kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQodCl9dGhpcy5vblRoZW1lc0NoYW5nZUNhbGxiYWNrJiZ0aGlzLm9uVGhlbWVzQ2hhbmdlQ2FsbGJhY2soKX10aGVtZUVsZW1lbnRGb3JVcmwoZSl7cmV0dXJuIEFycmF5LmZyb20odGhpcy5jb250ZW50V2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJjdXN0b20tdGhlbWVcIikpLnNsaWNlKCkuZmluZCgodD0+dC5pZD09YnRvYShlKSkpfWRlYWN0aXZhdGVUaGVtZShlKXtjb25zdCB0PXRoaXMudGhlbWVFbGVtZW50Rm9yVXJsKGUpO3QmJnQucGFyZW50Tm9kZSYmKHQuc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIixcInRydWVcIiksdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHQpKX1nZW5lcmF0ZVVVSUQoKXtyZXR1cm4gcCgpfWdldCBwbGF0Zm9ybSgpe3JldHVybiB0aGlzLmNvbXBvbmVudC5wbGF0Zm9ybX1nZXQgZW52aXJvbm1lbnQoKXtyZXR1cm4gdGhpcy5jb21wb25lbnQuZW52aXJvbm1lbnR9c3RyZWFtSXRlbXMoZSx0KXt0aGlzLnBvc3RNZXNzYWdlKHMuU3RyZWFtSXRlbXMse2NvbnRlbnRfdHlwZXM6ZX0sKGU9Pnt0KGUuaXRlbXMpfSkpfXN0cmVhbUNvbnRleHRJdGVtKGUpe3RoaXMucG9zdE1lc3NhZ2Uocy5TdHJlYW1Db250ZXh0SXRlbSx7fSwodD0+e2NvbnN0e2l0ZW06c309dDsoIXRoaXMubGFzdFN0cmVhbWVkSXRlbXx8dGhpcy5sYXN0U3RyZWFtZWRJdGVtLnV1aWQhPT1zLnV1aWQpJiZ0aGlzLnBlbmRpbmdTYXZlVGltZW91dCYmKGNsZWFyVGltZW91dCh0aGlzLnBlbmRpbmdTYXZlVGltZW91dCksdGhpcy5fcGVyZm9ybVNhdmluZ09mSXRlbXModGhpcy5wZW5kaW5nU2F2ZVBhcmFtcyksdGhpcy5wZW5kaW5nU2F2ZVRpbWVvdXQ9dm9pZCAwLHRoaXMucGVuZGluZ1NhdmVQYXJhbXM9dm9pZCAwKSx0aGlzLmxhc3RTdHJlYW1lZEl0ZW09cyxlKHRoaXMubGFzdFN0cmVhbWVkSXRlbSl9KSl9c2VsZWN0SXRlbShlKXt0aGlzLnBvc3RNZXNzYWdlKHMuU2VsZWN0SXRlbSx7aXRlbTp0aGlzLmpzb25PYmplY3RGb3JJdGVtKGUpfSl9Y2xlYXJTZWxlY3Rpb24oKXt0aGlzLnBvc3RNZXNzYWdlKHMuQ2xlYXJTZWxlY3Rpb24se2NvbnRlbnRfdHlwZTppLlRhZ30pfWNyZWF0ZUl0ZW0oZSx0KXt0aGlzLnBvc3RNZXNzYWdlKHMuQ3JlYXRlSXRlbSx7aXRlbTp0aGlzLmpzb25PYmplY3RGb3JJdGVtKGUpfSwoZT0+e2xldHtpdGVtOnN9PWU7IXMmJmUuaXRlbXMmJmUuaXRlbXMubGVuZ3RoPjAmJihzPWUuaXRlbXNbMF0pLHRoaXMuYXNzb2NpYXRlSXRlbShzKSx0JiZ0KHMpfSkpfWNyZWF0ZUl0ZW1zKGUsdCl7Y29uc3Qgbj1lLm1hcCgoZT0+dGhpcy5qc29uT2JqZWN0Rm9ySXRlbShlKSkpO3RoaXMucG9zdE1lc3NhZ2Uocy5DcmVhdGVJdGVtcyx7aXRlbXM6bn0sKGU9Pnt0JiZ0KGUuaXRlbXMpfSkpfWFzc29jaWF0ZUl0ZW0oZSl7dGhpcy5wb3N0TWVzc2FnZShzLkFzc29jaWF0ZUl0ZW0se2l0ZW06dGhpcy5qc29uT2JqZWN0Rm9ySXRlbShlKX0pfWRlYXNzb2NpYXRlSXRlbShlKXt0aGlzLnBvc3RNZXNzYWdlKHMuRGVhc3NvY2lhdGVJdGVtLHtpdGVtOnRoaXMuanNvbk9iamVjdEZvckl0ZW0oZSl9KX1kZWxldGVJdGVtKGUsdCl7dGhpcy5kZWxldGVJdGVtcyhbZV0sdCl9ZGVsZXRlSXRlbXMoZSx0KXtjb25zdCBuPXtpdGVtczplLm1hcCgoZT0+dGhpcy5qc29uT2JqZWN0Rm9ySXRlbShlKSkpfTt0aGlzLnBvc3RNZXNzYWdlKHMuRGVsZXRlSXRlbXMsbiwoZT0+e3QmJnQoZSl9KSl9c2VuZEN1c3RvbUV2ZW50KGUsdCxzKXt0aGlzLnBvc3RNZXNzYWdlKGUsdCwoZT0+e3MmJnMoZSl9KSl9c2F2ZUl0ZW0oZSx0KXtsZXQgcz1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXSYmYXJndW1lbnRzWzJdO3RoaXMuc2F2ZUl0ZW1zKFtlXSx0LHMpfXNhdmVJdGVtV2l0aFByZXNhdmUoZSx0LHMpe3RoaXMuc2F2ZUl0ZW1zV2l0aFByZXNhdmUoW2VdLHQscyl9c2F2ZUl0ZW1zV2l0aFByZXNhdmUoZSx0LHMpe3RoaXMuc2F2ZUl0ZW1zKGUscywhMSx0KX1fcGVyZm9ybVNhdmluZ09mSXRlbXMoZSl7bGV0e2l0ZW1zOnQscHJlc2F2ZTpuLGNhbGxiYWNrOml9PWU7biYmbigpO2NvbnN0IG89W107Zm9yKGNvbnN0IGUgb2YgdClvLnB1c2godGhpcy5qc29uT2JqZWN0Rm9ySXRlbShlKSk7dGhpcy5wb3N0TWVzc2FnZShzLlNhdmVJdGVtcyx7aXRlbXM6b30sKCgpPT57aSYmaSgpfSkpfXNhdmVJdGVtcyhlLHQpe2xldCBzPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdJiZhcmd1bWVudHNbMl0sbj1hcmd1bWVudHMubGVuZ3RoPjM/YXJndW1lbnRzWzNdOnZvaWQgMDtpZih0aGlzLnBlbmRpbmdTYXZlSXRlbXN8fCh0aGlzLnBlbmRpbmdTYXZlSXRlbXM9W10pLHRoaXMuY29hbGxlc2VkU2F2aW5nJiYhcyl7dGhpcy5wZW5kaW5nU2F2ZVRpbWVvdXQmJmNsZWFyVGltZW91dCh0aGlzLnBlbmRpbmdTYXZlVGltZW91dCk7Y29uc3Qgcz1lLm1hcCgoZT0+ZS51dWlkKSksaT10aGlzLnBlbmRpbmdTYXZlSXRlbXMuZmlsdGVyKChlPT4hcy5pbmNsdWRlcyhlLnV1aWQpKSk7dGhpcy5wZW5kaW5nU2F2ZUl0ZW1zPWkuY29uY2F0KGUpLHRoaXMucGVuZGluZ1NhdmVQYXJhbXM9e2l0ZW1zOnRoaXMucGVuZGluZ1NhdmVJdGVtcyxwcmVzYXZlOm4sY2FsbGJhY2s6dH0sdGhpcy5wZW5kaW5nU2F2ZVRpbWVvdXQ9c2V0VGltZW91dCgoKCk9Pnt0aGlzLl9wZXJmb3JtU2F2aW5nT2ZJdGVtcyh0aGlzLnBlbmRpbmdTYXZlUGFyYW1zKSx0aGlzLnBlbmRpbmdTYXZlSXRlbXM9W10sdGhpcy5wZW5kaW5nU2F2ZVRpbWVvdXQ9dm9pZCAwLHRoaXMucGVuZGluZ1NhdmVQYXJhbXM9bnVsbH0pLHRoaXMuY29hbGxlc2VkU2F2aW5nRGVsYXkpfWVsc2UgdGhpcy5fcGVyZm9ybVNhdmluZ09mSXRlbXMoe2l0ZW1zOmUscHJlc2F2ZTpuLGNhbGxiYWNrOnR9KX1zZXRTaXplKGUsdCl7dGhpcy5wb3N0TWVzc2FnZShzLlNldFNpemUse3R5cGU6XCJjb250YWluZXJcIix3aWR0aDplLGhlaWdodDp0fSl9a2V5RG93bkV2ZW50KGUpe3RoaXMucG9zdE1lc3NhZ2Uocy5LZXlEb3duLHtrZXlib2FyZE1vZGlmaWVyOmV9KX1rZXlVcEV2ZW50KGUpe3RoaXMucG9zdE1lc3NhZ2Uocy5LZXlVcCx7a2V5Ym9hcmRNb2RpZmllcjplfSl9bW91c2VDbGlja0V2ZW50KCl7dGhpcy5wb3N0TWVzc2FnZShzLkNsaWNrLHt9KX1qc29uT2JqZWN0Rm9ySXRlbShlKXtjb25zdCB0PU9iamVjdC5hc3NpZ24oe30sZSk7cmV0dXJuIHQuY2hpbGRyZW49bnVsbCx0LnBhcmVudD1udWxsLHR9Z2V0SXRlbUFwcERhdGFWYWx1ZShlLHQpe3ZhciBzLG47cmV0dXJuIG51bGw9PWV8fG51bGw9PT0ocz1lLmNvbnRlbnQpfHx2b2lkIDA9PT1zfHxudWxsPT09KG49cy5hcHBEYXRhKXx8dm9pZCAwPT09bj92b2lkIDA6bltcIm9yZy5zdGFuZGFyZG5vdGVzLnNuXCJdW3RdfX1yZXR1cm4gdC5kZWZhdWx0fSkoKX0pKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRpc3QuanMubWFwIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../component-relay/dist/dist.js\n')},"./src/editorKit.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (/* binding */ EditorKitBase)\n/* harmony export */ });\n/* harmony import */ var _standardnotes_component_relay__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @standardnotes/component-relay */ "../component-relay/dist/dist.js");\n/* harmony import */ var _standardnotes_component_relay__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_standardnotes_component_relay__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _fileLoader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fileLoader */ "./src/fileLoader.ts");\n/* harmony import */ var _textExpander__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./textExpander */ "./src/textExpander.ts");\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils */ "./src/utils.ts");\n/* harmony import */ var _fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./fileSafeHtml */ "./src/fileSafeHtml.ts");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\n\n\n\n\nvar EditorKitMode;\n\n(function (EditorKitMode) {\n  EditorKitMode["PlainText"] = "plaintext";\n  EditorKitMode["Html"] = "html";\n  EditorKitMode["Markdown"] = "markdown";\n  EditorKitMode["Json"] = "json";\n})(EditorKitMode || (EditorKitMode = {}));\n\nclass EditorKitBase {\n  constructor(delegate, options) {\n    this.delegate = delegate;\n    this.options = options;\n\n    _defineProperty(this, "fileIdsPendingAssociation", []);\n\n    _defineProperty(this, "componentRelay", void 0);\n\n    _defineProperty(this, "fileLoader", void 0);\n\n    _defineProperty(this, "textExpander", void 0);\n\n    _defineProperty(this, "fileSafeLoading", void 0);\n\n    _defineProperty(this, "fileSafeClass", void 0);\n\n    _defineProperty(this, "fileSafeInstance", void 0);\n\n    _defineProperty(this, "note", void 0);\n\n    _defineProperty(this, "ignoreNextTextChange", void 0);\n\n    _defineProperty(this, "needsFileSafeElementLoad", void 0);\n\n    _defineProperty(this, "previousText", void 0);\n\n    this.connectToBridge();\n\n    if (this.options.supportsFileSafe) {\n      this.fileSafeLoading = this.importFileSafe();\n    }\n  }\n\n  connectToBridge() {\n    const {\n      coallesedSaving,\n      coallesedSavingDelay,\n      mode,\n      supportsFileSafe\n    } = this.options;\n    this.componentRelay = new (_standardnotes_component_relay__WEBPACK_IMPORTED_MODULE_0___default())({\n      targetWindow: window,\n      options: {\n        coallesedSaving,\n\n        /**\n         * The editor does some debouncing for us, so we\'ll lower the\n         * default debounce value from 250 to 150\n         */\n        coallesedSavingDelay\n      },\n      onReady: () => {\n        const {\n          platform\n        } = this.componentRelay;\n\n        if (platform) {\n          document.documentElement.classList.add(platform);\n        }\n      },\n      onThemesChange: this.delegate.onThemesChange\n    });\n    this.componentRelay.streamContextItem(async note => {\n      /**\n       * TODO: If note has changed, release previous temp object URLs.\n       */\n      let isNewNoteLoad = true;\n\n      if (this.note && this.note.uuid == note.uuid) {\n        isNewNoteLoad = false;\n      }\n\n      const previousNote = this.note;\n\n      if (supportsFileSafe) {\n        const itemClass = this.fileSafeClass.getSFItemClass();\n        this.note = new itemClass(note);\n        this.fileSafeInstance.setCurrentNote(this.note);\n      } else {\n        this.note = note;\n      } // Only update UI on non-metadata updates.\n\n\n      if (note.isMetadataUpdate) {\n        return;\n      }\n\n      let text = note.content.text;\n      /**\n       * If we\'re an HTML editor, and we\'re dealing with a new note,\n       * check to see if it\'s in html format.\n       * If it\'s not, we don\'t want to convert it to HTML until the user makes an explicit change\n       * so we\'ll ignore the next change event in this case.\n       */\n\n      if (mode === EditorKitMode.Html && isNewNoteLoad) {\n        const isHtml = /<[a-z][\\s\\S]*>/i.test(text);\n\n        if (!isHtml) {\n          this.ignoreNextTextChange = true;\n        }\n      }\n      /**\n       * Set before expanding. \n       * We want this value to always be the collapsed value\n       */\n\n\n      this.previousText = text;\n\n      if (supportsFileSafe) {\n        /**\n         * We want to expand any filesafe syntax in the text,\n         * but only after the text has been inserted.\n         * (Will be checked on editor change callback)\n         */\n        this.needsFileSafeElementLoad = true;\n        text = (0,_fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__.expandedFileSafeSyntax)(text);\n      }\n\n      this.delegate.onNoteValueChange && (await this.delegate.onNoteValueChange(note));\n      this.delegate.setEditorRawText(text);\n\n      if (this.delegate.onNoteLockToggle) {\n        var _getItemAppDataValue, _getItemAppDataValue2;\n\n        const previousLockState = (_getItemAppDataValue = this.componentRelay.getItemAppDataValue(previousNote, \'locked\')) !== null && _getItemAppDataValue !== void 0 ? _getItemAppDataValue : false;\n        const newLockState = (_getItemAppDataValue2 = this.componentRelay.getItemAppDataValue(this.note, \'locked\')) !== null && _getItemAppDataValue2 !== void 0 ? _getItemAppDataValue2 : false;\n\n        if (previousLockState !== newLockState) {\n          this.delegate.onNoteLockToggle(newLockState);\n        }\n      }\n\n      if (isNewNoteLoad) {\n        this.delegate.clearUndoHistory();\n      }\n    });\n  }\n\n  async importFileSafe() {\n    return Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! filesafe-js */ "filesafe-js", 23)).then(result => {\n      this.fileSafeClass = result.default;\n      this.configureFileSafe();\n      return this.fileSafeInstance;\n    });\n  }\n\n  configureFileSafe() {\n    this.fileSafeInstance = new this.fileSafeClass({\n      componentManager: this.componentRelay\n    });\n    this.fileSafeInstance.addDataChangeObserver(() => {\n      // Reload UI by querying FileSafe for changes...\n      const allFileDescriptors = this.fileSafeInstance.getAllFileDescriptors();\n\n      if (this.note && this.fileIdsPendingAssociation.length > 0) {\n        let hasMatch = false;\n\n        for (const uuid of this.fileIdsPendingAssociation.slice()) {\n          const descriptor = allFileDescriptors.find(candidate => candidate.uuid == uuid);\n\n          if (!descriptor) {\n            continue;\n          }\n\n          hasMatch = true;\n          this.fileIdsPendingAssociation.splice(this.fileIdsPendingAssociation.indexOf(uuid), 1);\n          const syntax = (0,_fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__.insertionSyntaxForFileDescriptor)(descriptor);\n          this.delegate.insertRawText(syntax);\n        }\n\n        if (hasMatch) {\n          this.textExpander.searchPatterns();\n        }\n      }\n\n      if (allFileDescriptors.length > 0) {\n        this.fileLoader.loadFileSafeElements();\n      }\n    });\n    this.fileSafeInstance.addNewFileDescriptorHandler(fileDescriptor => {\n      /**\n       * Called when a new file is uploaded. We\'ll wait until the bridge acknowledges\n       * receipt of this item, and then it will be added to the editor.\n       */\n      this.fileIdsPendingAssociation.push(fileDescriptor.uuid);\n    });\n    this.fileLoader = new _fileLoader__WEBPACK_IMPORTED_MODULE_1__.default({\n      fileSafeInstance: this.fileSafeInstance,\n      getElementsBySelector: this.delegate.getElementsBySelector,\n      insertElement: this.delegate.insertElement,\n      preprocessElement: this.delegate.preprocessElement\n    });\n    this.textExpander = new _textExpander__WEBPACK_IMPORTED_MODULE_2__.default({\n      afterExpand: () => this.fileLoader.loadFileSafeElements(),\n      getCurrentLineText: this.delegate.getCurrentLineText,\n      getPreviousLineText: this.delegate.getPreviousLineText,\n      replaceText: this.delegate.replaceText,\n      patterns: [{\n        regex: _fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__.FileSafeSyntaxPattern,\n        callback: matchedText => {\n          return (0,_fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__.expandedFileSafeSyntax)(matchedText);\n        }\n      }]\n    });\n  }\n  /**\n   * Gets the FileSafe class.\n   * @returns FileSafe class.\n   */\n\n\n  async getFileSafe() {\n    if (!this.fileSafeInstance && this.fileSafeLoading) {\n      return this.fileSafeLoading;\n    }\n\n    return this.importFileSafe();\n  }\n  /**\n   * Called by consumer when the editor has a keyup event.\n   */\n\n\n  onEditorKeyUp(_ref) {\n    let {\n      isSpace,\n      isEnter\n    } = _ref;\n    this.textExpander.onKeyUp({\n      isSpace,\n      isEnter\n    });\n  }\n  /**\n   * Called by consumer when user pastes into editor.\n   */\n\n\n  onEditorPaste() {\n    this.textExpander.onKeyUp({\n      isPaste: true\n    });\n  }\n  /**\n   * Called by consumer when the editor has a change/input event.\n   */\n\n\n  onEditorValueChanged(text) {\n    const {\n      mode,\n      supportsFileSafe\n    } = this.options;\n\n    if (this.needsFileSafeElementLoad) {\n      this.needsFileSafeElementLoad = false;\n      this.fileLoader.loadFileSafeElements();\n    }\n\n    if (this.ignoreNextTextChange) {\n      this.ignoreNextTextChange = false;\n      return;\n    }\n\n    if (supportsFileSafe) {\n      text = (0,_fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__.collapseFileSafeSyntax)(text);\n      /**\n       * Change events may be triggered several times when expanding filesafe syntax.\n       * Ultimately, while the visual layer is changing a lot, the underlying text layer,\n       * after being collapsed, will not change. So we\'ll compare the previous html to new collapsed html before continuing.\n       */\n\n      const sameText = this.previousText == text;\n\n      if (sameText) {\n        return;\n      }\n    }\n\n    this.previousText = text;\n\n    if (!this.note) {\n      return;\n    }\n\n    const note = this.note;\n    this.componentRelay.saveItemWithPresave(note, () => {\n      note.content.text = text;\n\n      if (this.delegate.generateCustomPreview) {\n        var _result$plain;\n\n        const result = this.delegate.generateCustomPreview(text);\n        note.content.preview_plain = (_result$plain = result.plain) !== null && _result$plain !== void 0 ? _result$plain : \' \';\n        note.content.preview_html = result.html;\n      } else {\n        if (mode === EditorKitMode.Html) {\n          let preview = (0,_fileSafeHtml__WEBPACK_IMPORTED_MODULE_4__.removeFileSafeSyntaxFromHtml)(text);\n          preview = (0,_utils__WEBPACK_IMPORTED_MODULE_3__.truncateString)((0,_utils__WEBPACK_IMPORTED_MODULE_3__.htmlToText)(preview));\n          /**\n           * If the preview has no length due to either being an empty note, or having just 1 FileSafe file\n           * that is stripped above, then we don\'t want to set to empty string, otherwise SN app will default to content\n           * for preview. We\'ll set a whitespace preview instead so SN doesn\'t go based on innate content.\n           */\n\n          note.content.preview_plain = preview.length > 0 ? preview : \' \';\n        } else {\n          note.content.preview_plain = text;\n        } // We\'re only using plain in this block.\n\n\n        note.content.preview_html = null;\n      }\n    });\n  }\n  /**\n   * Whether or not FileSafe is configured with integrations and keys, and can handle file uploads.\n   * If not, user should open files modal and configure FileSafe.\n   */\n\n\n  canUploadFiles() {\n    const credentials = this.fileSafeInstance.getAllCredentials();\n    const integrations = this.fileSafeInstance.getAllIntegrations();\n    return credentials.length > 0 && integrations.length > 0;\n  }\n  /**\n   * Encrypts and Uploads a Javascript file object to FileSafe.\n   * @param file The file to upload.\n   * @returns A file descriptor if successful.\n   */\n\n\n  async uploadJSFileObject(file) {\n    const cursorIdentifier = this.fileLoader.insertStatusAtCursor(\'Processing file...\');\n    return this.fileSafeInstance.encryptAndUploadJavaScriptFileObject(file).then(() => {\n      this.fileLoader.removeCursorStatus(cursorIdentifier);\n    });\n  }\n  /**\n   * saveItemWithPresave from the component relay.\n   */\n\n\n  saveItemWithPresave(note, presave) {\n    this.componentRelay.saveItemWithPresave(note, presave);\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZWRpdG9yS2l0LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vRWRpdG9yS2l0Ly4vc3JjL2VkaXRvcktpdC50cz85N2E1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb21wb25lbnRSZWxheSBmcm9tICdAc3RhbmRhcmRub3Rlcy9jb21wb25lbnQtcmVsYXknXG5pbXBvcnQgRmlsZUxvYWRlciwgeyBGaWxlTG9hZGVyT3B0aW9ucyB9IGZyb20gJy4vZmlsZUxvYWRlcidcbmltcG9ydCBUZXh0RXhwYW5kZXIsIHsgVGV4dEV4cGFuZGVyT3B0aW9ucyB9IGZyb20gJy4vdGV4dEV4cGFuZGVyJ1xuaW1wb3J0IHtcbiAgdHJ1bmNhdGVTdHJpbmcsXG4gIGh0bWxUb1RleHRcbn0gZnJvbSAnLi91dGlscydcbmltcG9ydCB7XG4gIEZpbGVTYWZlU3ludGF4UGF0dGVybixcbiAgY29sbGFwc2VGaWxlU2FmZVN5bnRheCxcbiAgZXhwYW5kZWRGaWxlU2FmZVN5bnRheCxcbiAgaW5zZXJ0aW9uU3ludGF4Rm9yRmlsZURlc2NyaXB0b3IsXG4gIHJlbW92ZUZpbGVTYWZlU3ludGF4RnJvbUh0bWwsXG4gIEZpbGVTYWZlRmlsZU1ldGFkYXRhXG59IGZyb20gJy4vZmlsZVNhZmVIdG1sJ1xuaW1wb3J0IHR5cGUgeyBJdGVtTWVzc2FnZVBheWxvYWQgfSBmcm9tICdAc3RhbmRhcmRub3Rlcy9zbmpzJ1xuXG4vKipcbiAqIFRoZSBkZWxlZ2F0ZSBpcyByZXNwb25zaWJsZSBmb3IgcmVzcG9uZGluZyB0byBldmVudHMgYW5kIGZ1bmN0aW9ucyB0aGF0IHRoZSBFZGl0b3JLaXQgcmVxdWlyZXMuXG4gKiBGb3IgZXhhbXBsZSwgd2hlbiBFZGl0b3JLaXQgd2FudHMgdG8gaW5zZXJ0IGEgbmV3IEhUTUwgZWxlbWVudCwgaXQgd29uJ3QgbmVjY2Vzc2FyaWx5IGtub3cgaG93LFxuICogYmVjYXVzZSBpdCdzIG5vdCBkZXNpZ25lZCBmb3IgYW55IHBhcnRpY3VsYXIgZWRpdG9yLiBJbnN0ZWFkLCBpdCB3aWxsIHRlbGwgdGhlIGRlbGVnYXRlIHRvXG4gKiBpbnNlcnQgdGhlIGVsZW1lbnQuIFRoZSBjb25zdW1lciBvZiB0aGlzIEFQSSwgdGhlIGFjdHVhbCBlZGl0b3IsIHdvdWxkIGNvbmZpZ3VyZSB0aGlzIGRlbGVnYXRlXG4gKiB3aXRoIHRoZSBhcHByb3ByaWF0ZSBjYWxsYmFja3MuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRWRpdG9yS2l0RGVsZWdhdGUge1xuICBpbnNlcnRSYXdUZXh0OiAodGV4dDogc3RyaW5nKSA9PiB2b2lkXG4gIHNldEVkaXRvclJhd1RleHQ6ICh0ZXh0OiBzdHJpbmcpID0+IHZvaWRcbiAgZ2V0Q3VycmVudExpbmVUZXh0OiBUZXh0RXhwYW5kZXJPcHRpb25zWydnZXRDdXJyZW50TGluZVRleHQnXVxuICBnZXRQcmV2aW91c0xpbmVUZXh0OiBUZXh0RXhwYW5kZXJPcHRpb25zWydnZXRQcmV2aW91c0xpbmVUZXh0J11cbiAgcmVwbGFjZVRleHQ6IFRleHRFeHBhbmRlck9wdGlvbnNbJ3JlcGxhY2VUZXh0J11cbiAgZ2V0RWxlbWVudHNCeVNlbGVjdG9yOiBGaWxlTG9hZGVyT3B0aW9uc1snZ2V0RWxlbWVudHNCeVNlbGVjdG9yJ11cbiAgaW5zZXJ0RWxlbWVudDogRmlsZUxvYWRlck9wdGlvbnNbJ2luc2VydEVsZW1lbnQnXVxuICBwcmVwcm9jZXNzRWxlbWVudDogRmlsZUxvYWRlck9wdGlvbnNbJ3ByZXByb2Nlc3NFbGVtZW50J11cbiAgY2xlYXJVbmRvSGlzdG9yeTogKCkgPT4gdm9pZFxuICBnZW5lcmF0ZUN1c3RvbVByZXZpZXc6ICh0ZXh0OiBzdHJpbmcpID0+IHsgaHRtbD86IHN0cmluZywgcGxhaW46IHN0cmluZyB9XG4gIG9uTm90ZUxvY2tUb2dnbGU/OiAoaXNMb2NrZWQ6IGJvb2xlYW4pID0+IHZvaWRcbiAgb25Ob3RlVmFsdWVDaGFuZ2U/OiAobm90ZTogSXRlbU1lc3NhZ2VQYXlsb2FkKSA9PiBQcm9taXNlPHZvaWQ+XG4gIG9uVGhlbWVzQ2hhbmdlPzogKCkgPT4gdm9pZFxufVxuXG5lbnVtIEVkaXRvcktpdE1vZGUge1xuICBQbGFpblRleHQgPSAncGxhaW50ZXh0JyxcbiAgSHRtbCA9ICdodG1sJyxcbiAgTWFya2Rvd24gPSAnbWFya2Rvd24nLFxuICBKc29uID0gJ2pzb24nXG59XG5cbnR5cGUgRWRpdG9yS2l0T3B0aW9ucyA9IHtcbiAgbW9kZTogRWRpdG9yS2l0TW9kZVxuICAvKipcbiAgICogSW5kaWNhdGVzIGlmIHRoZSBlZGl0b3Igc2hvdWxkIHN1cHBvcnQgRmlsZVNhZmUgaW50ZWdyYXRpb24uXG4gICAqL1xuICBzdXBwb3J0c0ZpbGVTYWZlOiBmYWxzZVxuICAvKipcbiAgICogRm9yIENvbXBvbmVudCBSZWxheSBzYXZpbmcuIEluZGljYXRlcyBpZiBkZWJvdW5jZXIgaXMgZW5hYmxlZC5cbiAgICovXG4gIGNvYWxsZXNlZFNhdmluZzogZmFsc2VcbiAgLyoqXG4gICAqIEZvciBDb21wb25lbnQgUmVsYXkgc2F2aW5nLiBJbmRpY2F0ZXMgd2hhdCB0aGUgZGVib3VuY2VyIG1zIGRlbGF5IHNob3VsZCBiZSBzZXQgdG8uXG4gICAqL1xuICBjb2FsbGVzZWRTYXZpbmdEZWxheTogMjUwXG59XG5cbnR5cGUgT25FZGl0b3JLZXlVcFBhcmFtcyA9IHtcbiAgaXNTcGFjZTogYm9vbGVhblxuICBpc0VudGVyOiBib29sZWFuXG59XG5cbnR5cGUgRmlsZVV1aWQgPSBzdHJpbmdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWRpdG9yS2l0QmFzZSB7XG4gIHByaXZhdGUgZmlsZUlkc1BlbmRpbmdBc3NvY2lhdGlvbjogRmlsZVV1aWRbXSA9IFtdXG4gIHByaXZhdGUgY29tcG9uZW50UmVsYXk/OiBDb21wb25lbnRSZWxheVxuICBwcml2YXRlIGZpbGVMb2FkZXI/OiBGaWxlTG9hZGVyXG4gIHByaXZhdGUgdGV4dEV4cGFuZGVyPzogVGV4dEV4cGFuZGVyXG5cbiAgcHJpdmF0ZSBmaWxlU2FmZUxvYWRpbmc/OiBQcm9taXNlPHZvaWQ+XG4gIHByaXZhdGUgZmlsZVNhZmVDbGFzcz86IGFueVxuICBwcml2YXRlIGZpbGVTYWZlSW5zdGFuY2U/OiBhbnlcblxuICBwcml2YXRlIG5vdGU/OiBJdGVtTWVzc2FnZVBheWxvYWRcbiAgcHJpdmF0ZSBpZ25vcmVOZXh0VGV4dENoYW5nZT86IGJvb2xlYW5cbiAgcHJpdmF0ZSBuZWVkc0ZpbGVTYWZlRWxlbWVudExvYWQ/OiBib29sZWFuXG4gIHByaXZhdGUgcHJldmlvdXNUZXh0Pzogc3RyaW5nXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBkZWxlZ2F0ZTogRWRpdG9yS2l0RGVsZWdhdGUsIHByaXZhdGUgb3B0aW9uczogRWRpdG9yS2l0T3B0aW9ucykge1xuICAgIHRoaXMuY29ubmVjdFRvQnJpZGdlKClcblxuICAgIGlmICh0aGlzLm9wdGlvbnMuc3VwcG9ydHNGaWxlU2FmZSkge1xuICAgICAgdGhpcy5maWxlU2FmZUxvYWRpbmcgPSB0aGlzLmltcG9ydEZpbGVTYWZlKClcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvbm5lY3RUb0JyaWRnZSgpIHtcbiAgICBjb25zdCB7XG4gICAgICBjb2FsbGVzZWRTYXZpbmcsXG4gICAgICBjb2FsbGVzZWRTYXZpbmdEZWxheSxcbiAgICAgIG1vZGUsXG4gICAgICBzdXBwb3J0c0ZpbGVTYWZlXG4gICAgfSA9IHRoaXMub3B0aW9uc1xuXG4gICAgdGhpcy5jb21wb25lbnRSZWxheSA9IG5ldyBDb21wb25lbnRSZWxheSh7XG4gICAgICB0YXJnZXRXaW5kb3c6IHdpbmRvdyxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgY29hbGxlc2VkU2F2aW5nLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGVkaXRvciBkb2VzIHNvbWUgZGVib3VuY2luZyBmb3IgdXMsIHNvIHdlJ2xsIGxvd2VyIHRoZVxuICAgICAgICAgKiBkZWZhdWx0IGRlYm91bmNlIHZhbHVlIGZyb20gMjUwIHRvIDE1MFxuICAgICAgICAgKi9cbiAgICAgICAgY29hbGxlc2VkU2F2aW5nRGVsYXlcbiAgICAgIH0sXG4gICAgICBvblJlYWR5OiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcGxhdGZvcm0gfSA9IHRoaXMuY29tcG9uZW50UmVsYXkhXG5cbiAgICAgICAgaWYgKHBsYXRmb3JtKSB7XG4gICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQocGxhdGZvcm0pXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvblRoZW1lc0NoYW5nZTogdGhpcy5kZWxlZ2F0ZS5vblRoZW1lc0NoYW5nZVxuICAgIH0pXG5cbiAgICB0aGlzLmNvbXBvbmVudFJlbGF5LnN0cmVhbUNvbnRleHRJdGVtKGFzeW5jIChub3RlOiBJdGVtTWVzc2FnZVBheWxvYWQpID0+IHtcbiAgICAgIC8qKlxuICAgICAgICogVE9ETzogSWYgbm90ZSBoYXMgY2hhbmdlZCwgcmVsZWFzZSBwcmV2aW91cyB0ZW1wIG9iamVjdCBVUkxzLlxuICAgICAgICovXG4gICAgICBsZXQgaXNOZXdOb3RlTG9hZCA9IHRydWVcbiAgICAgIGlmICh0aGlzLm5vdGUgJiYgdGhpcy5ub3RlLnV1aWQgPT0gbm90ZS51dWlkKSB7XG4gICAgICAgIGlzTmV3Tm90ZUxvYWQgPSBmYWxzZVxuICAgICAgfVxuXG4gICAgICBjb25zdCBwcmV2aW91c05vdGUgPSB0aGlzLm5vdGVcblxuICAgICAgaWYgKHN1cHBvcnRzRmlsZVNhZmUpIHtcbiAgICAgICAgY29uc3QgaXRlbUNsYXNzID0gdGhpcy5maWxlU2FmZUNsYXNzLmdldFNGSXRlbUNsYXNzKClcbiAgICAgICAgdGhpcy5ub3RlID0gbmV3IGl0ZW1DbGFzcyhub3RlKVxuICAgICAgICB0aGlzLmZpbGVTYWZlSW5zdGFuY2Uuc2V0Q3VycmVudE5vdGUodGhpcy5ub3RlKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5ub3RlID0gbm90ZVxuICAgICAgfVxuXG4gICAgICAgLy8gT25seSB1cGRhdGUgVUkgb24gbm9uLW1ldGFkYXRhIHVwZGF0ZXMuXG4gICAgICBpZiAobm90ZS5pc01ldGFkYXRhVXBkYXRlKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBsZXQgdGV4dCA9IG5vdGUuY29udGVudC50ZXh0XG5cbiAgICAgIC8qKlxuICAgICAgICogSWYgd2UncmUgYW4gSFRNTCBlZGl0b3IsIGFuZCB3ZSdyZSBkZWFsaW5nIHdpdGggYSBuZXcgbm90ZSxcbiAgICAgICAqIGNoZWNrIHRvIHNlZSBpZiBpdCdzIGluIGh0bWwgZm9ybWF0LlxuICAgICAgICogSWYgaXQncyBub3QsIHdlIGRvbid0IHdhbnQgdG8gY29udmVydCBpdCB0byBIVE1MIHVudGlsIHRoZSB1c2VyIG1ha2VzIGFuIGV4cGxpY2l0IGNoYW5nZVxuICAgICAgICogc28gd2UnbGwgaWdub3JlIHRoZSBuZXh0IGNoYW5nZSBldmVudCBpbiB0aGlzIGNhc2UuXG4gICAgICAgKi9cbiAgICAgIGlmIChtb2RlID09PSBFZGl0b3JLaXRNb2RlLkh0bWwgJiYgaXNOZXdOb3RlTG9hZCkge1xuICAgICAgICBjb25zdCBpc0h0bWwgPSAvPFthLXpdW1xcc1xcU10qPi9pLnRlc3QodGV4dClcbiAgICAgICAgaWYgKCFpc0h0bWwpIHtcbiAgICAgICAgICB0aGlzLmlnbm9yZU5leHRUZXh0Q2hhbmdlID0gdHJ1ZVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogU2V0IGJlZm9yZSBleHBhbmRpbmcuIFxuICAgICAgICogV2Ugd2FudCB0aGlzIHZhbHVlIHRvIGFsd2F5cyBiZSB0aGUgY29sbGFwc2VkIHZhbHVlXG4gICAgICAgKi9cbiAgICAgIHRoaXMucHJldmlvdXNUZXh0ID0gdGV4dFxuXG4gICAgICBpZiAoc3VwcG9ydHNGaWxlU2FmZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogV2Ugd2FudCB0byBleHBhbmQgYW55IGZpbGVzYWZlIHN5bnRheCBpbiB0aGUgdGV4dCxcbiAgICAgICAgICogYnV0IG9ubHkgYWZ0ZXIgdGhlIHRleHQgaGFzIGJlZW4gaW5zZXJ0ZWQuXG4gICAgICAgICAqIChXaWxsIGJlIGNoZWNrZWQgb24gZWRpdG9yIGNoYW5nZSBjYWxsYmFjaylcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmVlZHNGaWxlU2FmZUVsZW1lbnRMb2FkID0gdHJ1ZVxuICAgICAgICB0ZXh0ID0gZXhwYW5kZWRGaWxlU2FmZVN5bnRheCh0ZXh0KVxuICAgICAgfVxuXG4gICAgICB0aGlzLmRlbGVnYXRlLm9uTm90ZVZhbHVlQ2hhbmdlICYmIGF3YWl0IHRoaXMuZGVsZWdhdGUub25Ob3RlVmFsdWVDaGFuZ2Uobm90ZSlcbiAgICAgIHRoaXMuZGVsZWdhdGUuc2V0RWRpdG9yUmF3VGV4dCh0ZXh0KVxuXG4gICAgICBpZiAodGhpcy5kZWxlZ2F0ZS5vbk5vdGVMb2NrVG9nZ2xlKSB7XG4gICAgICAgIGNvbnN0IHByZXZpb3VzTG9ja1N0YXRlID0gdGhpcy5jb21wb25lbnRSZWxheSEuZ2V0SXRlbUFwcERhdGFWYWx1ZShwcmV2aW91c05vdGUsICdsb2NrZWQnKSA/PyBmYWxzZVxuICAgICAgICBjb25zdCBuZXdMb2NrU3RhdGUgPSB0aGlzLmNvbXBvbmVudFJlbGF5IS5nZXRJdGVtQXBwRGF0YVZhbHVlKHRoaXMubm90ZSwgJ2xvY2tlZCcpID8/IGZhbHNlXG5cbiAgICAgICAgaWYgKHByZXZpb3VzTG9ja1N0YXRlICE9PSBuZXdMb2NrU3RhdGUpIHtcbiAgICAgICAgICB0aGlzLmRlbGVnYXRlLm9uTm90ZUxvY2tUb2dnbGUobmV3TG9ja1N0YXRlKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChpc05ld05vdGVMb2FkKSB7XG4gICAgICAgIHRoaXMuZGVsZWdhdGUuY2xlYXJVbmRvSGlzdG9yeSgpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaW1wb3J0RmlsZVNhZmUoKSB7XG4gICAgcmV0dXJuIGltcG9ydCgnZmlsZXNhZmUtanMnKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIHRoaXMuZmlsZVNhZmVDbGFzcyA9IHJlc3VsdC5kZWZhdWx0XG4gICAgICB0aGlzLmNvbmZpZ3VyZUZpbGVTYWZlKClcbiAgICAgIHJldHVybiB0aGlzLmZpbGVTYWZlSW5zdGFuY2VcbiAgICB9KVxuICB9XG5cbiAgcHJpdmF0ZSBjb25maWd1cmVGaWxlU2FmZSgpIHtcbiAgICB0aGlzLmZpbGVTYWZlSW5zdGFuY2UgPSBuZXcgdGhpcy5maWxlU2FmZUNsYXNzKHtcbiAgICAgIGNvbXBvbmVudE1hbmFnZXI6IHRoaXMuY29tcG9uZW50UmVsYXlcbiAgICB9KVxuXG4gICAgdGhpcy5maWxlU2FmZUluc3RhbmNlLmFkZERhdGFDaGFuZ2VPYnNlcnZlcigoKSA9PiB7XG4gICAgICAvLyBSZWxvYWQgVUkgYnkgcXVlcnlpbmcgRmlsZVNhZmUgZm9yIGNoYW5nZXMuLi5cbiAgICAgIGNvbnN0IGFsbEZpbGVEZXNjcmlwdG9ycyA9IHRoaXMuZmlsZVNhZmVJbnN0YW5jZS5nZXRBbGxGaWxlRGVzY3JpcHRvcnMoKVxuXG4gICAgICBpZiAodGhpcy5ub3RlICYmIHRoaXMuZmlsZUlkc1BlbmRpbmdBc3NvY2lhdGlvbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxldCBoYXNNYXRjaCA9IGZhbHNlXG5cbiAgICAgICAgZm9yIChjb25zdCB1dWlkIG9mIHRoaXMuZmlsZUlkc1BlbmRpbmdBc3NvY2lhdGlvbi5zbGljZSgpKSB7XG4gICAgICAgICAgY29uc3QgZGVzY3JpcHRvciA9IGFsbEZpbGVEZXNjcmlwdG9ycy5maW5kKChjYW5kaWRhdGU6IEZpbGVTYWZlRmlsZU1ldGFkYXRhKSA9PiBjYW5kaWRhdGUudXVpZCA9PSB1dWlkKVxuXG4gICAgICAgICAgaWYgKCFkZXNjcmlwdG9yKSB7XG4gICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGhhc01hdGNoID0gdHJ1ZVxuICAgICAgICAgIHRoaXMuZmlsZUlkc1BlbmRpbmdBc3NvY2lhdGlvbi5zcGxpY2UodGhpcy5maWxlSWRzUGVuZGluZ0Fzc29jaWF0aW9uLmluZGV4T2YodXVpZCksIDEpXG5cbiAgICAgICAgICBjb25zdCBzeW50YXggPSBpbnNlcnRpb25TeW50YXhGb3JGaWxlRGVzY3JpcHRvcihkZXNjcmlwdG9yKVxuICAgICAgICAgIHRoaXMuZGVsZWdhdGUuaW5zZXJ0UmF3VGV4dChzeW50YXgpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGFzTWF0Y2gpIHtcbiAgICAgICAgICB0aGlzLnRleHRFeHBhbmRlciEuc2VhcmNoUGF0dGVybnMoKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChhbGxGaWxlRGVzY3JpcHRvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLmZpbGVMb2FkZXIhLmxvYWRGaWxlU2FmZUVsZW1lbnRzKClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgdGhpcy5maWxlU2FmZUluc3RhbmNlLmFkZE5ld0ZpbGVEZXNjcmlwdG9ySGFuZGxlcigoZmlsZURlc2NyaXB0b3I6IEZpbGVTYWZlRmlsZU1ldGFkYXRhKSA9PiB7XG4gICAgICAvKipcbiAgICAgICAqIENhbGxlZCB3aGVuIGEgbmV3IGZpbGUgaXMgdXBsb2FkZWQuIFdlJ2xsIHdhaXQgdW50aWwgdGhlIGJyaWRnZSBhY2tub3dsZWRnZXNcbiAgICAgICAqIHJlY2VpcHQgb2YgdGhpcyBpdGVtLCBhbmQgdGhlbiBpdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBlZGl0b3IuXG4gICAgICAgKi9cbiAgICAgIHRoaXMuZmlsZUlkc1BlbmRpbmdBc3NvY2lhdGlvbi5wdXNoKGZpbGVEZXNjcmlwdG9yLnV1aWQpXG4gICAgfSlcblxuICAgIHRoaXMuZmlsZUxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKHtcbiAgICAgIGZpbGVTYWZlSW5zdGFuY2U6IHRoaXMuZmlsZVNhZmVJbnN0YW5jZSxcbiAgICAgIGdldEVsZW1lbnRzQnlTZWxlY3RvcjogdGhpcy5kZWxlZ2F0ZS5nZXRFbGVtZW50c0J5U2VsZWN0b3IsXG4gICAgICBpbnNlcnRFbGVtZW50OiB0aGlzLmRlbGVnYXRlLmluc2VydEVsZW1lbnQsXG4gICAgICBwcmVwcm9jZXNzRWxlbWVudDogdGhpcy5kZWxlZ2F0ZS5wcmVwcm9jZXNzRWxlbWVudFxuICAgIH0pXG5cbiAgICB0aGlzLnRleHRFeHBhbmRlciA9IG5ldyBUZXh0RXhwYW5kZXIoe1xuICAgICAgYWZ0ZXJFeHBhbmQ6ICgpID0+IHRoaXMuZmlsZUxvYWRlciEubG9hZEZpbGVTYWZlRWxlbWVudHMoKSxcbiAgICAgIGdldEN1cnJlbnRMaW5lVGV4dDogdGhpcy5kZWxlZ2F0ZS5nZXRDdXJyZW50TGluZVRleHQsXG4gICAgICBnZXRQcmV2aW91c0xpbmVUZXh0OiB0aGlzLmRlbGVnYXRlLmdldFByZXZpb3VzTGluZVRleHQsXG4gICAgICByZXBsYWNlVGV4dDogdGhpcy5kZWxlZ2F0ZS5yZXBsYWNlVGV4dCxcbiAgICAgIHBhdHRlcm5zOiBbe1xuICAgICAgICByZWdleDogRmlsZVNhZmVTeW50YXhQYXR0ZXJuLFxuICAgICAgICBjYWxsYmFjazogKG1hdGNoZWRUZXh0KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGV4cGFuZGVkRmlsZVNhZmVTeW50YXgobWF0Y2hlZFRleHQpXG4gICAgICAgIH1cbiAgICAgIH1dXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBGaWxlU2FmZSBjbGFzcy5cbiAgICogQHJldHVybnMgRmlsZVNhZmUgY2xhc3MuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0RmlsZVNhZmUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmZpbGVTYWZlSW5zdGFuY2UgJiYgdGhpcy5maWxlU2FmZUxvYWRpbmcpIHtcbiAgICAgIHJldHVybiB0aGlzLmZpbGVTYWZlTG9hZGluZ1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5pbXBvcnRGaWxlU2FmZSgpXG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIGJ5IGNvbnN1bWVyIHdoZW4gdGhlIGVkaXRvciBoYXMgYSBrZXl1cCBldmVudC5cbiAgICovXG4gIHB1YmxpYyBvbkVkaXRvcktleVVwKHsgaXNTcGFjZSwgaXNFbnRlciB9OiBPbkVkaXRvcktleVVwUGFyYW1zKTogdm9pZCB7XG4gICAgdGhpcy50ZXh0RXhwYW5kZXIhLm9uS2V5VXAoe1xuICAgICAgIGlzU3BhY2UsXG4gICAgICAgaXNFbnRlclxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogQ2FsbGVkIGJ5IGNvbnN1bWVyIHdoZW4gdXNlciBwYXN0ZXMgaW50byBlZGl0b3IuXG4gICAqL1xuICBwdWJsaWMgb25FZGl0b3JQYXN0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLnRleHRFeHBhbmRlciEub25LZXlVcCh7XG4gICAgICBpc1Bhc3RlOiB0cnVlXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsZWQgYnkgY29uc3VtZXIgd2hlbiB0aGUgZWRpdG9yIGhhcyBhIGNoYW5nZS9pbnB1dCBldmVudC5cbiAgICovXG4gIHB1YmxpYyBvbkVkaXRvclZhbHVlQ2hhbmdlZCh0ZXh0OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCB7IG1vZGUsIHN1cHBvcnRzRmlsZVNhZmUgfSA9IHRoaXMub3B0aW9uc1xuXG4gICAgaWYgKHRoaXMubmVlZHNGaWxlU2FmZUVsZW1lbnRMb2FkKSB7XG4gICAgICB0aGlzLm5lZWRzRmlsZVNhZmVFbGVtZW50TG9hZCA9IGZhbHNlXG4gICAgICB0aGlzLmZpbGVMb2FkZXIhLmxvYWRGaWxlU2FmZUVsZW1lbnRzKClcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pZ25vcmVOZXh0VGV4dENoYW5nZSkge1xuICAgICAgdGhpcy5pZ25vcmVOZXh0VGV4dENoYW5nZSA9IGZhbHNlXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBpZiAoc3VwcG9ydHNGaWxlU2FmZSkge1xuICAgICAgdGV4dCA9IGNvbGxhcHNlRmlsZVNhZmVTeW50YXgodGV4dClcblxuICAgICAgLyoqXG4gICAgICAgKiBDaGFuZ2UgZXZlbnRzIG1heSBiZSB0cmlnZ2VyZWQgc2V2ZXJhbCB0aW1lcyB3aGVuIGV4cGFuZGluZyBmaWxlc2FmZSBzeW50YXguXG4gICAgICAgKiBVbHRpbWF0ZWx5LCB3aGlsZSB0aGUgdmlzdWFsIGxheWVyIGlzIGNoYW5naW5nIGEgbG90LCB0aGUgdW5kZXJseWluZyB0ZXh0IGxheWVyLFxuICAgICAgICogYWZ0ZXIgYmVpbmcgY29sbGFwc2VkLCB3aWxsIG5vdCBjaGFuZ2UuIFNvIHdlJ2xsIGNvbXBhcmUgdGhlIHByZXZpb3VzIGh0bWwgdG8gbmV3IGNvbGxhcHNlZCBodG1sIGJlZm9yZSBjb250aW51aW5nLlxuICAgICAgICovXG4gICAgICBjb25zdCBzYW1lVGV4dCA9IHRoaXMucHJldmlvdXNUZXh0ID09IHRleHRcbiAgICAgIGlmIChzYW1lVGV4dCkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnByZXZpb3VzVGV4dCA9IHRleHRcblxuICAgIGlmICghdGhpcy5ub3RlKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBub3RlID0gdGhpcy5ub3RlXG5cbiAgICB0aGlzLmNvbXBvbmVudFJlbGF5IS5zYXZlSXRlbVdpdGhQcmVzYXZlKG5vdGUsICgpID0+IHtcbiAgICAgIG5vdGUuY29udGVudC50ZXh0ID0gdGV4dFxuXG4gICAgICBpZiAodGhpcy5kZWxlZ2F0ZS5nZW5lcmF0ZUN1c3RvbVByZXZpZXcpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5kZWxlZ2F0ZS5nZW5lcmF0ZUN1c3RvbVByZXZpZXcodGV4dClcblxuICAgICAgICBub3RlLmNvbnRlbnQucHJldmlld19wbGFpbiA9IHJlc3VsdC5wbGFpbiA/PyAnICdcbiAgICAgICAgbm90ZS5jb250ZW50LnByZXZpZXdfaHRtbCA9IHJlc3VsdC5odG1sXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAobW9kZSA9PT0gRWRpdG9yS2l0TW9kZS5IdG1sKSB7XG4gICAgICAgICAgbGV0IHByZXZpZXcgPSByZW1vdmVGaWxlU2FmZVN5bnRheEZyb21IdG1sKHRleHQpXG4gICAgICAgICAgcHJldmlldyA9IHRydW5jYXRlU3RyaW5nKGh0bWxUb1RleHQocHJldmlldykpXG4gICAgICAgICAgLyoqXG4gICAgICAgICAgICogSWYgdGhlIHByZXZpZXcgaGFzIG5vIGxlbmd0aCBkdWUgdG8gZWl0aGVyIGJlaW5nIGFuIGVtcHR5IG5vdGUsIG9yIGhhdmluZyBqdXN0IDEgRmlsZVNhZmUgZmlsZVxuICAgICAgICAgICAqIHRoYXQgaXMgc3RyaXBwZWQgYWJvdmUsIHRoZW4gd2UgZG9uJ3Qgd2FudCB0byBzZXQgdG8gZW1wdHkgc3RyaW5nLCBvdGhlcndpc2UgU04gYXBwIHdpbGwgZGVmYXVsdCB0byBjb250ZW50XG4gICAgICAgICAgICogZm9yIHByZXZpZXcuIFdlJ2xsIHNldCBhIHdoaXRlc3BhY2UgcHJldmlldyBpbnN0ZWFkIHNvIFNOIGRvZXNuJ3QgZ28gYmFzZWQgb24gaW5uYXRlIGNvbnRlbnQuXG4gICAgICAgICAgICovXG4gICAgICAgICAgbm90ZS5jb250ZW50LnByZXZpZXdfcGxhaW4gPSBwcmV2aWV3Lmxlbmd0aCA+IDAgPyBwcmV2aWV3IDogJyAnXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbm90ZS5jb250ZW50LnByZXZpZXdfcGxhaW4gPSB0ZXh0XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXZSdyZSBvbmx5IHVzaW5nIHBsYWluIGluIHRoaXMgYmxvY2suXG4gICAgICAgIG5vdGUuY29udGVudC5wcmV2aWV3X2h0bWwgPSBudWxsXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIG9yIG5vdCBGaWxlU2FmZSBpcyBjb25maWd1cmVkIHdpdGggaW50ZWdyYXRpb25zIGFuZCBrZXlzLCBhbmQgY2FuIGhhbmRsZSBmaWxlIHVwbG9hZHMuXG4gICAqIElmIG5vdCwgdXNlciBzaG91bGQgb3BlbiBmaWxlcyBtb2RhbCBhbmQgY29uZmlndXJlIEZpbGVTYWZlLlxuICAgKi9cbiAgcHVibGljIGNhblVwbG9hZEZpbGVzKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gdGhpcy5maWxlU2FmZUluc3RhbmNlLmdldEFsbENyZWRlbnRpYWxzKClcbiAgICBjb25zdCBpbnRlZ3JhdGlvbnMgPSB0aGlzLmZpbGVTYWZlSW5zdGFuY2UuZ2V0QWxsSW50ZWdyYXRpb25zKClcbiAgICByZXR1cm4gY3JlZGVudGlhbHMubGVuZ3RoID4gMCAmJiBpbnRlZ3JhdGlvbnMubGVuZ3RoID4gMFxuICB9XG5cbiAgLyoqXG4gICAqIEVuY3J5cHRzIGFuZCBVcGxvYWRzIGEgSmF2YXNjcmlwdCBmaWxlIG9iamVjdCB0byBGaWxlU2FmZS5cbiAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdG8gdXBsb2FkLlxuICAgKiBAcmV0dXJucyBBIGZpbGUgZGVzY3JpcHRvciBpZiBzdWNjZXNzZnVsLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIHVwbG9hZEpTRmlsZU9iamVjdChmaWxlOiBCbG9iKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY3Vyc29ySWRlbnRpZmllciA9IHRoaXMuZmlsZUxvYWRlciEuaW5zZXJ0U3RhdHVzQXRDdXJzb3IoJ1Byb2Nlc3NpbmcgZmlsZS4uLicpXG4gICAgcmV0dXJuIHRoaXMuZmlsZVNhZmVJbnN0YW5jZS5lbmNyeXB0QW5kVXBsb2FkSmF2YVNjcmlwdEZpbGVPYmplY3QoZmlsZSkudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmZpbGVMb2FkZXIhLnJlbW92ZUN1cnNvclN0YXR1cyhjdXJzb3JJZGVudGlmaWVyKVxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogc2F2ZUl0ZW1XaXRoUHJlc2F2ZSBmcm9tIHRoZSBjb21wb25lbnQgcmVsYXkuXG4gICAqL1xuICBwdWJsaWMgc2F2ZUl0ZW1XaXRoUHJlc2F2ZShub3RlOiBJdGVtTWVzc2FnZVBheWxvYWQsIHByZXNhdmU/OiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5jb21wb25lbnRSZWxheSEuc2F2ZUl0ZW1XaXRoUHJlc2F2ZShub3RlLCBwcmVzYXZlKVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQWlDQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUE2QkE7QUFlQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFEQTtBQUNBO0FBREE7QUFDQTtBQURBO0FBQ0E7QUFEQTtBQUNBO0FBREE7QUFDQTtBQURBO0FBQ0E7QUFEQTtBQUNBO0FBREE7QUFDQTtBQURBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpCQTtBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTEE7QUFZQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUNBO0FBQ0E7QUFqVUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/editorKit.ts\n')},"./src/fileLoader.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ FileLoader)\n/* harmony export */ });\n/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils */ \"./src/utils.ts\");\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nclass FileLoader {\n  /**\n   * When a file is decrypted and loaded into a temp url, we'll place the temp url in here so that subsequent decrypt attempts\n   * dont require further work. Mapped values have the shape of { url, fileType, fsName }\n   */\n  // The UUIDs of files currently loading, so that we don't start a new load for currently loading file.\n  // The UUID to current status element mapping\n  constructor(options) {\n    this.options = options;\n\n    _defineProperty(this, \"uuidToFileTempUrlAndTypeMapping\", {});\n\n    _defineProperty(this, \"currentlyLoadingIds\", []);\n\n    _defineProperty(this, \"statusElementMapping\", {});\n\n    _defineProperty(this, \"fileTypeToElementType\", {\n      'image/png': 'img',\n      'image/jpg': 'img',\n      'image/jpeg': 'img',\n      'image/gif': 'img',\n      'image/tiff': 'img',\n      'image/bmp': 'img',\n      'video/mp4': 'video',\n      'audio/mpeg': 'audio',\n      'audio/mp3': 'audio'\n    });\n  }\n\n  fileTypeForElementType(type) {\n    return this.fileTypeToElementType[type.toLowerCase()];\n  }\n  /**\n   * Scans the document for elements <fileSafe>. If found, begins loading file.\n   */\n\n\n  loadFileSafeElements() {\n    const elements = this.options.getElementsBySelector('*[fsplaceholder]');\n\n    for (const element of elements) {\n      this.loadFileSafeElement(element);\n    }\n  }\n\n  async loadFileSafeElement(fsElement) {\n    var _fsElement$getAttribu;\n\n    const {\n      fileSafeInstance\n    } = this.options;\n    const fsid = fsElement.getAttribute('fsid');\n    const fsName = (_fsElement$getAttribu = fsElement.getAttribute('fsName')) !== null && _fsElement$getAttribu !== void 0 ? _fsElement$getAttribu : '';\n    const fileNameDisplay = !fsName || fsName == 'undefined' ? 'file' : fsName;\n\n    if (!fsid) {\n      return false;\n    }\n\n    const existingMapping = this.uuidToFileTempUrlAndTypeMapping[fsid];\n\n    if (existingMapping) {\n      this.insertMediaElement({\n        fsid,\n        fsElement,\n        url: existingMapping.url,\n        fileType: existingMapping.fileType,\n        fsName: existingMapping.fsName\n      });\n      return false;\n    }\n\n    if (this.currentlyLoadingIds.includes(fsid)) {\n      return false;\n    }\n\n    const descriptor = fileSafeInstance.findFileDescriptor(fsid);\n\n    if (!descriptor) {\n      this.setStatus({\n        fsElement,\n        fsid,\n        status: \"Unable to find \".concat(fileNameDisplay, \" \").concat(fsid, \".\"),\n        removable: true\n      });\n      return false;\n    }\n\n    const selectorSyntax = \"[fsid=\\\"\".concat(descriptor.uuid, \"\\\"][fscollapsable]\");\n    const existingElements = document.querySelectorAll(\"img\".concat(selectorSyntax, \", figure\").concat(selectorSyntax, \", video\").concat(selectorSyntax, \", audio\").concat(selectorSyntax));\n\n    if (existingElements.length > 0) {\n      return false;\n    }\n\n    const cleanup = () => this.currentlyLoadingIds.splice(this.currentlyLoadingIds.indexOf(fsid), 1);\n\n    this.currentlyLoadingIds.push(fsid);\n    this.setStatus({\n      fsElement,\n      fsid,\n      status: \"Downloading \".concat(fileNameDisplay, \"...\")\n    }); // Allow UI to update before beginning download...\n\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_0__.sleep)(0.05);\n    const fileItem = await fileSafeInstance.downloadFileFromDescriptor(descriptor).catch(() => {\n      this.setStatus({\n        fsElement,\n        fsid,\n        status: \"Unable to download \".concat(fileNameDisplay, \" \").concat(fsid, \".\")\n      });\n      return;\n    });\n\n    if (!fileItem) {\n      return false;\n    }\n\n    this.setStatus({\n      fsElement,\n      fsid,\n      status: \"Decrypting \".concat(fileNameDisplay, \"...\")\n    }); // Allow UI to update before beginning decryption\n\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_0__.sleep)(0.05);\n    const data = await fileSafeInstance.decryptFile({\n      fileDescriptor: descriptor,\n      fileItem\n    }).catch(() => {\n      this.setStatus({\n        fsElement,\n        fsid,\n        status: \"Unable to decrypt \".concat(fileNameDisplay, \" \").concat(fsid, \".\")\n      });\n      return;\n    });\n\n    if (!data) {\n      return false;\n    } // Remove loading text\n\n\n    this.setStatus({\n      fsElement,\n      fsid\n    }); // Allow UI to update before adding image\n\n    await (0,_utils__WEBPACK_IMPORTED_MODULE_0__.sleep)(0.05); // Generate temporary url, must be released later\n\n    const fileType = descriptor.content.fileType;\n    const tempUrl = fileSafeInstance.createTemporaryFileUrl({\n      base64Data: data.decryptedData,\n      dataType: fileType\n    });\n    this.insertMediaElement({\n      fsid,\n      fileType,\n      fsName,\n      fsElement,\n      url: tempUrl\n    });\n    cleanup();\n    this.uuidToFileTempUrlAndTypeMapping[fsid] = {\n      fileType,\n      url: tempUrl,\n      fsName\n    };\n    return true;\n  }\n\n  insertMediaElement(_ref) {\n    let {\n      url,\n      fsid,\n      fsName,\n      fileType,\n      fsElement\n    } = _ref;\n    const elementType = this.fileTypeForElementType(fileType);\n    let mediaElement;\n\n    switch (elementType) {\n      case 'img':\n        mediaElement = this.createImageElement({\n          url,\n          fsid,\n          fsName,\n          fsElement\n        });\n        break;\n\n      case 'video':\n        mediaElement = this.createVideoElement({\n          url,\n          fsid,\n          fileType,\n          fsName,\n          fsElement\n        });\n        break;\n\n      case 'audio':\n        mediaElement = this.createAudioElement({\n          url,\n          fsid,\n          fsName\n        });\n        break;\n\n      default:\n        mediaElement = this.createDownloadElement({\n          url,\n          fsid,\n          fsName\n        });\n        break;\n    }\n\n    this.insertElementNearElement(mediaElement, fsElement); // Remove fsElement now that image is loaded.\n\n    fsElement.remove();\n  }\n\n  wrapElementInTag(_ref2) {\n    let {\n      element,\n      tagName,\n      fsid,\n      fsName\n    } = _ref2;\n    const tag = document.createElement(tagName);\n    tag.setAttribute('fsid', fsid);\n    tag.setAttribute('fsName', fsName);\n    tag.setAttribute('fscollapsable', 'true');\n    tag.setAttribute('contenteditable', 'true');\n    tag.append(element);\n    return tag;\n  }\n\n  createImageElement(_ref3) {\n    let {\n      url,\n      fsid,\n      fsName,\n      fsElement\n    } = _ref3;\n    const image = document.createElement('img');\n    image.setAttribute('src', url);\n    image.setAttribute('srcset', \"\".concat(url, \" 2x\"));\n    image.setAttribute('fsid', fsid);\n    image.setAttribute('fsName', fsName);\n    image.setAttribute('fscollapsable', 'true');\n    const elementWidth = fsElement.getAttribute('width');\n\n    if (elementWidth) {\n      image.setAttribute('width', elementWidth);\n    }\n\n    const elementHeight = fsElement.getAttribute('height');\n\n    if (elementHeight) {\n      image.setAttribute('height', elementHeight);\n    }\n\n    return image;\n  }\n\n  createVideoElement(_ref4) {\n    let {\n      url,\n      fsid,\n      fileType,\n      fsName,\n      fsElement\n    } = _ref4;\n    const video = document.createElement('video');\n    video.setAttribute('controls', 'true');\n    video.setAttribute('fsid', fsid);\n    video.setAttribute('fsName', fsName);\n    video.setAttribute('fscollapsable', 'true');\n    const elementWidth = fsElement.getAttribute('width');\n\n    if (elementWidth) {\n      video.setAttribute('width', elementWidth);\n    }\n\n    const elementHeight = fsElement.getAttribute('height');\n\n    if (elementHeight) {\n      video.setAttribute('height', elementHeight);\n    }\n\n    const source = document.createElement('source');\n    source.setAttribute('src', url);\n    source.setAttribute('type', fileType);\n    video.append(source);\n    /**\n     * Redactor will automatically insert a video element in a p tag,\n     * so we'll do it ourselves so that we can control its attributes.\n     */\n\n    return this.wrapElementInTag({\n      fsid,\n      fsName,\n      element: video,\n      tagName: 'p'\n    });\n  }\n\n  createDownloadElement(_ref5) {\n    let {\n      url,\n      fsid,\n      fsName\n    } = _ref5;\n    const link = document.createElement('a');\n    link.setAttribute('fsid', fsid);\n    link.setAttribute('fsName', fsName);\n    link.setAttribute('ghost', 'true');\n    link.setAttribute('fscollapsable', 'true');\n    link.setAttribute('href', url);\n    link.textContent = \"\".concat(fsName);\n    return link;\n  }\n\n  createAudioElement(_ref6) {\n    let {\n      url,\n      fsid,\n      fsName\n    } = _ref6;\n    const audio = document.createElement('audio');\n    audio.setAttribute('src', url);\n    audio.setAttribute('controls', 'true');\n    audio.setAttribute('fsid', fsid);\n    audio.setAttribute('fsName', fsName);\n    audio.setAttribute('fscollapsable', 'true');\n    return this.wrapElementInTag({\n      fsid,\n      fsName,\n      element: audio,\n      tagName: 'p'\n    });\n  }\n\n  setStatus(_ref7) {\n    let {\n      status,\n      fsElement,\n      fsid,\n      removable = false\n    } = _ref7;\n\n    if (fsid) {\n      const existingStatusElement = this.statusElementMapping[fsid];\n\n      if (existingStatusElement) {\n        existingStatusElement.remove();\n        delete this.statusElementMapping[fsid];\n      }\n    }\n\n    if (status) {\n      let element = document.createElement('label');\n      element.setAttribute('id', fsid);\n      element.setAttribute('ghost', 'true');\n      element.setAttribute('contenteditable', 'false');\n      element.style.fontWeight = 'bold';\n      element.textContent = status;\n\n      if (removable) {\n        element.style.userSelect = 'all';\n      }\n\n      element = this.insertElementNearElement(element, fsElement);\n\n      if (fsid) {\n        this.statusElementMapping[fsid] = element;\n      }\n\n      return element;\n    }\n  }\n\n  insertStatusAtCursor(status) {\n    const identifier = Math.random().toString(36).substring(7);\n    this.setStatus({\n      status,\n      fsid: identifier,\n      fsElement: null\n    });\n    return identifier;\n  }\n\n  removeCursorStatus(identifier) {\n    /**\n     * We want to search for the element based on identifier, because the actual element\n     * inserted may have been done so as raw HTML, and not via an element pointer.\n     */\n    const elements = this.options.getElementsBySelector(\"#\".concat(identifier));\n\n    if (elements.length > 0) {\n      elements[0].remove();\n    }\n  }\n\n  insertElementNearElement(domNodeToInsert, inVicinityOfElement) {\n    const processedElement = this.options.preprocessElement(domNodeToInsert);\n    let insertionType = 'child'; // <figure> tags cannot be nested inside p tags.\n\n    if (inVicinityOfElement && processedElement.tagName.toLowerCase() == 'figure') {\n      // If we have a p ancestor, we need to get out.\n      const paragraphAncestor = inVicinityOfElement.closest('p');\n\n      if (paragraphAncestor) {\n        /**\n         * p tags cannot be nested in other p tags, so if we found one, we know its parent isn't and doesn't belong to a p tag.\n         * Add the new one right after paragraphAncestor.\n         */\n        inVicinityOfElement = paragraphAncestor;\n        insertionType = 'afterend';\n      }\n    }\n\n    this.options.insertElement(processedElement, inVicinityOfElement, insertionType);\n    return processedElement;\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZmlsZUxvYWRlci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL0VkaXRvcktpdC8uL3NyYy9maWxlTG9hZGVyLnRzPzRhYTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2xlZXAgfSBmcm9tICcuL3V0aWxzJ1xuXG5leHBvcnQgdHlwZSBGaWxlTG9hZGVyT3B0aW9ucyA9IHtcbiAgZmlsZVNhZmVJbnN0YW5jZTogYW55XG4gIGdldEVsZW1lbnRzQnlTZWxlY3RvcjogKHNlbGVjdG9yOiBzdHJpbmcpID0+IEVsZW1lbnRbXVxuICBwcmVwcm9jZXNzRWxlbWVudDogKGVsZW1lbnQ6IEVsZW1lbnQpID0+IEVsZW1lbnRcbiAgaW5zZXJ0RWxlbWVudDogKGVsZW1lbnQ6IEVsZW1lbnQsIGluVmljaW5pdHlPZkVsZW1lbnQ6IEVsZW1lbnQgfCBudWxsLCBpbnNlcnRpb25UeXBlOiBzdHJpbmcpID0+IHZvaWRcbn1cblxudHlwZSBGaWxlVHlwZXMgPSB7XG4gIFtrZXk6IHN0cmluZ106IHN0cmluZ1xufVxuXG50eXBlIFV1aWRUeXBlTWFwcGluZyA9IHtcbiAgW2tleTogc3RyaW5nXToge1xuICAgIHVybDogc3RyaW5nXG4gICAgZmlsZVR5cGU6IHN0cmluZ1xuICAgIGZzTmFtZTogc3RyaW5nXG4gIH1cbn1cblxudHlwZSBFbGVtZW50U3RhdHVzTWFwcGluZyA9IHtcbiAgW2tleTogc3RyaW5nXTogRWxlbWVudFxufVxuXG50eXBlIEluc2VydE1lZGlhRWxlbWVudFBhcmFtcyA9IHtcbiAgdXJsOiBzdHJpbmcsXG4gIGZzaWQ6IHN0cmluZyxcbiAgZnNOYW1lOiBzdHJpbmcsXG4gIGZpbGVUeXBlOiBzdHJpbmcsXG4gIGZzRWxlbWVudDogRWxlbWVudFxufVxuXG50eXBlIFdyYXBFbGVtZW50SW5UYWdQYXJhbXMgPSB7XG4gIGVsZW1lbnQ6IEVsZW1lbnQsXG4gIHRhZ05hbWU6IHN0cmluZyxcbiAgZnNpZDogc3RyaW5nLFxuICBmc05hbWU6IHN0cmluZ1xufVxuXG50eXBlIFNldFN0YXR1c1BhcmFtcyA9IHtcbiAgc3RhdHVzPzogc3RyaW5nLFxuICBmc0VsZW1lbnQ6IEVsZW1lbnQgfCBudWxsLFxuICBmc2lkOiBzdHJpbmcsXG4gIHJlbW92YWJsZT86IGJvb2xlYW5cbn1cblxudHlwZSBDcmVhdGVJbWFnZUVsZW1lbnRQYXJhbXMgPSB7XG4gIHVybDogc3RyaW5nLFxuICBmc2lkOiBzdHJpbmcsXG4gIGZzTmFtZTogc3RyaW5nLFxuICBmc0VsZW1lbnQ6IEVsZW1lbnRcbn1cblxudHlwZSBDcmVhdGVBdWRpb0VsZW1lbnRQYXJhbXMgPSB7XG4gIHVybDogc3RyaW5nLFxuICBmc2lkOiBzdHJpbmcsXG4gIGZzTmFtZTogc3RyaW5nXG59XG5cbnR5cGUgQ3JlYXRlVmlkZW9FbGVtZW50UGFyYW1zID0ge1xuICB1cmw6IHN0cmluZyxcbiAgZnNpZDogc3RyaW5nLFxuICBmaWxlVHlwZTogc3RyaW5nLFxuICBmc05hbWU6IHN0cmluZyxcbiAgZnNFbGVtZW50OiBFbGVtZW50XG59XG5cbnR5cGUgQ3JlYXRlRG93bmxvYWRFbGVtZW50UGFyYW1zID0ge1xuICB1cmw6IHN0cmluZyxcbiAgZnNpZDogc3RyaW5nLFxuICBmc05hbWU6IHN0cmluZ1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGaWxlTG9hZGVyIHtcbiAgLyoqXG4gICAqIFdoZW4gYSBmaWxlIGlzIGRlY3J5cHRlZCBhbmQgbG9hZGVkIGludG8gYSB0ZW1wIHVybCwgd2UnbGwgcGxhY2UgdGhlIHRlbXAgdXJsIGluIGhlcmUgc28gdGhhdCBzdWJzZXF1ZW50IGRlY3J5cHQgYXR0ZW1wdHNcbiAgICogZG9udCByZXF1aXJlIGZ1cnRoZXIgd29yay4gTWFwcGVkIHZhbHVlcyBoYXZlIHRoZSBzaGFwZSBvZiB7IHVybCwgZmlsZVR5cGUsIGZzTmFtZSB9XG4gICAqL1xuICBwcml2YXRlIHV1aWRUb0ZpbGVUZW1wVXJsQW5kVHlwZU1hcHBpbmc6IFV1aWRUeXBlTWFwcGluZyA9IHt9XG5cbiAgLy8gVGhlIFVVSURzIG9mIGZpbGVzIGN1cnJlbnRseSBsb2FkaW5nLCBzbyB0aGF0IHdlIGRvbid0IHN0YXJ0IGEgbmV3IGxvYWQgZm9yIGN1cnJlbnRseSBsb2FkaW5nIGZpbGUuXG4gIHByaXZhdGUgY3VycmVudGx5TG9hZGluZ0lkczogc3RyaW5nW10gPSBbXVxuXG4gIC8vIFRoZSBVVUlEIHRvIGN1cnJlbnQgc3RhdHVzIGVsZW1lbnQgbWFwcGluZ1xuICBwcml2YXRlIHN0YXR1c0VsZW1lbnRNYXBwaW5nOiBFbGVtZW50U3RhdHVzTWFwcGluZyA9IHt9XG4gIHByaXZhdGUgcmVhZG9ubHkgZmlsZVR5cGVUb0VsZW1lbnRUeXBlOiBGaWxlVHlwZXMgPSB7XG4gICAgJ2ltYWdlL3BuZyc6ICdpbWcnLFxuICAgICdpbWFnZS9qcGcnOiAnaW1nJyxcbiAgICAnaW1hZ2UvanBlZyc6ICdpbWcnLFxuICAgICdpbWFnZS9naWYnOiAnaW1nJyxcbiAgICAnaW1hZ2UvdGlmZic6ICdpbWcnLFxuICAgICdpbWFnZS9ibXAnOiAnaW1nJyxcbiAgICAndmlkZW8vbXA0JzogJ3ZpZGVvJyxcbiAgICAnYXVkaW8vbXBlZyc6ICdhdWRpbycsXG4gICAgJ2F1ZGlvL21wMyc6ICdhdWRpbydcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgb3B0aW9uczogRmlsZUxvYWRlck9wdGlvbnMpIHsgfVxuXG4gIHB1YmxpYyBmaWxlVHlwZUZvckVsZW1lbnRUeXBlKHR5cGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZmlsZVR5cGVUb0VsZW1lbnRUeXBlW3R5cGUudG9Mb3dlckNhc2UoKV1cbiAgfVxuXG4gIC8qKlxuICAgKiBTY2FucyB0aGUgZG9jdW1lbnQgZm9yIGVsZW1lbnRzIDxmaWxlU2FmZT4uIElmIGZvdW5kLCBiZWdpbnMgbG9hZGluZyBmaWxlLlxuICAgKi9cbiAgcHVibGljIGxvYWRGaWxlU2FmZUVsZW1lbnRzKCk6IHZvaWQge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gdGhpcy5vcHRpb25zLmdldEVsZW1lbnRzQnlTZWxlY3RvcignKltmc3BsYWNlaG9sZGVyXScpXG4gICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgICB0aGlzLmxvYWRGaWxlU2FmZUVsZW1lbnQoZWxlbWVudClcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgbG9hZEZpbGVTYWZlRWxlbWVudChmc0VsZW1lbnQ6IEVsZW1lbnQpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB7IGZpbGVTYWZlSW5zdGFuY2UgfSA9IHRoaXMub3B0aW9uc1xuXG4gICAgY29uc3QgZnNpZCA9IGZzRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2ZzaWQnKVxuICAgIGNvbnN0IGZzTmFtZSA9IGZzRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2ZzTmFtZScpID8/ICcnXG4gICAgY29uc3QgZmlsZU5hbWVEaXNwbGF5ID0gKCFmc05hbWUgfHwgZnNOYW1lID09ICd1bmRlZmluZWQnKSA/ICdmaWxlJyA6IGZzTmFtZVxuXG4gICAgaWYgKCFmc2lkKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBjb25zdCBleGlzdGluZ01hcHBpbmcgPSB0aGlzLnV1aWRUb0ZpbGVUZW1wVXJsQW5kVHlwZU1hcHBpbmdbZnNpZF1cblxuICAgIGlmIChleGlzdGluZ01hcHBpbmcpIHtcbiAgICAgIHRoaXMuaW5zZXJ0TWVkaWFFbGVtZW50KHtcbiAgICAgICAgZnNpZCxcbiAgICAgICAgZnNFbGVtZW50LFxuICAgICAgICB1cmw6IGV4aXN0aW5nTWFwcGluZy51cmwsXG4gICAgICAgIGZpbGVUeXBlOiBleGlzdGluZ01hcHBpbmcuZmlsZVR5cGUsXG4gICAgICAgIGZzTmFtZTogZXhpc3RpbmdNYXBwaW5nLmZzTmFtZVxuICAgICAgfSlcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGlmICh0aGlzLmN1cnJlbnRseUxvYWRpbmdJZHMuaW5jbHVkZXMoZnNpZCkpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBmaWxlU2FmZUluc3RhbmNlLmZpbmRGaWxlRGVzY3JpcHRvcihmc2lkKVxuXG4gICAgaWYgKCFkZXNjcmlwdG9yKSB7XG4gICAgICB0aGlzLnNldFN0YXR1cyh7XG4gICAgICAgIGZzRWxlbWVudCxcbiAgICAgICAgZnNpZCxcbiAgICAgICAgc3RhdHVzOiBgVW5hYmxlIHRvIGZpbmQgJHtmaWxlTmFtZURpc3BsYXl9ICR7ZnNpZH0uYCxcbiAgICAgICAgcmVtb3ZhYmxlOiB0cnVlXG4gICAgICB9KVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgY29uc3Qgc2VsZWN0b3JTeW50YXggPSBgW2ZzaWQ9XCIke2Rlc2NyaXB0b3IudXVpZH1cIl1bZnNjb2xsYXBzYWJsZV1gXG4gICAgY29uc3QgZXhpc3RpbmdFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBgaW1nJHtzZWxlY3RvclN5bnRheH0sIGZpZ3VyZSR7c2VsZWN0b3JTeW50YXh9LCB2aWRlbyR7c2VsZWN0b3JTeW50YXh9LCBhdWRpbyR7c2VsZWN0b3JTeW50YXh9YFxuICAgIClcblxuICAgIGlmIChleGlzdGluZ0VsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB0aGlzLmN1cnJlbnRseUxvYWRpbmdJZHMuc3BsaWNlKHRoaXMuY3VycmVudGx5TG9hZGluZ0lkcy5pbmRleE9mKGZzaWQpLCAxKVxuXG4gICAgdGhpcy5jdXJyZW50bHlMb2FkaW5nSWRzLnB1c2goZnNpZClcbiAgICB0aGlzLnNldFN0YXR1cyh7XG4gICAgICBmc0VsZW1lbnQsXG4gICAgICBmc2lkLFxuICAgICAgc3RhdHVzOiBgRG93bmxvYWRpbmcgJHtmaWxlTmFtZURpc3BsYXl9Li4uYFxuICAgIH0pXG5cbiAgICAgLy8gQWxsb3cgVUkgdG8gdXBkYXRlIGJlZm9yZSBiZWdpbm5pbmcgZG93bmxvYWQuLi5cbiAgICBhd2FpdCBzbGVlcCgwLjA1KVxuXG4gICAgY29uc3QgZmlsZUl0ZW0gPSBhd2FpdCBmaWxlU2FmZUluc3RhbmNlLmRvd25sb2FkRmlsZUZyb21EZXNjcmlwdG9yKGRlc2NyaXB0b3IpLmNhdGNoKCgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdHVzKHtcbiAgICAgICAgZnNFbGVtZW50LFxuICAgICAgICBmc2lkLFxuICAgICAgICBzdGF0dXM6IGBVbmFibGUgdG8gZG93bmxvYWQgJHtmaWxlTmFtZURpc3BsYXl9ICR7ZnNpZH0uYFxuICAgICAgfSlcbiAgICAgIHJldHVyblxuICAgIH0pXG5cbiAgICBpZiAoIWZpbGVJdGVtKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXR1cyh7XG4gICAgICBmc0VsZW1lbnQsXG4gICAgICBmc2lkLFxuICAgICAgc3RhdHVzOiBgRGVjcnlwdGluZyAke2ZpbGVOYW1lRGlzcGxheX0uLi5gXG4gICAgfSlcblxuICAgIC8vIEFsbG93IFVJIHRvIHVwZGF0ZSBiZWZvcmUgYmVnaW5uaW5nIGRlY3J5cHRpb25cbiAgICBhd2FpdCBzbGVlcCgwLjA1KVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGZpbGVTYWZlSW5zdGFuY2UuZGVjcnlwdEZpbGUoeyBmaWxlRGVzY3JpcHRvcjogZGVzY3JpcHRvciwgZmlsZUl0ZW0gfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0dXMoe1xuICAgICAgICBmc0VsZW1lbnQsXG4gICAgICAgIGZzaWQsXG4gICAgICAgIHN0YXR1czogYFVuYWJsZSB0byBkZWNyeXB0ICR7ZmlsZU5hbWVEaXNwbGF5fSAke2ZzaWR9LmBcbiAgICAgIH0pXG4gICAgICByZXR1cm5cbiAgICB9KVxuXG4gICAgaWYgKCFkYXRhKSB7XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgbG9hZGluZyB0ZXh0XG4gICAgdGhpcy5zZXRTdGF0dXMoe1xuICAgICAgZnNFbGVtZW50LFxuICAgICAgZnNpZFxuICAgIH0pXG5cbiAgICAvLyBBbGxvdyBVSSB0byB1cGRhdGUgYmVmb3JlIGFkZGluZyBpbWFnZVxuICAgIGF3YWl0IHNsZWVwKDAuMDUpXG5cbiAgICAvLyBHZW5lcmF0ZSB0ZW1wb3JhcnkgdXJsLCBtdXN0IGJlIHJlbGVhc2VkIGxhdGVyXG4gICAgY29uc3QgZmlsZVR5cGUgPSBkZXNjcmlwdG9yLmNvbnRlbnQuZmlsZVR5cGVcbiAgICBjb25zdCB0ZW1wVXJsID0gZmlsZVNhZmVJbnN0YW5jZS5jcmVhdGVUZW1wb3JhcnlGaWxlVXJsKHtcbiAgICAgIGJhc2U2NERhdGE6IGRhdGEuZGVjcnlwdGVkRGF0YSxcbiAgICAgIGRhdGFUeXBlOiBmaWxlVHlwZVxuICAgIH0pXG5cbiAgICB0aGlzLmluc2VydE1lZGlhRWxlbWVudCh7XG4gICAgICBmc2lkLCBmaWxlVHlwZSxcbiAgICAgIGZzTmFtZSxcbiAgICAgIGZzRWxlbWVudCxcbiAgICAgIHVybDogdGVtcFVybFxuICAgIH0pXG5cbiAgICBjbGVhbnVwKClcblxuICAgIHRoaXMudXVpZFRvRmlsZVRlbXBVcmxBbmRUeXBlTWFwcGluZ1tmc2lkXSA9IHtcbiAgICAgIGZpbGVUeXBlLFxuICAgICAgdXJsOiB0ZW1wVXJsLFxuICAgICAgZnNOYW1lLFxuICAgIH1cblxuICAgIHJldHVybiB0cnVlXG4gIH1cblxuICBwcml2YXRlIGluc2VydE1lZGlhRWxlbWVudCh7IHVybCwgZnNpZCwgZnNOYW1lLCBmaWxlVHlwZSwgZnNFbGVtZW50IH06IEluc2VydE1lZGlhRWxlbWVudFBhcmFtcykge1xuICAgIGNvbnN0IGVsZW1lbnRUeXBlID0gdGhpcy5maWxlVHlwZUZvckVsZW1lbnRUeXBlKGZpbGVUeXBlKVxuXG4gICAgbGV0IG1lZGlhRWxlbWVudDogRWxlbWVudFxuICAgIFxuICAgIHN3aXRjaCAoZWxlbWVudFR5cGUpIHtcbiAgICAgIGNhc2UgJ2ltZyc6XG4gICAgICAgIG1lZGlhRWxlbWVudCA9IHRoaXMuY3JlYXRlSW1hZ2VFbGVtZW50KHsgdXJsLCBmc2lkLCBmc05hbWUsIGZzRWxlbWVudCB9KVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAndmlkZW8nOlxuICAgICAgICBtZWRpYUVsZW1lbnQgPSB0aGlzLmNyZWF0ZVZpZGVvRWxlbWVudCh7IHVybCwgZnNpZCwgZmlsZVR5cGUsIGZzTmFtZSwgZnNFbGVtZW50IH0pXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdhdWRpbyc6XG4gICAgICAgIG1lZGlhRWxlbWVudCA9IHRoaXMuY3JlYXRlQXVkaW9FbGVtZW50KHsgdXJsLCBmc2lkLCBmc05hbWUgfSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG1lZGlhRWxlbWVudCA9IHRoaXMuY3JlYXRlRG93bmxvYWRFbGVtZW50KHsgdXJsLCBmc2lkLCBmc05hbWUgfSlcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICB0aGlzLmluc2VydEVsZW1lbnROZWFyRWxlbWVudChtZWRpYUVsZW1lbnQsIGZzRWxlbWVudClcblxuICAgIC8vIFJlbW92ZSBmc0VsZW1lbnQgbm93IHRoYXQgaW1hZ2UgaXMgbG9hZGVkLlxuICAgIGZzRWxlbWVudC5yZW1vdmUoKVxuICB9XG5cbiAgcHJpdmF0ZSB3cmFwRWxlbWVudEluVGFnKHsgZWxlbWVudCwgdGFnTmFtZSwgZnNpZCwgZnNOYW1lIH06IFdyYXBFbGVtZW50SW5UYWdQYXJhbXMpIHtcbiAgICBjb25zdCB0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpXG4gICAgdGFnLnNldEF0dHJpYnV0ZSgnZnNpZCcsIGZzaWQpXG4gICAgdGFnLnNldEF0dHJpYnV0ZSgnZnNOYW1lJywgZnNOYW1lKVxuICAgIHRhZy5zZXRBdHRyaWJ1dGUoJ2ZzY29sbGFwc2FibGUnLCAndHJ1ZScpXG4gICAgdGFnLnNldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgJ3RydWUnKVxuICAgIHRhZy5hcHBlbmQoZWxlbWVudClcbiAgICByZXR1cm4gdGFnXG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUltYWdlRWxlbWVudCh7IHVybCwgZnNpZCwgZnNOYW1lLCBmc0VsZW1lbnQgfTogQ3JlYXRlSW1hZ2VFbGVtZW50UGFyYW1zKTogSFRNTEltYWdlRWxlbWVudCB7XG4gICAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKVxuICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKVxuICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYCR7dXJsfSAyeGApXG5cbiAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2ZzaWQnLCBmc2lkKVxuICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnZnNOYW1lJywgZnNOYW1lKVxuICAgIGltYWdlLnNldEF0dHJpYnV0ZSgnZnNjb2xsYXBzYWJsZScsICd0cnVlJylcblxuICAgIGNvbnN0IGVsZW1lbnRXaWR0aCA9IGZzRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3dpZHRoJylcbiAgICBpZiAoZWxlbWVudFdpZHRoKSB7XG4gICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgZWxlbWVudFdpZHRoKVxuICAgIH1cblxuICAgIGNvbnN0IGVsZW1lbnRIZWlnaHQgPSBmc0VsZW1lbnQuZ2V0QXR0cmlidXRlKCdoZWlnaHQnKVxuICAgIGlmIChlbGVtZW50SGVpZ2h0KSB7XG4gICAgICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGVsZW1lbnRIZWlnaHQpXG4gICAgfVxuXG4gICAgcmV0dXJuIGltYWdlXG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVZpZGVvRWxlbWVudCh7IHVybCwgZnNpZCwgZmlsZVR5cGUsIGZzTmFtZSwgZnNFbGVtZW50IH06IENyZWF0ZVZpZGVvRWxlbWVudFBhcmFtcykge1xuICAgIGNvbnN0IHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKVxuICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgnY29udHJvbHMnLCAndHJ1ZScpXG4gICAgdmlkZW8uc2V0QXR0cmlidXRlKCdmc2lkJywgZnNpZClcbiAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ2ZzTmFtZScsIGZzTmFtZSlcbiAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ2ZzY29sbGFwc2FibGUnLCAndHJ1ZScpXG5cbiAgICBjb25zdCBlbGVtZW50V2lkdGggPSBmc0VsZW1lbnQuZ2V0QXR0cmlidXRlKCd3aWR0aCcpXG4gICAgaWYgKGVsZW1lbnRXaWR0aCkge1xuICAgICAgdmlkZW8uc2V0QXR0cmlidXRlKCd3aWR0aCcsIGVsZW1lbnRXaWR0aClcbiAgICB9XG5cbiAgICBjb25zdCBlbGVtZW50SGVpZ2h0ID0gZnNFbGVtZW50LmdldEF0dHJpYnV0ZSgnaGVpZ2h0JylcbiAgICBpZiAoZWxlbWVudEhlaWdodCkge1xuICAgICAgdmlkZW8uc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBlbGVtZW50SGVpZ2h0KVxuICAgIH1cblxuICAgIGNvbnN0IHNvdXJjZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpXG4gICAgc291cmNlLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKVxuICAgIHNvdXJjZS5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCBmaWxlVHlwZSlcbiAgICB2aWRlby5hcHBlbmQoc291cmNlKVxuXG4gICAgLyoqXG4gICAgICogUmVkYWN0b3Igd2lsbCBhdXRvbWF0aWNhbGx5IGluc2VydCBhIHZpZGVvIGVsZW1lbnQgaW4gYSBwIHRhZyxcbiAgICAgKiBzbyB3ZSdsbCBkbyBpdCBvdXJzZWx2ZXMgc28gdGhhdCB3ZSBjYW4gY29udHJvbCBpdHMgYXR0cmlidXRlcy5cbiAgICAgKi9cbiAgICByZXR1cm4gdGhpcy53cmFwRWxlbWVudEluVGFnKHtcbiAgICAgIGZzaWQsXG4gICAgICBmc05hbWUsXG4gICAgICBlbGVtZW50OiB2aWRlbyxcbiAgICAgIHRhZ05hbWU6ICdwJ1xuICAgIH0pXG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZURvd25sb2FkRWxlbWVudCh7IHVybCwgZnNpZCwgZnNOYW1lIH06IENyZWF0ZURvd25sb2FkRWxlbWVudFBhcmFtcykge1xuICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJylcbiAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZnNpZCcsIGZzaWQpXG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ2ZzTmFtZScsIGZzTmFtZSlcbiAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZ2hvc3QnLCAndHJ1ZScpXG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ2ZzY29sbGFwc2FibGUnLCAndHJ1ZScpXG4gICAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmwpXG4gICAgbGluay50ZXh0Q29udGVudCA9IGAke2ZzTmFtZX1gXG4gICAgcmV0dXJuIGxpbmtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQXVkaW9FbGVtZW50KHsgdXJsLCBmc2lkLCBmc05hbWUgfTogQ3JlYXRlQXVkaW9FbGVtZW50UGFyYW1zKSB7XG4gICAgY29uc3QgYXVkaW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhdWRpbycpXG4gICAgYXVkaW8uc2V0QXR0cmlidXRlKCdzcmMnLCB1cmwpXG4gICAgYXVkaW8uc2V0QXR0cmlidXRlKCdjb250cm9scycsICd0cnVlJylcbiAgICBhdWRpby5zZXRBdHRyaWJ1dGUoJ2ZzaWQnLCBmc2lkKVxuICAgIGF1ZGlvLnNldEF0dHJpYnV0ZSgnZnNOYW1lJywgZnNOYW1lKVxuICAgIGF1ZGlvLnNldEF0dHJpYnV0ZSgnZnNjb2xsYXBzYWJsZScsICd0cnVlJylcblxuICAgIHJldHVybiB0aGlzLndyYXBFbGVtZW50SW5UYWcoe1xuICAgICAgZnNpZCxcbiAgICAgIGZzTmFtZSxcbiAgICAgIGVsZW1lbnQ6IGF1ZGlvLFxuICAgICAgdGFnTmFtZTogJ3AnXG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgc2V0U3RhdHVzKHsgc3RhdHVzLCBmc0VsZW1lbnQsIGZzaWQsIHJlbW92YWJsZSA9IGZhbHNlIH06IFNldFN0YXR1c1BhcmFtcyk6IEVsZW1lbnQgfCB2b2lkIHtcbiAgICBpZiAoZnNpZCkge1xuICAgICAgY29uc3QgZXhpc3RpbmdTdGF0dXNFbGVtZW50ID0gdGhpcy5zdGF0dXNFbGVtZW50TWFwcGluZ1tmc2lkXVxuXG4gICAgICBpZiAoZXhpc3RpbmdTdGF0dXNFbGVtZW50KSB7XG4gICAgICAgIGV4aXN0aW5nU3RhdHVzRWxlbWVudC5yZW1vdmUoKVxuICAgICAgICBkZWxldGUgdGhpcy5zdGF0dXNFbGVtZW50TWFwcGluZ1tmc2lkXVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdGF0dXMpIHtcbiAgICAgIGxldCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKVxuXG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnaWQnLCBmc2lkKVxuICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2dob3N0JywgJ3RydWUnKVxuICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsICdmYWxzZScpXG4gICAgICBlbGVtZW50LnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCdcbiAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSBzdGF0dXNcblxuICAgICAgaWYgKHJlbW92YWJsZSkge1xuICAgICAgICBlbGVtZW50LnN0eWxlLnVzZXJTZWxlY3QgPSAnYWxsJ1xuICAgICAgfVxuXG4gICAgICBlbGVtZW50ID0gdGhpcy5pbnNlcnRFbGVtZW50TmVhckVsZW1lbnQoZWxlbWVudCwgZnNFbGVtZW50KSBhcyBIVE1MTGFiZWxFbGVtZW50XG5cbiAgICAgIGlmIChmc2lkKSB7XG4gICAgICAgIHRoaXMuc3RhdHVzRWxlbWVudE1hcHBpbmdbZnNpZF0gPSBlbGVtZW50XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbGVtZW50XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGluc2VydFN0YXR1c0F0Q3Vyc29yKHN0YXR1czogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBpZGVudGlmaWVyID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDcpXG4gICAgdGhpcy5zZXRTdGF0dXMoe1xuICAgICAgc3RhdHVzLFxuICAgICAgZnNpZDogaWRlbnRpZmllcixcbiAgICAgIGZzRWxlbWVudDogbnVsbFxuICAgIH0pXG4gICAgcmV0dXJuIGlkZW50aWZpZXJcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVDdXJzb3JTdGF0dXMoaWRlbnRpZmllcjogc3RyaW5nKTogdm9pZCB7XG4gICAgLyoqXG4gICAgICogV2Ugd2FudCB0byBzZWFyY2ggZm9yIHRoZSBlbGVtZW50IGJhc2VkIG9uIGlkZW50aWZpZXIsIGJlY2F1c2UgdGhlIGFjdHVhbCBlbGVtZW50XG4gICAgICogaW5zZXJ0ZWQgbWF5IGhhdmUgYmVlbiBkb25lIHNvIGFzIHJhdyBIVE1MLCBhbmQgbm90IHZpYSBhbiBlbGVtZW50IHBvaW50ZXIuXG4gICAgICovXG4gICAgY29uc3QgZWxlbWVudHMgPSB0aGlzLm9wdGlvbnMuZ2V0RWxlbWVudHNCeVNlbGVjdG9yKGAjJHtpZGVudGlmaWVyfWApXG5cbiAgICBpZiAoZWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgZWxlbWVudHNbMF0ucmVtb3ZlKClcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaW5zZXJ0RWxlbWVudE5lYXJFbGVtZW50KGRvbU5vZGVUb0luc2VydDogRWxlbWVudCwgaW5WaWNpbml0eU9mRWxlbWVudDogRWxlbWVudCB8IG51bGwpOiBFbGVtZW50IHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBwcm9jZXNzZWRFbGVtZW50ID0gdGhpcy5vcHRpb25zLnByZXByb2Nlc3NFbGVtZW50KGRvbU5vZGVUb0luc2VydClcbiAgICBsZXQgaW5zZXJ0aW9uVHlwZSA9ICdjaGlsZCdcblxuICAgIC8vIDxmaWd1cmU+IHRhZ3MgY2Fubm90IGJlIG5lc3RlZCBpbnNpZGUgcCB0YWdzLlxuICAgIGlmIChpblZpY2luaXR5T2ZFbGVtZW50ICYmIHByb2Nlc3NlZEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICdmaWd1cmUnKSB7XG4gICAgICAvLyBJZiB3ZSBoYXZlIGEgcCBhbmNlc3Rvciwgd2UgbmVlZCB0byBnZXQgb3V0LlxuICAgICAgY29uc3QgcGFyYWdyYXBoQW5jZXN0b3IgPSBpblZpY2luaXR5T2ZFbGVtZW50LmNsb3Nlc3QoJ3AnKVxuXG4gICAgICBpZiAocGFyYWdyYXBoQW5jZXN0b3IpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHAgdGFncyBjYW5ub3QgYmUgbmVzdGVkIGluIG90aGVyIHAgdGFncywgc28gaWYgd2UgZm91bmQgb25lLCB3ZSBrbm93IGl0cyBwYXJlbnQgaXNuJ3QgYW5kIGRvZXNuJ3QgYmVsb25nIHRvIGEgcCB0YWcuXG4gICAgICAgICAqIEFkZCB0aGUgbmV3IG9uZSByaWdodCBhZnRlciBwYXJhZ3JhcGhBbmNlc3Rvci5cbiAgICAgICAgICovXG4gICAgICAgIGluVmljaW5pdHlPZkVsZW1lbnQgPSBwYXJhZ3JhcGhBbmNlc3RvclxuICAgICAgICBpbnNlcnRpb25UeXBlID0gJ2FmdGVyZW5kJ1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMub3B0aW9ucy5pbnNlcnRFbGVtZW50KHByb2Nlc3NlZEVsZW1lbnQsIGluVmljaW5pdHlPZkVsZW1lbnQsIGluc2VydGlvblR5cGUpXG4gICAgcmV0dXJuIHByb2Nlc3NlZEVsZW1lbnQgYXMgRWxlbWVudFxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBMEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBY0E7QUFBQTtBQUNBO0FBREE7QUFDQTtBQURBO0FBQ0E7QUFEQTtBQUNBO0FBREE7QUFYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBTUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFPQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVpBO0FBQ0E7QUFjQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5V0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/fileLoader.ts\n")},"./src/fileSafeHtml.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval("/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"FileSafeSyntaxPattern\": () => (/* binding */ FileSafeSyntaxPattern),\n/* harmony export */   \"expandedFileSafeSyntax\": () => (/* binding */ expandedFileSafeSyntax),\n/* harmony export */   \"removeFileSafeSyntaxFromHtml\": () => (/* binding */ removeFileSafeSyntaxFromHtml),\n/* harmony export */   \"insertionSyntaxForFileDescriptor\": () => (/* binding */ insertionSyntaxForFileDescriptor),\n/* harmony export */   \"collapseFileSafeSyntax\": () => (/* binding */ collapseFileSafeSyntax)\n/* harmony export */ });\n/* unused harmony export fileSafeSyntaxToHtmlElement */\n/**\n * Remove matching <p> tags if present.\n * Also capable of matching adjacent [fsSyntax][fsSyntax]\n */\nconst FileSafeSyntaxPattern = /(<p>)?\\[FileSafe[^\\]]*\\](<\\/p>)?/g;\n/**\n * Given an HTML string that includes substrings matching `FileSafeSyntaxPattern`,\n * replace occurences with ghost div element <fileSafe uuid='123'>\n */\n\nconst expandedFileSafeSyntax = html => {\n  return html.replace(FileSafeSyntaxPattern, match => {\n    return fileSafeSyntaxToHtmlElement(match);\n  });\n};\nconst removeFileSafeSyntaxFromHtml = html => {\n  return html.replace(FileSafeSyntaxPattern, _match => {\n    return '';\n  });\n};\nconst insertionSyntaxForFileDescriptor = descriptor => {\n  return \"[FileSafe:\".concat(descriptor.uuid, \":\").concat(descriptor.content.fileName, \"]\");\n};\nconst fileSafeSyntaxToHtmlElement = syntax => {\n  // Remove paragraph tags\n  syntax = syntax.replace('<p>', '');\n  syntax = syntax.replace('</p>', ''); // Remove brackets\n\n  syntax = syntax.replace('[', '').replace(']', '');\n  const components = syntax.split(':');\n  const uuid = components[1];\n  const name = components[2];\n  const size = components[3];\n  let sizeString = '';\n\n  if (size) {\n    const dimensions = size.split('x');\n    sizeString = \"width=\".concat(dimensions[0], \" height=\").concat(dimensions[1]);\n  }\n  /**\n   * We use a p tag here because if we try something custom, like `fileSafe` tag, the editor will automatically\n   * wrap it in a p tag, causing littered p tags remaining in the plaintext representation.\n   */\n\n\n  return \"<p fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid='\".concat(uuid, \"' fsname='\").concat(name, \"' \").concat(sizeString, \"></p>\");\n};\n/**\n * Given a rendered HTML string, replace all <fileSafe> items with [FileSafe:UUID] plaintext items.\n * Also, for any elements that have the 'ghost' attribute, remove it from the resulting string.\n */\n\nconst collapseFileSafeSyntax = html => {\n  const domCopy = new DOMParser().parseFromString(html, 'text/html'); // Elements that have fscollapsable means they should be collapsed to plain syntax.\n\n  const mediaElements = domCopy.querySelectorAll('*[fscollapsable]');\n\n  for (const file of mediaElements) {\n    const uuid = file.getAttribute('fsid');\n    const name = file.getAttribute('fsname');\n    const width = file.getAttribute('width');\n    const height = file.getAttribute('height');\n    const components = ['FileSafe', uuid, name];\n\n    if (width && height) {\n      const size = \"\".concat(width, \"x\").concat(height);\n      components.push(size);\n    }\n\n    const fsSyntax = \"<p>[\".concat(components.join(':'), \"]</p>\");\n    file.insertAdjacentHTML('afterend', fsSyntax);\n    file.remove();\n  } // Remove any remaining ghost elements.\n\n\n  const ghosts = domCopy.querySelectorAll('*[ghost]');\n  ghosts.forEach(ghost => ghost.remove());\n  return domCopy.body.innerHTML;\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZmlsZVNhZmVIdG1sLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vRWRpdG9yS2l0Ly4vc3JjL2ZpbGVTYWZlSHRtbC50cz8zNGY1Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIEZpbGVTYWZlRmlsZU1ldGFkYXRhID0ge1xuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbi8qKlxuICogUmVtb3ZlIG1hdGNoaW5nIDxwPiB0YWdzIGlmIHByZXNlbnQuXG4gKiBBbHNvIGNhcGFibGUgb2YgbWF0Y2hpbmcgYWRqYWNlbnQgW2ZzU3ludGF4XVtmc1N5bnRheF1cbiAqL1xuZXhwb3J0IGNvbnN0IEZpbGVTYWZlU3ludGF4UGF0dGVybiA9IC8oPHA+KT9cXFtGaWxlU2FmZVteXFxdXSpcXF0oPFxcL3A+KT8vZ1xuXG4vKipcbiAqIEdpdmVuIGFuIEhUTUwgc3RyaW5nIHRoYXQgaW5jbHVkZXMgc3Vic3RyaW5ncyBtYXRjaGluZyBgRmlsZVNhZmVTeW50YXhQYXR0ZXJuYCxcbiAqIHJlcGxhY2Ugb2NjdXJlbmNlcyB3aXRoIGdob3N0IGRpdiBlbGVtZW50IDxmaWxlU2FmZSB1dWlkPScxMjMnPlxuICovXG5leHBvcnQgY29uc3QgZXhwYW5kZWRGaWxlU2FmZVN5bnRheCA9IChodG1sOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICByZXR1cm4gaHRtbC5yZXBsYWNlKEZpbGVTYWZlU3ludGF4UGF0dGVybiwgKG1hdGNoKSA9PiB7XG4gICAgcmV0dXJuIGZpbGVTYWZlU3ludGF4VG9IdG1sRWxlbWVudChtYXRjaClcbiAgfSlcbn1cblxuZXhwb3J0IGNvbnN0IHJlbW92ZUZpbGVTYWZlU3ludGF4RnJvbUh0bWwgPSAoaHRtbDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGh0bWwucmVwbGFjZShGaWxlU2FmZVN5bnRheFBhdHRlcm4sIChfbWF0Y2gpID0+IHtcbiAgICByZXR1cm4gJydcbiAgfSlcbn1cblxuZXhwb3J0IGNvbnN0IGluc2VydGlvblN5bnRheEZvckZpbGVEZXNjcmlwdG9yID0gKGRlc2NyaXB0b3I6IEZpbGVTYWZlRmlsZU1ldGFkYXRhKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGBbRmlsZVNhZmU6JHtkZXNjcmlwdG9yLnV1aWR9OiR7ZGVzY3JpcHRvci5jb250ZW50LmZpbGVOYW1lfV1gXG59XG5cbmV4cG9ydCBjb25zdCBmaWxlU2FmZVN5bnRheFRvSHRtbEVsZW1lbnQgPSAoc3ludGF4OiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAvLyBSZW1vdmUgcGFyYWdyYXBoIHRhZ3NcbiAgc3ludGF4ID0gc3ludGF4LnJlcGxhY2UoJzxwPicsICcnKVxuICBzeW50YXggPSBzeW50YXgucmVwbGFjZSgnPC9wPicsICcnKVxuXG4gIC8vIFJlbW92ZSBicmFja2V0c1xuICBzeW50YXggPSBzeW50YXgucmVwbGFjZSgnWycsICcnKS5yZXBsYWNlKCddJywgJycpXG5cbiAgY29uc3QgY29tcG9uZW50cyA9IHN5bnRheC5zcGxpdCgnOicpXG4gIGNvbnN0IHV1aWQgPSBjb21wb25lbnRzWzFdXG4gIGNvbnN0IG5hbWUgPSBjb21wb25lbnRzWzJdXG4gIGNvbnN0IHNpemUgPSBjb21wb25lbnRzWzNdXG5cbiAgbGV0IHNpemVTdHJpbmcgPSAnJ1xuXG4gIGlmIChzaXplKSB7XG4gICAgY29uc3QgZGltZW5zaW9ucyA9IHNpemUuc3BsaXQoJ3gnKVxuICAgIHNpemVTdHJpbmcgPSBgd2lkdGg9JHtkaW1lbnNpb25zWzBdfSBoZWlnaHQ9JHtkaW1lbnNpb25zWzFdfWBcbiAgfVxuXG4gIC8qKlxuICAgKiBXZSB1c2UgYSBwIHRhZyBoZXJlIGJlY2F1c2UgaWYgd2UgdHJ5IHNvbWV0aGluZyBjdXN0b20sIGxpa2UgYGZpbGVTYWZlYCB0YWcsIHRoZSBlZGl0b3Igd2lsbCBhdXRvbWF0aWNhbGx5XG4gICAqIHdyYXAgaXQgaW4gYSBwIHRhZywgY2F1c2luZyBsaXR0ZXJlZCBwIHRhZ3MgcmVtYWluaW5nIGluIHRoZSBwbGFpbnRleHQgcmVwcmVzZW50YXRpb24uXG4gICAqL1xuICByZXR1cm4gYDxwIGZzcGxhY2Vob2xkZXI9dHJ1ZSBzdHlsZT0nZGlzcGxheTogbm9uZTsnIGZzY29sbGFwc2FibGU9dHJ1ZSBnaG9zdD10cnVlIGZzaWQ9JyR7dXVpZH0nIGZzbmFtZT0nJHtuYW1lfScgJHtzaXplU3RyaW5nfT48L3A+YFxufVxuXG4vKipcbiAqIEdpdmVuIGEgcmVuZGVyZWQgSFRNTCBzdHJpbmcsIHJlcGxhY2UgYWxsIDxmaWxlU2FmZT4gaXRlbXMgd2l0aCBbRmlsZVNhZmU6VVVJRF0gcGxhaW50ZXh0IGl0ZW1zLlxuICogQWxzbywgZm9yIGFueSBlbGVtZW50cyB0aGF0IGhhdmUgdGhlICdnaG9zdCcgYXR0cmlidXRlLCByZW1vdmUgaXQgZnJvbSB0aGUgcmVzdWx0aW5nIHN0cmluZy5cbiAqL1xuZXhwb3J0IGNvbnN0IGNvbGxhcHNlRmlsZVNhZmVTeW50YXggPSAoaHRtbDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgY29uc3QgZG9tQ29weSA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgJ3RleHQvaHRtbCcpXG5cbiAgLy8gRWxlbWVudHMgdGhhdCBoYXZlIGZzY29sbGFwc2FibGUgbWVhbnMgdGhleSBzaG91bGQgYmUgY29sbGFwc2VkIHRvIHBsYWluIHN5bnRheC5cbiAgY29uc3QgbWVkaWFFbGVtZW50cyA9IGRvbUNvcHkucXVlcnlTZWxlY3RvckFsbCgnKltmc2NvbGxhcHNhYmxlXScpXG5cbiAgZm9yIChjb25zdCBmaWxlIG9mIG1lZGlhRWxlbWVudHMpIHtcbiAgICBjb25zdCB1dWlkID0gZmlsZS5nZXRBdHRyaWJ1dGUoJ2ZzaWQnKVxuICAgIGNvbnN0IG5hbWUgPSBmaWxlLmdldEF0dHJpYnV0ZSgnZnNuYW1lJylcbiAgICBjb25zdCB3aWR0aCA9IGZpbGUuZ2V0QXR0cmlidXRlKCd3aWR0aCcpXG4gICAgY29uc3QgaGVpZ2h0ID0gZmlsZS5nZXRBdHRyaWJ1dGUoJ2hlaWdodCcpXG5cbiAgICBjb25zdCBjb21wb25lbnRzID0gWydGaWxlU2FmZScsIHV1aWQsIG5hbWVdXG5cbiAgICBpZiAod2lkdGggJiYgaGVpZ2h0KSB7XG4gICAgICBjb25zdCBzaXplID0gYCR7d2lkdGh9eCR7aGVpZ2h0fWBcbiAgICAgIGNvbXBvbmVudHMucHVzaChzaXplKVxuICAgIH1cblxuICAgIGNvbnN0IGZzU3ludGF4ID0gYDxwPlske2NvbXBvbmVudHMuam9pbignOicpfV08L3A+YFxuICAgIGZpbGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdhZnRlcmVuZCcsIGZzU3ludGF4KVxuICAgIGZpbGUucmVtb3ZlKClcbiAgfVxuXG4gIC8vIFJlbW92ZSBhbnkgcmVtYWluaW5nIGdob3N0IGVsZW1lbnRzLlxuICBjb25zdCBnaG9zdHMgPSBkb21Db3B5LnF1ZXJ5U2VsZWN0b3JBbGwoJypbZ2hvc3RdJylcbiAgZ2hvc3RzLmZvckVhY2goKGdob3N0KSA9PiBnaG9zdC5yZW1vdmUoKSlcblxuICByZXR1cm4gZG9tQ29weS5ib2R5LmlubmVySFRNTFxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/fileSafeHtml.ts\n")},"./src/textExpander.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (/* binding */ TextExpander)\n/* harmony export */ });\nclass TextExpander {\n  constructor(options) {\n    this.options = options;\n  }\n\n  onKeyUp(_ref) {\n    let {\n      isEnter,\n      isPaste,\n      isSpace\n    } = _ref;\n\n    if (isEnter || isPaste || isSpace) {\n      this.searchPatterns({\n        searchPreviousLine: isEnter !== null && isEnter !== void 0 ? isEnter : false\n      });\n    }\n  }\n\n  searchPatterns() {\n    let params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      searchPreviousLine: false\n    };\n    const text = params.searchPreviousLine ? this.options.getPreviousLineText() : this.options.getCurrentLineText();\n\n    for (const pattern of this.options.patterns) {\n      const match = pattern.regex.exec(text);\n      if (!match) continue;\n      const matchedText = match[0];\n\n      if (matchedText) {\n        const replaceWith = pattern.callback(matchedText);\n        this.replaceSelection(pattern.regex, replaceWith, params.searchPreviousLine);\n      }\n    }\n  }\n\n  replaceSelection(regex, replacement, searchPreviousLine) {\n    var _this$options, _this$options2;\n\n    if ((_this$options = this.options) !== null && _this$options !== void 0 && _this$options.beforeExpand) {\n      this.options.beforeExpand();\n    }\n\n    this.options.replaceText({\n      regex,\n      replacement,\n      searchPreviousLine\n    });\n\n    if ((_this$options2 = this.options) !== null && _this$options2 !== void 0 && _this$options2.afterExpand) {\n      var _this$options3;\n\n      (_this$options3 = this.options) === null || _this$options3 === void 0 ? void 0 : _this$options3.afterExpand();\n    }\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdGV4dEV4cGFuZGVyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vRWRpdG9yS2l0Ly4vc3JjL3RleHRFeHBhbmRlci50cz80NTNhIl0sInNvdXJjZXNDb250ZW50IjpbInR5cGUgUGF0dGVybiA9IHtcbiAgcmVnZXg6IFJlZ0V4cFxuICBjYWxsYmFjazogKG1hdGNoZWRUZXh0OiBzdHJpbmcpID0+IHN0cmluZ1xufVxuXG5leHBvcnQgdHlwZSBUZXh0RXhwYW5kZXJPcHRpb25zID0ge1xuICBwYXR0ZXJuczogUGF0dGVybltdXG4gIGJlZm9yZUV4cGFuZD86ICgpID0+IHZvaWRcbiAgYWZ0ZXJFeHBhbmQ/OiAoKSA9PiB2b2lkXG4gIGdldEN1cnJlbnRMaW5lVGV4dDogKCkgPT4gc3RyaW5nXG4gIGdldFByZXZpb3VzTGluZVRleHQ6ICgpID0+IHN0cmluZ1xuICByZXBsYWNlVGV4dDogKHsgcmVnZXg6IFJlZ0V4cCwgcmVwbGFjZW1lbnQ6IHN0cmluZywgc2VhcmNoUHJldmlvdXNMaW5lOiBib29sZWFuIH0pID0+IHN0cmluZ1xufVxuXG50eXBlIE9uS2V5VXBQYXJhbXMgPSB7XG4gIGlzRW50ZXI/OiBib29sZWFuXG4gIGlzUGFzdGU/OiBib29sZWFuXG4gIGlzU3BhY2U/OiBib29sZWFuXG59XG5cbnR5cGUgU2VhcmNoUGF0dGVybnNQYXJhbXMgPSB7XG4gIHNlYXJjaFByZXZpb3VzTGluZTogYm9vbGVhblxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0RXhwYW5kZXIge1xuICBjb25zdHJ1Y3RvciAocHJpdmF0ZSBvcHRpb25zOiBUZXh0RXhwYW5kZXJPcHRpb25zKSB7IH1cblxuICBwdWJsaWMgb25LZXlVcCAoeyBpc0VudGVyLCBpc1Bhc3RlLCBpc1NwYWNlIH06IE9uS2V5VXBQYXJhbXMpOiB2b2lkIHtcbiAgICBpZiAoaXNFbnRlciB8fCBpc1Bhc3RlIHx8IGlzU3BhY2UpIHtcbiAgICAgIHRoaXMuc2VhcmNoUGF0dGVybnMoe1xuICAgICAgICBzZWFyY2hQcmV2aW91c0xpbmU6IGlzRW50ZXIgPz8gZmFsc2VcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNlYXJjaFBhdHRlcm5zIChwYXJhbXM6IFNlYXJjaFBhdHRlcm5zUGFyYW1zID0geyBzZWFyY2hQcmV2aW91c0xpbmU6IGZhbHNlIH0pOiB2b2lkIHtcbiAgICBjb25zdCB0ZXh0ID0gKHBhcmFtcy5zZWFyY2hQcmV2aW91c0xpbmUpID9cbiAgICAgIHRoaXMub3B0aW9ucy5nZXRQcmV2aW91c0xpbmVUZXh0KCkgOiB0aGlzLm9wdGlvbnMuZ2V0Q3VycmVudExpbmVUZXh0KClcblxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiB0aGlzLm9wdGlvbnMucGF0dGVybnMpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5yZWdleC5leGVjKHRleHQpXG4gICAgICBpZiAoIW1hdGNoKSBjb250aW51ZVxuXG4gICAgICBjb25zdCBtYXRjaGVkVGV4dCA9IG1hdGNoWzBdXG5cbiAgICAgIGlmIChtYXRjaGVkVGV4dCkge1xuICAgICAgICBjb25zdCByZXBsYWNlV2l0aCA9IHBhdHRlcm4uY2FsbGJhY2sobWF0Y2hlZFRleHQpXG4gICAgICAgIHRoaXMucmVwbGFjZVNlbGVjdGlvbihwYXR0ZXJuLnJlZ2V4LCByZXBsYWNlV2l0aCwgcGFyYW1zLnNlYXJjaFByZXZpb3VzTGluZSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlcGxhY2VTZWxlY3Rpb24gKHJlZ2V4OiBSZWdFeHAsIHJlcGxhY2VtZW50OiBzdHJpbmcsIHNlYXJjaFByZXZpb3VzTGluZTogYm9vbGVhbik6IHZvaWQge1xuICAgIGlmICh0aGlzLm9wdGlvbnM/LmJlZm9yZUV4cGFuZCkge1xuICAgICAgdGhpcy5vcHRpb25zLmJlZm9yZUV4cGFuZCgpXG4gICAgfVxuXG4gICAgdGhpcy5vcHRpb25zLnJlcGxhY2VUZXh0KHtcbiAgICAgIHJlZ2V4LFxuICAgICAgcmVwbGFjZW1lbnQsXG4gICAgICBzZWFyY2hQcmV2aW91c0xpbmVcbiAgICB9KVxuXG4gICAgaWYgKHRoaXMub3B0aW9ucz8uYWZ0ZXJFeHBhbmQpIHtcbiAgICAgIHRoaXMub3B0aW9ucz8uYWZ0ZXJFeHBhbmQoKVxuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7QUF3QkE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBM0NBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/textExpander.ts\n')},"./src/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";eval('/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "htmlToText": () => (/* binding */ htmlToText),\n/* harmony export */   "truncateString": () => (/* binding */ truncateString),\n/* harmony export */   "sleep": () => (/* binding */ sleep)\n/* harmony export */ });\nconst htmlToText = html => {\n  const tmpDocument = document.implementation.createHTMLDocument().body;\n  tmpDocument.innerHTML = html;\n  return tmpDocument.textContent || tmpDocument.innerText || \'\';\n};\nconst truncateString = function truncateString(text) {\n  let limit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 90;\n\n  if (text.length <= limit) {\n    return text;\n  }\n\n  return text.substring(0, limit) + \'...\';\n};\nconst sleep = async seconds => {\n  await new Promise(resolve => setTimeout(resolve, seconds * 1000));\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdXRpbHMudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9FZGl0b3JLaXQvLi9zcmMvdXRpbHMudHM/N2RkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgaHRtbFRvVGV4dCA9IChodG1sOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBjb25zdCB0bXBEb2N1bWVudCA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgpLmJvZHlcbiAgdG1wRG9jdW1lbnQuaW5uZXJIVE1MID0gaHRtbFxuICByZXR1cm4gdG1wRG9jdW1lbnQudGV4dENvbnRlbnQgfHwgdG1wRG9jdW1lbnQuaW5uZXJUZXh0IHx8ICcnXG59XG5cbmV4cG9ydCBjb25zdCB0cnVuY2F0ZVN0cmluZyA9ICh0ZXh0OiBzdHJpbmcsIGxpbWl0ID0gOTApOiBzdHJpbmcgPT4ge1xuICBpZiAodGV4dC5sZW5ndGggPD0gbGltaXQpIHtcbiAgICByZXR1cm4gdGV4dFxuICB9XG4gIHJldHVybiB0ZXh0LnN1YnN0cmluZygwLCBsaW1pdCkgKyAnLi4uJ1xufVxuXG5leHBvcnQgY29uc3Qgc2xlZXAgPSBhc3luYyAoc2Vjb25kczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBzZWNvbmRzICogMTAwMCkpXG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/utils.ts\n')},"filesafe-js":e=>{"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE_filesafe_js__}},__webpack_module_cache__={},leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpack_require__.r(n);var l={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var c=2&t&&e;"object"==typeof c&&!~leafPrototypes.indexOf(c);c=getProto(c))Object.getOwnPropertyNames(c).forEach((t=>l[t]=()=>e[t]));return l.default=()=>e,__webpack_require__.d(n,l),n},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__("./src/editorKit.ts");return __webpack_exports__=__webpack_exports__.default,__webpack_exports__})()}));