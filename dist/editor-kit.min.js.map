{"version":3,"sources":["webpack://EditorKit/webpack/universalModuleDefinition","webpack://EditorKit/webpack/runtime/create fake namespace object","webpack://EditorKit/./node_modules/@standardnotes/component-relay/dist/dist.js","webpack://EditorKit/external \"filesafe-js\"","webpack://EditorKit/webpack/bootstrap","webpack://EditorKit/webpack/runtime/compat get default export","webpack://EditorKit/webpack/runtime/define property getters","webpack://EditorKit/webpack/runtime/hasOwnProperty shorthand","webpack://EditorKit/webpack/runtime/make namespace object","webpack://EditorKit/./src/utils.ts","webpack://EditorKit/./src/fileLoader.ts","webpack://EditorKit/./src/textExpander.ts","webpack://EditorKit/./src/fileSafeHtml.ts","webpack://EditorKit/./src/editorKit.ts"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__695__","leafPrototypes","getProto","e","d","t","s","n","o","Object","defineProperty","enumerable","get","prototype","hasOwnProperty","call","i","a","default","w","SetSize","StreamItems","StreamContextItem","SaveItems","SelectItem","AssociateItem","DeassociateItem","ClearSelection","CreateItem","CreateItems","DeleteItems","SetComponentData","InstallLocalComponent","ToggleActivateComponent","RequestPermissions","PresentConflictResolution","DuplicateItem","ComponentRegistered","ActivateThemes","Reply","SaveSuccess","SaveError","ThemesActivated","KeyDown","KeyUp","Click","Web","Desktop","Mobile","Any","Item","RootKey","ItemsKey","EncryptedStorage","Note","Tag","SmartTag","Component","Editor","ActionsExtension","UserPrefs","HistorySession","Theme","Mfa","ServerExtension","FilesafeCredentials","FilesafeFileMetadata","FilesafeIntegration","ExtensionRepo","Pinned","Archived","Locked","UserModifiedDate","DefaultEditor","MobileRules","NotAvailableOnMobile","MobileActive","LastSize","PrefersPlainEditor","ComponentInstallError","r","Uint8Array","c","crypto","getRandomValues","bind","msCrypto","Error","m","l","test","h","push","toString","substr","p","random","rng","arguments","length","toLowerCase","TypeError","u","v","g","f","window","console","isSupported","this","enabled","log","error","y","S","b","I","k","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","apply","E","forEach","C","getOwnPropertyDescriptors","defineProperties","value","configurable","writable","Shift","Ctrl","Meta","activeThemes","acceptsThemes","targetWindow","contentWindow","processParameters","registerMessageHandler","registerKeyboardEventListeners","registerMouseEventListeners","initialPermissions","options","onReady","onThemesChange","coallesedSaving","coallesedSavingDelay","component","onReadyCallback","onThemesChangeCallback","debug","messageQueue","sentMessages","lastStreamedItem","pendingSaveItems","pendingSaveTimeout","pendingSaveParams","messageHandler","document","removeEventListener","keyDownEventListener","keyUpEventListener","clickEventListener","info","data","referrer","URL","origin","JSON","parse","action","handleMessage","addEventListener","concat","key","ctrlKey","keyDownEvent","shiftKey","metaKey","keyUpEvent","mouseClickEvent","sessionKey","componentData","activateThemes","themes","original","messageId","title","replace","callback","environment","platform","uuid","requestPermissions","postMessage","activeThemeUrls","api","generateUUID","stringify","isRunningInMobileApplication","parent","permissions","sort","includes","deactivateTheme","createElement","id","btoa","href","type","rel","media","className","getElementsByTagName","appendChild","Array","from","getElementsByClassName","slice","find","themeElementForUrl","parentNode","setAttribute","removeChild","content_types","items","item","clearTimeout","performSavingOfItems","jsonObjectForItem","content_type","associateItem","map","deleteItems","saveItems","saveItemsWithPresave","presave","setTimeout","concernTimeouts","alert","width","height","keyboardModifier","assign","children","content","appData","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","__esModule","getPrototypeOf","obj","mode","then","ns","create","def","current","indexOf","getOwnPropertyNames","definition","prop","Symbol","toStringTag","sleep","async","Promise","resolve","seconds","FileLoader","constructor","fileTypeForElementType","fileTypeToElementType","loadFileSafeElements","elements","getElementsBySelector","element","loadFileSafeElement","fsElement","fileSafeInstance","fsid","getAttribute","fsName","fileNameDisplay","existingMapping","uuidToFileTempUrlAndTypeMapping","insertMediaElement","url","fileType","currentlyLoadingIds","descriptor","findFileDescriptor","setStatus","status","removable","selectorSyntax","querySelectorAll","fileItem","downloadFileFromDescriptor","catch","decryptFile","fileDescriptor","tempUrl","createTemporaryFileUrl","base64Data","decryptedData","dataType","splice","cleanup","mediaElement","createImageElement","createVideoElement","createAudioElement","createDownloadElement","insertElementNearElement","remove","wrapElementInTag","tagName","tag","append","image","elementWidth","elementHeight","video","source","link","textContent","audio","existingStatusElement","statusElementMapping","style","fontWeight","userSelect","insertStatusAtCursor","identifier","Math","substring","removeCursorStatus","domNodeToInsert","inVicinityOfElement","processedElement","preprocessElement","insertionType","paragraphAncestor","closest","insertElement","TextExpander","onKeyUp","isEnter","isPaste","isSpace","searchPatterns","searchPreviousLine","params","text","getPreviousLineText","getCurrentLineText","pattern","patterns","match","regex","exec","matchedText","replaceWith","replaceSelection","replacement","beforeExpand","replaceText","afterExpand","FileSafeSyntaxPattern","expandedFileSafeSyntax","html","fileSafeSyntaxToHtmlElement","insertionSyntaxForFileDescriptor","fileName","syntax","components","split","name","size","sizeString","dimensions","EditorKitBase","delegate","connectToBridge","supportsFileSafe","fileSafeLoading","importFileSafe","componentRelay","ComponentRelay","documentElement","classList","add","streamContextItem","isNewNoteLoad","note","previousNote","itemClass","fileSafeClass","getSFItemClass","setCurrentNote","isMetadataUpdate","ignoreNextTextChange","previousText","needsFileSafeElementLoad","onNoteValueChange","setEditorRawText","onNoteLockToggle","previousLockState","getItemAppDataValue","newLockState","clearUndoHistory","result","configureFileSafe","warn","requiredDelegateFunctions","functionName","componentManager","addDataChangeObserver","allFileDescriptors","getAllFileDescriptors","fileIdsPendingAssociation","hasMatch","candidate","insertRawText","textExpander","fileLoader","addNewFileDescriptorHandler","onEditorKeyUp","onEditorPaste","onEditorValueChanged","domCopy","DOMParser","parseFromString","mediaElements","file","fsSyntax","join","insertAdjacentHTML","ghost","body","innerHTML","collapseFileSafeSyntax","saveItemWithPresave","generateCustomPreview","preview_plain","plain","preview_html","preview","_match","limit","truncateString","tmpDocument","implementation","createHTMLDocument","innerText","htmlToText","canUploadFiles","credentials","getAllCredentials","integrations","getAllIntegrations","cursorIdentifier","encryptAndUploadJavaScriptFileObject","canUseFileSafe","hasLegacyAccess","getComponentDataValueForKey","setComponentDataValueForKey"],"mappings":"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","file":"editor-kit.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"filesafe-js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"EditorKit\", [\"filesafe-js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"EditorKit\"] = factory(require(\"filesafe-js\"));\n\telse\n\t\troot[\"EditorKit\"] = factory(root[\"filesafe-js\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__695__) {\nreturn ","var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(\"ComponentRelay\",[],t):\"object\"==typeof exports?exports.ComponentRelay=t():e.ComponentRelay=t()}(self,(function(){return(()=>{\"use strict\";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};let s,n,i,o;var a;e.d(t,{default:()=>w}),function(e){e.SetSize=\"set-size\",e.StreamItems=\"stream-items\",e.StreamContextItem=\"stream-context-item\",e.SaveItems=\"save-items\",e.SelectItem=\"select-item\",e.AssociateItem=\"associate-item\",e.DeassociateItem=\"deassociate-item\",e.ClearSelection=\"clear-selection\",e.CreateItem=\"create-item\",e.CreateItems=\"create-items\",e.DeleteItems=\"delete-items\",e.SetComponentData=\"set-component-data\",e.InstallLocalComponent=\"install-local-component\",e.ToggleActivateComponent=\"toggle-activate-component\",e.RequestPermissions=\"request-permissions\",e.PresentConflictResolution=\"present-conflict-resolution\",e.DuplicateItem=\"duplicate-item\",e.ComponentRegistered=\"component-registered\",e.ActivateThemes=\"themes\",e.Reply=\"reply\",e.SaveSuccess=\"save-success\",e.SaveError=\"save-error\",e.ThemesActivated=\"themes-activated\",e.KeyDown=\"key-down\",e.KeyUp=\"key-up\",e.Click=\"click\"}(s||(s={})),function(e){e[e.Web=1]=\"Web\",e[e.Desktop=2]=\"Desktop\",e[e.Mobile=3]=\"Mobile\"}(n||(n={})),function(e){e.Any=\"*\",e.Item=\"SF|Item\",e.RootKey=\"SN|RootKey|NoSync\",e.ItemsKey=\"SN|ItemsKey\",e.EncryptedStorage=\"SN|EncryptedStorage\",e.Note=\"Note\",e.Tag=\"Tag\",e.SmartTag=\"SN|SmartTag\",e.Component=\"SN|Component\",e.Editor=\"SN|Editor\",e.ActionsExtension=\"Extension\",e.UserPrefs=\"SN|UserPreferences\",e.HistorySession=\"SN|HistorySession\",e.Theme=\"SN|Theme\",e.Mfa=\"SF|MFA\",e.ServerExtension=\"SF|Extension\",e.FilesafeCredentials=\"SN|FileSafe|Credentials\",e.FilesafeFileMetadata=\"SN|FileSafe|FileMetadata\",e.FilesafeIntegration=\"SN|FileSafe|Integration\",e.ExtensionRepo=\"SN|ExtensionRepo\"}(i||(i={})),function(e){e.Pinned=\"pinned\",e.Archived=\"archived\",e.Locked=\"locked\",e.UserModifiedDate=\"client_updated_at\",e.DefaultEditor=\"defaultEditor\",e.MobileRules=\"mobileRules\",e.NotAvailableOnMobile=\"notAvailableOnMobile\",e.MobileActive=\"mobileActive\",e.LastSize=\"lastSize\",e.PrefersPlainEditor=\"prefersPlainEditor\",e.ComponentInstallError=\"installError\"}(o||(o={}));var r=new Uint8Array(16);function c(){if(!a&&!(a=\"undefined\"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||\"undefined\"!=typeof msCrypto&&\"function\"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error(\"crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported\");return a(r)}const m=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,l=function(e){return\"string\"==typeof e&&m.test(e)};for(var d=[],h=0;h<256;++h)d.push((h+256).toString(16).substr(1));const p=function(e,t,s){var n=(e=e||{}).random||(e.rng||c)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){s=s||0;for(var i=0;i<16;++i)t[s+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+\"-\"+d[e[t+4]]+d[e[t+5]]+\"-\"+d[e[t+6]]+d[e[t+7]]+\"-\"+d[e[t+8]]+d[e[t+9]]+\"-\"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!l(s))throw TypeError(\"Stringified UUID is invalid\");return s}(n)},u=e=>{var t;const s={[n.Web]:\"web\",[n.Desktop]:\"desktop\",[n.Mobile]:\"mobile\"};return null!==(t=s[e])&&void 0!==t?t:s[n.Web]},v=e=>null!=e,g=()=>{};class f{static get isSupported(){return!(!window.console&&!console)}static get info(){return f.isSupported&&this.enabled?console.log.bind(console):g}static get error(){return f.isSupported?console.error.bind(console):g}}var y,S,b,I;function k(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function E(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?k(Object(s),!0).forEach((function(t){C(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):k(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function C(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}(S=\"enabled\")in(y=f)?Object.defineProperty(y,S,{value:false,enumerable:!0,configurable:!0,writable:!0}):y[S]=false,function(e){e.Component=\"component\"}(b||(b={})),function(e){e.Shift=\"Shift\",e.Ctrl=\"Control\",e.Meta=\"Meta\"}(I||(I={}));class w{constructor(e){if(C(this,\"contentWindow\",void 0),C(this,\"initialPermissions\",void 0),C(this,\"onReadyCallback\",void 0),C(this,\"component\",{activeThemes:[],acceptsThemes:!0}),C(this,\"sentMessages\",[]),C(this,\"messageQueue\",[]),C(this,\"lastStreamedItem\",void 0),C(this,\"pendingSaveItems\",void 0),C(this,\"pendingSaveTimeout\",void 0),C(this,\"pendingSaveParams\",void 0),C(this,\"coallesedSaving\",!0),C(this,\"coallesedSavingDelay\",250),C(this,\"messageHandler\",void 0),C(this,\"keyDownEventListener\",void 0),C(this,\"keyUpEventListener\",void 0),C(this,\"clickEventListener\",void 0),C(this,\"onThemesChangeCallback\",void 0),C(this,\"concernTimeouts\",[]),!e||!e.targetWindow)throw new Error(\"contentWindow must be a valid Window object.\");this.contentWindow=e.targetWindow,this.processParameters(e),this.registerMessageHandler(),this.registerKeyboardEventListeners(),this.registerMouseEventListeners()}processParameters(e){var t;const{initialPermissions:s,options:n,onReady:i,onThemesChange:o}=e;var a;s&&s.length>0&&(this.initialPermissions=s),v(null==n?void 0:n.coallesedSaving)&&(this.coallesedSaving=n.coallesedSaving),v(null==n?void 0:n.coallesedSavingDelay)&&(this.coallesedSavingDelay=n.coallesedSavingDelay),v(null==n?void 0:n.acceptsThemes)&&(this.component.acceptsThemes=null===(a=null==n?void 0:n.acceptsThemes)||void 0===a||a),v(i)&&(this.onReadyCallback=i),v(o)&&(this.onThemesChangeCallback=o),f.enabled=null!==(t=null==n?void 0:n.debug)&&void 0!==t&&t}deinit(){this.onReadyCallback=void 0,this.component={acceptsThemes:!0,activeThemes:[]},this.messageQueue=[],this.sentMessages=[],this.lastStreamedItem=void 0,this.pendingSaveItems=void 0,this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0,this.messageHandler&&(this.contentWindow.document.removeEventListener(\"message\",this.messageHandler),this.contentWindow.removeEventListener(\"message\",this.messageHandler)),this.keyDownEventListener&&this.contentWindow.removeEventListener(\"keydown\",this.keyDownEventListener),this.keyUpEventListener&&this.contentWindow.removeEventListener(\"keyup\",this.keyUpEventListener),this.clickEventListener&&this.contentWindow.removeEventListener(\"click\",this.clickEventListener)}registerMessageHandler(){this.messageHandler=e=>{if(f.info(\"Components API Message received:\",e.data),document.referrer&&new URL(document.referrer).origin!==new URL(e.origin).origin)return;const{data:t}=e,n=(e=>{if(\"string\"!=typeof e)return!1;try{const t=JSON.parse(e),s=Object.prototype.toString.call(t);return\"[object Object]\"===s||\"[object Array]\"===s}catch(e){return!1}})(t)?JSON.parse(t):t;if(n){if(void 0===this.component.origin&&n.action===s.ComponentRegistered)this.component.origin=e.origin;else if(e.origin!==this.component.origin)return;this.handleMessage(n)}else f.error(\"Invalid data received. Skipping...\")},this.contentWindow.document.addEventListener(\"message\",this.messageHandler,!1),this.contentWindow.addEventListener(\"message\",this.messageHandler,!1),f.info(\"Waiting for messages...\")}registerKeyboardEventListeners(){this.keyDownEventListener=e=>{f.info(\"A key has been pressed: \".concat(e.key)),e.ctrlKey?this.keyDownEvent(I.Ctrl):e.shiftKey?this.keyDownEvent(I.Shift):(e.metaKey||\"Meta\"===e.key)&&this.keyDownEvent(I.Meta)},this.keyUpEventListener=e=>{f.info(\"A key has been released: \".concat(e.key)),\"Control\"===e.key?this.keyUpEvent(I.Ctrl):\"Shift\"===e.key?this.keyUpEvent(I.Shift):\"Meta\"===e.key&&this.keyUpEvent(I.Meta)},this.contentWindow.addEventListener(\"keydown\",this.keyDownEventListener,!1),this.contentWindow.addEventListener(\"keyup\",this.keyUpEventListener,!1)}registerMouseEventListeners(){this.clickEventListener=e=>{f.info(\"A click has been performed.\"),this.mouseClickEvent()},this.contentWindow.addEventListener(\"click\",this.clickEventListener,!1)}handleMessage(e){switch(e.action){case s.ComponentRegistered:this.component.sessionKey=e.sessionKey,e.componentData&&(this.component.data=e.componentData),this.onReady(e.data),f.info(\"Component successfully registered with payload:\",e);break;case s.ActivateThemes:this.activateThemes(e.data.themes);break;default:{var t,n;if(!e.original)return;const s=null===(t=this.sentMessages)||void 0===t?void 0:t.filter((t=>{var s;return t.messageId===(null===(s=e.original)||void 0===s?void 0:s.messageId)}))[0];if(!s){const e=this.contentWindow.document.title,t=(\"The extension '\".concat(e,\"' is attempting to communicate with Standard Notes, \")+\"but an error is preventing it from doing so. Please restart this extension and try again.\").replace(\"  \",\" \");return void f.info(t)}null==s||null===(n=s.callback)||void 0===n||n.call(s,e.data);break}}}onReady(e){this.component.environment=e.environment,this.component.platform=e.platform,this.component.uuid=e.uuid,this.initialPermissions&&this.initialPermissions.length>0&&this.requestPermissions(this.initialPermissions);for(const e of this.messageQueue)this.postMessage(e.action,e.data,e.callback);this.messageQueue=[],f.info(\"Data passed to onReady:\",e),this.activateThemes(e.activeThemeUrls||[]),this.postMessage(s.ThemesActivated,{}),this.onReadyCallback&&this.onReadyCallback()}getSelfComponentUUID(){return this.component.uuid}isRunningInDesktopApplication(){return this.component.environment===u(n.Desktop)}isRunningInMobileApplication(){return this.component.environment===u(n.Mobile)}getComponentDataValueForKey(e){if(this.component.data)return this.component.data[e]}setComponentDataValueForKey(e,t){if(!this.component.data)throw new Error(\"The component has not been initialized.\");if(!e||e&&0===e.length)throw new Error(\"The key for the data value should be a valid string.\");this.component.data=E(E({},this.component.data),{},{[e]:t}),this.postMessage(s.SetComponentData,{componentData:this.component.data})}clearComponentData(){this.component.data={},this.postMessage(s.SetComponentData,{componentData:this.component.data})}postMessage(e,t,s){if(!this.component.sessionKey)return void this.messageQueue.push({action:e,data:t,api:b.Component,callback:s});const n={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.component.sessionKey,api:b.Component},i=JSON.parse(JSON.stringify(n));let o;i.callback=s,this.sentMessages.push(i),o=this.isRunningInMobileApplication()?JSON.stringify(n):n,f.info(\"Posting message:\",o),this.contentWindow.parent.postMessage(o,this.component.origin)}requestPermissions(e,t){this.postMessage(s.RequestPermissions,{permissions:e},(()=>{t&&t()}))}activateThemes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.component.acceptsThemes)return;f.info(\"Incoming themes:\",e);const{activeThemes:t}=this.component;if(t&&t.sort().toString()==e.sort().toString())return;let s=e;const n=[];for(const i of t)e.includes(i)?s=s.filter((e=>e!==i)):n.push(i);f.info(\"Deactivating themes:\",n),f.info(\"Activating themes:\",s);for(const e of n)this.deactivateTheme(e);this.component.activeThemes=e;for(const e of s){if(!e)continue;const t=this.contentWindow.document.createElement(\"link\");t.id=btoa(e),t.href=e,t.type=\"text/css\",t.rel=\"stylesheet\",t.media=\"screen,print\",t.className=\"custom-theme\",this.contentWindow.document.getElementsByTagName(\"head\")[0].appendChild(t)}this.onThemesChangeCallback&&this.onThemesChangeCallback()}themeElementForUrl(e){return Array.from(this.contentWindow.document.getElementsByClassName(\"custom-theme\")).slice().find((t=>t.id==btoa(e)))}deactivateTheme(e){const t=this.themeElementForUrl(e);t&&t.parentNode&&(t.setAttribute(\"disabled\",\"true\"),t.parentNode.removeChild(t))}generateUUID(){return p()}get platform(){return this.component.platform}get environment(){return this.component.environment}streamItems(e,t){this.postMessage(s.StreamItems,{content_types:e},(e=>{t(e.items)}))}streamContextItem(e){this.postMessage(s.StreamContextItem,{},(t=>{const{item:s}=t;(!this.lastStreamedItem||this.lastStreamedItem.uuid!==s.uuid)&&this.pendingSaveTimeout&&(clearTimeout(this.pendingSaveTimeout),this.performSavingOfItems(this.pendingSaveParams),this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0),this.lastStreamedItem=s,e(this.lastStreamedItem)}))}selectItem(e){this.postMessage(s.SelectItem,{item:this.jsonObjectForItem(e)})}clearSelection(){this.postMessage(s.ClearSelection,{content_type:i.Tag})}createItem(e,t){this.postMessage(s.CreateItem,{item:this.jsonObjectForItem(e)},(e=>{let{item:s}=e;!s&&e.items&&e.items.length>0&&(s=e.items[0]),this.associateItem(s),t&&t(s)}))}createItems(e,t){const n=e.map((e=>this.jsonObjectForItem(e)));this.postMessage(s.CreateItems,{items:n},(e=>{t&&t(e.items)}))}associateItem(e){this.postMessage(s.AssociateItem,{item:this.jsonObjectForItem(e)})}deassociateItem(e){this.postMessage(s.DeassociateItem,{item:this.jsonObjectForItem(e)})}deleteItem(e,t){this.deleteItems([e],t)}deleteItems(e,t){const n={items:e.map((e=>this.jsonObjectForItem(e)))};this.postMessage(s.DeleteItems,n,(e=>{t&&t(e)}))}sendCustomEvent(e,t,s){this.postMessage(e,t,(e=>{s&&s(e)}))}saveItem(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,s)}saveItemWithPresave(e,t,s){this.saveItemsWithPresave([e],t,s)}saveItemsWithPresave(e,t,s){this.saveItems(e,s,!1,t)}performSavingOfItems(e){let{items:t,presave:n,callback:i}=e;const o=setTimeout((()=>{this.concernTimeouts.forEach((e=>clearTimeout(e))),alert(\"This editor is unable to communicate with Standard Notes. Your changes may not be saved. Please backup your changes, then restart the application and try again.\")}),5e3);this.concernTimeouts.push(o),n&&n();const a=[];for(const e of t)a.push(this.jsonObjectForItem(e));this.postMessage(s.SaveItems,{items:a},(()=>{this.concernTimeouts.forEach((e=>clearTimeout(e))),null==i||i()}))}saveItems(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;if(this.pendingSaveItems||(this.pendingSaveItems=[]),this.coallesedSaving&&!s){this.pendingSaveTimeout&&clearTimeout(this.pendingSaveTimeout);const s=e.map((e=>e.uuid)),i=this.pendingSaveItems.filter((e=>!s.includes(e.uuid)));this.pendingSaveItems=i.concat(e),this.pendingSaveParams={items:this.pendingSaveItems,presave:n,callback:t},this.pendingSaveTimeout=setTimeout((()=>{this.performSavingOfItems(this.pendingSaveParams),this.pendingSaveItems=[],this.pendingSaveTimeout=void 0,this.pendingSaveParams=null}),this.coallesedSavingDelay)}else this.performSavingOfItems({items:e,presave:n,callback:t})}setSize(e,t){this.postMessage(s.SetSize,{type:\"container\",width:e,height:t})}keyDownEvent(e){this.postMessage(s.KeyDown,{keyboardModifier:e})}keyUpEvent(e){this.postMessage(s.KeyUp,{keyboardModifier:e})}mouseClickEvent(){this.postMessage(s.Click,{})}jsonObjectForItem(e){const t=Object.assign({},e);return t.children=null,t.parent=null,t}getItemAppDataValue(e,t){var s,n;return null==e||null===(s=e.content)||void 0===s||null===(n=s.appData)||void 0===n?void 0:n[\"org.standardnotes.sn\"][t]}}return t.default})()}));\n//# sourceMappingURL=dist.js.map","module.exports = __WEBPACK_EXTERNAL_MODULE__695__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const htmlToText = (html: string): string => {\n  const tmpDocument = document.implementation.createHTMLDocument().body\n  tmpDocument.innerHTML = html\n  return tmpDocument.textContent || tmpDocument.innerText || ''\n}\n\nexport const truncateString = (text: string, limit = 90): string => {\n  if (text.length <= limit) {\n    return text\n  }\n  return text.substring(0, limit) + '...'\n}\n\nexport const sleep = async (seconds: number): Promise<void> => {\n  await new Promise(resolve => setTimeout(resolve, seconds * 1000))\n}\n","import { sleep } from './utils'\n\nexport type FileLoaderOptions = {\n  fileSafeInstance: any\n  getElementsBySelector: (selector: string) => Element[]\n  preprocessElement: (element: Element) => Element\n  insertElement: (element: Element, inVicinityOfElement: Element | null, insertionType: string) => void\n}\n\ntype FileTypes = {\n  [key: string]: string\n}\n\ntype UuidTypeMapping = {\n  [key: string]: {\n    url: string\n    fileType: string\n    fsName: string\n  }\n}\n\ntype ElementStatusMapping = {\n  [key: string]: Element\n}\n\ntype InsertMediaElementParams = {\n  url: string,\n  fsid: string,\n  fsName: string,\n  fileType: string,\n  fsElement: Element\n}\n\ntype WrapElementInTagParams = {\n  element: Element,\n  tagName: string,\n  fsid: string,\n  fsName: string\n}\n\ntype SetStatusParams = {\n  status?: string,\n  fsElement: Element | null,\n  fsid: string,\n  removable?: boolean\n}\n\ntype CreateImageElementParams = {\n  url: string,\n  fsid: string,\n  fsName: string,\n  fsElement: Element\n}\n\ntype CreateAudioElementParams = {\n  url: string,\n  fsid: string,\n  fsName: string\n}\n\ntype CreateVideoElementParams = {\n  url: string,\n  fsid: string,\n  fileType: string,\n  fsName: string,\n  fsElement: Element\n}\n\ntype CreateDownloadElementParams = {\n  url: string,\n  fsid: string,\n  fsName: string\n}\n\nexport default class FileLoader {\n  /**\n   * When a file is decrypted and loaded into a temp url, we'll place the temp url in here so that subsequent decrypt attempts\n   * dont require further work. Mapped values have the shape of { url, fileType, fsName }\n   */\n  private uuidToFileTempUrlAndTypeMapping: UuidTypeMapping = {}\n\n  // The UUIDs of files currently loading, so that we don't start a new load for currently loading file.\n  private currentlyLoadingIds: string[] = []\n\n  // The UUID to current status element mapping\n  private statusElementMapping: ElementStatusMapping = {}\n  private readonly fileTypeToElementType: FileTypes = {\n    'image/png': 'img',\n    'image/jpg': 'img',\n    'image/jpeg': 'img',\n    'image/gif': 'img',\n    'image/tiff': 'img',\n    'image/bmp': 'img',\n    'video/mp4': 'video',\n    'audio/mpeg': 'audio',\n    'audio/mp3': 'audio'\n  }\n\n  constructor(private options: FileLoaderOptions) { }\n\n  public fileTypeForElementType(type: string): string {\n    return this.fileTypeToElementType[type.toLowerCase()]\n  }\n\n  /**\n   * Scans the document for elements <fileSafe>. If found, begins loading file.\n   */\n  public loadFileSafeElements(): void {\n    const elements = this.options.getElementsBySelector('*[fsplaceholder]')\n    for (const element of elements) {\n      this.loadFileSafeElement(element)\n    }\n  }\n\n  public async loadFileSafeElement(fsElement: Element): Promise<boolean> {\n    const { fileSafeInstance } = this.options\n\n    const fsid = fsElement.getAttribute('fsid')\n    const fsName = fsElement.getAttribute('fsName') ?? ''\n    const fileNameDisplay = (!fsName || fsName == 'undefined') ? 'file' : fsName\n\n    if (!fsid) {\n      return false\n    }\n\n    const existingMapping = this.uuidToFileTempUrlAndTypeMapping[fsid]\n\n    if (existingMapping) {\n      this.insertMediaElement({\n        fsid,\n        fsElement,\n        url: existingMapping.url,\n        fileType: existingMapping.fileType,\n        fsName: existingMapping.fsName\n      })\n      return false\n    }\n\n    if (this.currentlyLoadingIds.includes(fsid)) {\n      return false\n    }\n\n    const descriptor = fileSafeInstance.findFileDescriptor(fsid)\n\n    if (!descriptor) {\n      this.setStatus({\n        fsElement,\n        fsid,\n        status: `Unable to find ${fileNameDisplay} ${fsid}.`,\n        removable: true\n      })\n      return false\n    }\n\n    const selectorSyntax = `[fsid=\"${descriptor.uuid}\"][fscollapsable]`\n    const existingElements = document.querySelectorAll(\n      `img${selectorSyntax}, figure${selectorSyntax}, video${selectorSyntax}, audio${selectorSyntax}`\n    )\n\n    if (existingElements.length > 0) {\n      return false\n    }\n\n    const cleanup = () => this.currentlyLoadingIds.splice(this.currentlyLoadingIds.indexOf(fsid), 1)\n\n    this.currentlyLoadingIds.push(fsid)\n    this.setStatus({\n      fsElement,\n      fsid,\n      status: `Downloading ${fileNameDisplay}...`\n    })\n\n     // Allow UI to update before beginning download...\n    await sleep(0.05)\n\n    const fileItem = await fileSafeInstance.downloadFileFromDescriptor(descriptor).catch(() => {\n      this.setStatus({\n        fsElement,\n        fsid,\n        status: `Unable to download ${fileNameDisplay} ${fsid}.`\n      })\n      return\n    })\n\n    if (!fileItem) {\n      return false\n    }\n\n    this.setStatus({\n      fsElement,\n      fsid,\n      status: `Decrypting ${fileNameDisplay}...`\n    })\n\n    // Allow UI to update before beginning decryption\n    await sleep(0.05)\n\n    const data = await fileSafeInstance.decryptFile({ fileDescriptor: descriptor, fileItem }).catch(() => {\n      this.setStatus({\n        fsElement,\n        fsid,\n        status: `Unable to decrypt ${fileNameDisplay} ${fsid}.`\n      })\n      return\n    })\n\n    if (!data) {\n      return false\n    }\n\n    // Remove loading text\n    this.setStatus({\n      fsElement,\n      fsid\n    })\n\n    // Allow UI to update before adding image\n    await sleep(0.05)\n\n    // Generate temporary url, must be released later\n    const fileType = descriptor.content.fileType\n    const tempUrl = fileSafeInstance.createTemporaryFileUrl({\n      base64Data: data.decryptedData,\n      dataType: fileType\n    })\n\n    this.insertMediaElement({\n      fsid, fileType,\n      fsName,\n      fsElement,\n      url: tempUrl\n    })\n\n    cleanup()\n\n    this.uuidToFileTempUrlAndTypeMapping[fsid] = {\n      fileType,\n      url: tempUrl,\n      fsName,\n    }\n\n    return true\n  }\n\n  private insertMediaElement({ url, fsid, fsName, fileType, fsElement }: InsertMediaElementParams) {\n    const elementType = this.fileTypeForElementType(fileType)\n\n    let mediaElement: Element\n    \n    switch (elementType) {\n      case 'img':\n        mediaElement = this.createImageElement({ url, fsid, fsName, fsElement })\n        break\n      case 'video':\n        mediaElement = this.createVideoElement({ url, fsid, fileType, fsName, fsElement })\n        break\n      case 'audio':\n        mediaElement = this.createAudioElement({ url, fsid, fsName })\n        break\n      default:\n        mediaElement = this.createDownloadElement({ url, fsid, fsName })\n        break\n    }\n\n    this.insertElementNearElement(mediaElement, fsElement)\n\n    // Remove fsElement now that image is loaded.\n    fsElement.remove()\n  }\n\n  private wrapElementInTag({ element, tagName, fsid, fsName }: WrapElementInTagParams) {\n    const tag = document.createElement(tagName)\n    tag.setAttribute('fsid', fsid)\n    tag.setAttribute('fsName', fsName)\n    tag.setAttribute('fscollapsable', 'true')\n    tag.setAttribute('contenteditable', 'true')\n    tag.append(element)\n    return tag\n  }\n\n  private createImageElement({ url, fsid, fsName, fsElement }: CreateImageElementParams): HTMLImageElement {\n    const image = document.createElement('img')\n    image.setAttribute('src', url)\n    image.setAttribute('srcset', `${url} 2x`)\n\n    image.setAttribute('fsid', fsid)\n    image.setAttribute('fsName', fsName)\n    image.setAttribute('fscollapsable', 'true')\n\n    const elementWidth = fsElement.getAttribute('width')\n    if (elementWidth) {\n      image.setAttribute('width', elementWidth)\n    }\n\n    const elementHeight = fsElement.getAttribute('height')\n    if (elementHeight) {\n      image.setAttribute('height', elementHeight)\n    }\n\n    return image\n  }\n\n  private createVideoElement({ url, fsid, fileType, fsName, fsElement }: CreateVideoElementParams) {\n    const video = document.createElement('video')\n    video.setAttribute('controls', 'true')\n    video.setAttribute('fsid', fsid)\n    video.setAttribute('fsName', fsName)\n    video.setAttribute('fscollapsable', 'true')\n\n    const elementWidth = fsElement.getAttribute('width')\n    if (elementWidth) {\n      video.setAttribute('width', elementWidth)\n    }\n\n    const elementHeight = fsElement.getAttribute('height')\n    if (elementHeight) {\n      video.setAttribute('height', elementHeight)\n    }\n\n    const source = document.createElement('source')\n    source.setAttribute('src', url)\n    source.setAttribute('type', fileType)\n    video.append(source)\n\n    /**\n     * Redactor will automatically insert a video element in a p tag,\n     * so we'll do it ourselves so that we can control its attributes.\n     */\n    return this.wrapElementInTag({\n      fsid,\n      fsName,\n      element: video,\n      tagName: 'p'\n    })\n  }\n\n  private createDownloadElement({ url, fsid, fsName }: CreateDownloadElementParams) {\n    const link = document.createElement('a')\n    link.setAttribute('fsid', fsid)\n    link.setAttribute('fsName', fsName)\n    link.setAttribute('ghost', 'true')\n    link.setAttribute('fscollapsable', 'true')\n    link.setAttribute('href', url)\n    link.textContent = `${fsName}`\n    return link\n  }\n\n  private createAudioElement({ url, fsid, fsName }: CreateAudioElementParams) {\n    const audio = document.createElement('audio')\n    audio.setAttribute('src', url)\n    audio.setAttribute('controls', 'true')\n    audio.setAttribute('fsid', fsid)\n    audio.setAttribute('fsName', fsName)\n    audio.setAttribute('fscollapsable', 'true')\n\n    return this.wrapElementInTag({\n      fsid,\n      fsName,\n      element: audio,\n      tagName: 'p'\n    })\n  }\n\n  private setStatus({ status, fsElement, fsid, removable = false }: SetStatusParams): Element | void {\n    if (fsid) {\n      const existingStatusElement = this.statusElementMapping[fsid]\n\n      if (existingStatusElement) {\n        existingStatusElement.remove()\n        delete this.statusElementMapping[fsid]\n      }\n    }\n\n    if (status) {\n      let element = document.createElement('label')\n\n      element.setAttribute('id', fsid)\n      element.setAttribute('ghost', 'true')\n      element.setAttribute('contenteditable', 'false')\n      element.style.fontWeight = 'bold'\n      element.textContent = status\n\n      if (removable) {\n        element.style.userSelect = 'all'\n      }\n\n      element = this.insertElementNearElement(element, fsElement) as HTMLLabelElement\n\n      if (fsid) {\n        this.statusElementMapping[fsid] = element\n      }\n\n      return element\n    }\n  }\n\n  public insertStatusAtCursor(status: string): string {\n    const identifier = Math.random().toString(36).substring(7)\n    this.setStatus({\n      status,\n      fsid: identifier,\n      fsElement: null\n    })\n    return identifier\n  }\n\n  public removeCursorStatus(identifier: string): void {\n    /**\n     * We want to search for the element based on identifier, because the actual element\n     * inserted may have been done so as raw HTML, and not via an element pointer.\n     */\n    const elements = this.options.getElementsBySelector(`#${identifier}`)\n\n    if (elements.length > 0) {\n      elements[0].remove()\n    }\n  }\n\n  public insertElementNearElement(domNodeToInsert: Element, inVicinityOfElement: Element | null): Element | undefined {\n    const processedElement = this.options.preprocessElement(domNodeToInsert)\n    let insertionType = 'child'\n\n    // <figure> tags cannot be nested inside p tags.\n    if (inVicinityOfElement && processedElement.tagName.toLowerCase() == 'figure') {\n      // If we have a p ancestor, we need to get out.\n      const paragraphAncestor = inVicinityOfElement.closest('p')\n\n      if (paragraphAncestor) {\n        /**\n         * p tags cannot be nested in other p tags, so if we found one, we know its parent isn't and doesn't belong to a p tag.\n         * Add the new one right after paragraphAncestor.\n         */\n        inVicinityOfElement = paragraphAncestor\n        insertionType = 'afterend'\n      }\n    }\n\n    this.options.insertElement(processedElement, inVicinityOfElement, insertionType)\n    return processedElement as Element\n  }\n}\n","type Pattern = {\n  regex: RegExp\n  callback: (matchedText: string) => string\n}\n\nexport type TextExpanderOptions = {\n  patterns: Pattern[]\n  beforeExpand?: () => void\n  afterExpand?: () => void\n  getCurrentLineText: () => string\n  getPreviousLineText: () => string\n  replaceText: ({ regex: RegExp, replacement: string, searchPreviousLine: boolean }) => string\n}\n\ntype OnKeyUpParams = {\n  isEnter?: boolean\n  isPaste?: boolean\n  isSpace?: boolean\n}\n\ntype SearchPatternsParams = {\n  searchPreviousLine: boolean\n}\n\nexport default class TextExpander {\n  constructor (private options: TextExpanderOptions) { }\n\n  public onKeyUp ({ isEnter, isPaste, isSpace }: OnKeyUpParams): void {\n    if (isEnter || isPaste || isSpace) {\n      this.searchPatterns({\n        searchPreviousLine: isEnter ?? false\n      })\n    }\n  }\n\n  public searchPatterns (params: SearchPatternsParams = { searchPreviousLine: false }): void {\n    const text = (params.searchPreviousLine) ?\n      this.options.getPreviousLineText() : this.options.getCurrentLineText()\n\n    for (const pattern of this.options.patterns) {\n      const match = pattern.regex.exec(text)\n      if (!match) continue\n\n      const matchedText = match[0]\n\n      if (matchedText) {\n        const replaceWith = pattern.callback(matchedText)\n        this.replaceSelection(pattern.regex, replaceWith, params.searchPreviousLine)\n      }\n    }\n  }\n\n  private replaceSelection (regex: RegExp, replacement: string, searchPreviousLine: boolean): void {\n    if (this.options?.beforeExpand) {\n      this.options.beforeExpand()\n    }\n\n    this.options.replaceText({\n      regex,\n      replacement,\n      searchPreviousLine\n    })\n\n    if (this.options?.afterExpand) {\n      this.options?.afterExpand()\n    }\n  }\n}\n","export type FileSafeFileMetadata = {\n  [key: string]: any;\n}\n\n/**\n * Remove matching <p> tags if present.\n * Also capable of matching adjacent [fsSyntax][fsSyntax]\n */\nexport const FileSafeSyntaxPattern = /(<p>)?\\[FileSafe[^\\]]*\\](<\\/p>)?/g\n\n/**\n * Given an HTML string that includes substrings matching `FileSafeSyntaxPattern`,\n * replace occurences with ghost div element <fileSafe uuid='123'>\n */\nexport const expandedFileSafeSyntax = (html: string): string => {\n  return html.replace(FileSafeSyntaxPattern, (match) => {\n    return fileSafeSyntaxToHtmlElement(match)\n  })\n}\n\nexport const removeFileSafeSyntaxFromHtml = (html: string): string => {\n  return html.replace(FileSafeSyntaxPattern, (_match) => {\n    return ''\n  })\n}\n\nexport const insertionSyntaxForFileDescriptor = (descriptor: FileSafeFileMetadata): string => {\n  return `[FileSafe:${descriptor.uuid}:${descriptor.content.fileName}]`\n}\n\nexport const fileSafeSyntaxToHtmlElement = (syntax: string): string => {\n  // Remove paragraph tags\n  syntax = syntax.replace('<p>', '')\n  syntax = syntax.replace('</p>', '')\n\n  // Remove brackets\n  syntax = syntax.replace('[', '').replace(']', '')\n\n  const components = syntax.split(':')\n  const uuid = components[1]\n  const name = components[2]\n  const size = components[3]\n\n  let sizeString = ''\n\n  if (size) {\n    const dimensions = size.split('x')\n    sizeString = `width=${dimensions[0]} height=${dimensions[1]}`\n  }\n\n  /**\n   * We use a p tag here because if we try something custom, like `fileSafe` tag, the editor will automatically\n   * wrap it in a p tag, causing littered p tags remaining in the plaintext representation.\n   */\n  return `<p fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid='${uuid}' fsname='${name}' ${sizeString}></p>`\n}\n\n/**\n * Given a rendered HTML string, replace all <fileSafe> items with [FileSafe:UUID] plaintext items.\n * Also, for any elements that have the 'ghost' attribute, remove it from the resulting string.\n */\nexport const collapseFileSafeSyntax = (html: string): string => {\n  const domCopy = new DOMParser().parseFromString(html, 'text/html')\n\n  // Elements that have fscollapsable means they should be collapsed to plain syntax.\n  const mediaElements = domCopy.querySelectorAll('*[fscollapsable]')\n\n  for (const file of mediaElements) {\n    const uuid = file.getAttribute('fsid')\n    const name = file.getAttribute('fsname')\n    const width = file.getAttribute('width')\n    const height = file.getAttribute('height')\n\n    const components = ['FileSafe', uuid, name]\n\n    if (width && height) {\n      const size = `${width}x${height}`\n      components.push(size)\n    }\n\n    const fsSyntax = `<p>[${components.join(':')}]</p>`\n    file.insertAdjacentHTML('afterend', fsSyntax)\n    file.remove()\n  }\n\n  // Remove any remaining ghost elements.\n  const ghosts = domCopy.querySelectorAll('*[ghost]')\n  ghosts.forEach((ghost) => ghost.remove())\n\n  return domCopy.body.innerHTML\n}\n","import ComponentRelay from '@standardnotes/component-relay'\nimport FileLoader, { FileLoaderOptions } from './fileLoader'\nimport TextExpander, { TextExpanderOptions } from './textExpander'\nimport {\n  truncateString,\n  htmlToText\n} from './utils'\nimport {\n  FileSafeSyntaxPattern,\n  collapseFileSafeSyntax,\n  expandedFileSafeSyntax,\n  insertionSyntaxForFileDescriptor,\n  removeFileSafeSyntaxFromHtml,\n  FileSafeFileMetadata\n} from './fileSafeHtml'\nimport type { ItemMessagePayload } from '@standardnotes/snjs'\n\n/**\n * The delegate is responsible for responding to events and functions that the EditorKit requires.\n * For example, when EditorKit wants to insert a new HTML element, it won't neccessarily know how,\n * because it's not designed for any particular editor. Instead, it will tell the delegate to\n * insert the element. The consumer of this API, the actual editor, would configure this delegate\n * with the appropriate callbacks.\n */\nexport interface EditorKitDelegate {\n  insertRawText?: (text: string) => void\n  setEditorRawText: (text: string) => void\n  getCurrentLineText?: TextExpanderOptions['getCurrentLineText']\n  getPreviousLineText?: TextExpanderOptions['getPreviousLineText']\n  replaceText?: TextExpanderOptions['replaceText']\n  getElementsBySelector?: FileLoaderOptions['getElementsBySelector']\n  insertElement?: FileLoaderOptions['insertElement']\n  preprocessElement?: FileLoaderOptions['preprocessElement']\n  clearUndoHistory?: () => void\n  generateCustomPreview?: (text: string) => { html?: string, plain: string }\n  onNoteLockToggle?: (isLocked: boolean) => void\n  onNoteValueChange?: (note: ItemMessagePayload) => Promise<void>\n  onThemesChange?: () => void\n}\n\nexport type EditorKitMode = 'plaintext' | 'html' | 'markdown' | 'json';\n\ntype EditorKitOptions = {\n  mode: EditorKitMode\n  /**\n   * Indicates if the editor should support FileSafe integration.\n   */\n  supportsFileSafe?: false\n  /**\n   * For Component Relay saving. Indicates if debouncer is enabled.\n   */\n  coallesedSaving?: false\n  /**\n   * For Component Relay saving. Indicates what the debouncer ms delay should be set to.\n   */\n  coallesedSavingDelay?: 250\n}\n\ntype OnEditorKeyUpParams = {\n  isSpace: boolean\n  isEnter: boolean\n}\n\ntype FileUuid = string\n\nexport default class EditorKitBase {\n  private fileIdsPendingAssociation: FileUuid[] = []\n  private componentRelay?: ComponentRelay\n  private fileLoader?: FileLoader\n  private textExpander?: TextExpander\n\n  private fileSafeLoading?: Promise<void>\n  private fileSafeClass?: any\n  private fileSafeInstance?: any\n\n  private note?: ItemMessagePayload\n  private ignoreNextTextChange?: boolean\n  private needsFileSafeElementLoad?: boolean\n  private previousText?: string\n\n  constructor(private delegate: EditorKitDelegate, private options: EditorKitOptions) {\n    this.connectToBridge()\n\n    if (this.options.supportsFileSafe) {\n      this.fileSafeLoading = this.importFileSafe()\n    }\n  }\n\n  private connectToBridge() {\n    const {\n      coallesedSaving,\n      coallesedSavingDelay,\n      mode,\n      supportsFileSafe\n    } = this.options\n\n    this.componentRelay = new ComponentRelay({\n      targetWindow: window,\n      options: {\n        coallesedSaving,\n        /**\n         * The editor does some debouncing for us, so we'll lower the\n         * default debounce value from 250 to 150\n         */\n        coallesedSavingDelay\n      },\n      onReady: () => {\n        const { platform } = this.componentRelay!\n\n        if (platform) {\n          document.documentElement.classList.add(platform)\n        }\n      },\n      onThemesChange: this.delegate.onThemesChange\n    })\n\n    this.componentRelay.streamContextItem(async (note: ItemMessagePayload) => {\n      /**\n       * TODO: If note has changed, release previous temp object URLs.\n       */\n      let isNewNoteLoad = true\n      if (this.note && this.note.uuid == note.uuid) {\n        isNewNoteLoad = false\n      }\n\n      const previousNote = this.note\n\n      if (supportsFileSafe) {\n        const itemClass = this.fileSafeClass.getSFItemClass()\n        this.note = new itemClass(note)\n        this.fileSafeInstance.setCurrentNote(this.note)\n      } else {\n        this.note = note\n      }\n\n       // Only update UI on non-metadata updates.\n      if (note.isMetadataUpdate) {\n        return\n      }\n\n      let text = note.content.text\n\n      /**\n       * If we're an HTML editor, and we're dealing with a new note,\n       * check to see if it's in html format.\n       * If it's not, we don't want to convert it to HTML until the user makes an explicit change\n       * so we'll ignore the next change event in this case.\n       */\n      if (mode === 'html' && isNewNoteLoad) {\n        const isHtml = /<[a-z][\\s\\S]*>/i.test(text)\n        if (!isHtml) {\n          this.ignoreNextTextChange = true\n        }\n      }\n\n      /**\n       * Set before expanding. \n       * We want this value to always be the collapsed value\n       */\n      this.previousText = text\n\n      if (supportsFileSafe) {\n        /**\n         * We want to expand any filesafe syntax in the text,\n         * but only after the text has been inserted.\n         * (Will be checked on editor change callback)\n         */\n        this.needsFileSafeElementLoad = true\n        text = expandedFileSafeSyntax(text)\n      }\n\n      this.delegate.onNoteValueChange && await this.delegate.onNoteValueChange(note)\n      this.delegate.setEditorRawText(text)\n\n      if (this.delegate.onNoteLockToggle) {\n        const previousLockState = this.componentRelay!.getItemAppDataValue(previousNote, 'locked') ?? false\n        const newLockState = this.componentRelay!.getItemAppDataValue(this.note, 'locked') ?? false\n\n        if (previousLockState !== newLockState) {\n          this.delegate.onNoteLockToggle(newLockState)\n        }\n      }\n\n      if (isNewNoteLoad) {\n        this.delegate.clearUndoHistory?.()\n      }\n    })\n  }\n\n  private async importFileSafe() {\n    try {\n      return import('filesafe-js').then((result) => {\n        this.fileSafeClass = result.default\n        this.configureFileSafe()\n        return this.fileSafeInstance\n      })\n    } catch (e) {\n      console.warn('[EditorKit] Could not import filesafe-js')\n    }\n  }\n\n  private configureFileSafe() {\n    const requiredDelegateFunctions = [\n      'getCurrentLineText',\n      'getPreviousLineText',\n      'replaceText',\n      'getElementsBySelector',\n      'insertElement',\n      'preprocessElement',\n      'insertRawText'\n    ]\n\n    for (const functionName of requiredDelegateFunctions) {\n      if (!this.delegate[functionName]) {\n        throw Error(`Missing ${functionName} delegate function.`)\n      }\n    }\n\n    this.fileSafeInstance = new this.fileSafeClass({\n      componentManager: this.componentRelay\n    })\n\n    this.fileSafeInstance.addDataChangeObserver(() => {\n      // Reload UI by querying FileSafe for changes...\n      const allFileDescriptors = this.fileSafeInstance.getAllFileDescriptors()\n\n      if (this.note && this.fileIdsPendingAssociation.length > 0) {\n        let hasMatch = false\n\n        for (const uuid of this.fileIdsPendingAssociation.slice()) {\n          const descriptor = allFileDescriptors.find((candidate: FileSafeFileMetadata) => candidate.uuid == uuid)\n\n          if (!descriptor) {\n            continue\n          }\n\n          hasMatch = true\n          this.fileIdsPendingAssociation.splice(this.fileIdsPendingAssociation.indexOf(uuid), 1)\n\n          const syntax = insertionSyntaxForFileDescriptor(descriptor)\n          this.delegate.insertRawText!(syntax)\n        }\n\n        if (hasMatch) {\n          this.textExpander!.searchPatterns()\n        }\n      }\n\n      if (allFileDescriptors.length > 0) {\n        this.fileLoader!.loadFileSafeElements()\n      }\n    })\n\n    this.fileSafeInstance.addNewFileDescriptorHandler((fileDescriptor: FileSafeFileMetadata) => {\n      /**\n       * Called when a new file is uploaded. We'll wait until the bridge acknowledges\n       * receipt of this item, and then it will be added to the editor.\n       */\n      this.fileIdsPendingAssociation.push(fileDescriptor.uuid)\n    })\n\n    this.fileLoader = new FileLoader({\n      fileSafeInstance: this.fileSafeInstance,\n      getElementsBySelector: this.delegate.getElementsBySelector!,\n      insertElement: this.delegate.insertElement!,\n      preprocessElement: this.delegate.preprocessElement!\n    })\n\n    this.textExpander = new TextExpander({\n      afterExpand: () => this.fileLoader!.loadFileSafeElements(),\n      getCurrentLineText: this.delegate.getCurrentLineText!,\n      getPreviousLineText: this.delegate.getPreviousLineText!,\n      replaceText: this.delegate.replaceText!,\n      patterns: [{\n        regex: FileSafeSyntaxPattern,\n        callback: (matchedText) => {\n          return expandedFileSafeSyntax(matchedText)\n        }\n      }]\n    })\n  }\n\n  /**\n   * Gets the FileSafe class.\n   * @returns FileSafe class.\n   */\n  public async getFileSafe(): Promise<void> {\n    if (!this.fileSafeInstance && this.fileSafeLoading) {\n      return this.fileSafeLoading\n    }\n    return this.importFileSafe()\n  }\n\n  /**\n   * Called by consumer when the editor has a keyup event.\n   */\n  public onEditorKeyUp({ isSpace, isEnter }: OnEditorKeyUpParams): void {\n    this.textExpander!.onKeyUp({\n       isSpace,\n       isEnter\n    })\n  }\n\n  /**\n   * Called by consumer when user pastes into editor.\n   */\n  public onEditorPaste(): void {\n    this.textExpander!.onKeyUp({\n      isPaste: true\n    })\n  }\n\n  /**\n   * Called by consumer when the editor has a change/input event.\n   */\n  public onEditorValueChanged(text: string): void {\n    const { mode, supportsFileSafe } = this.options\n\n    if (this.needsFileSafeElementLoad) {\n      this.needsFileSafeElementLoad = false\n      this.fileLoader!.loadFileSafeElements()\n    }\n\n    if (this.ignoreNextTextChange) {\n      this.ignoreNextTextChange = false\n      return\n    }\n\n    if (supportsFileSafe) {\n      text = collapseFileSafeSyntax(text)\n\n      /**\n       * Change events may be triggered several times when expanding filesafe syntax.\n       * Ultimately, while the visual layer is changing a lot, the underlying text layer,\n       * after being collapsed, will not change. So we'll compare the previous html to new collapsed html before continuing.\n       */\n      const sameText = this.previousText == text\n      if (sameText) {\n        return\n      }\n    }\n\n    this.previousText = text\n\n    if (!this.note) {\n      return\n    }\n\n    const note = this.note\n\n    this.componentRelay!.saveItemWithPresave(note, () => {\n      note.content.text = text\n\n      if (this.delegate.generateCustomPreview) {\n        const result = this.delegate.generateCustomPreview(text)\n\n        note.content.preview_plain = result.plain ?? ' '\n        note.content.preview_html = result.html\n      } else {\n        if (mode === 'html') {\n          let preview = removeFileSafeSyntaxFromHtml(text)\n          preview = truncateString(htmlToText(preview))\n          /**\n           * If the preview has no length due to either being an empty note, or having just 1 FileSafe file\n           * that is stripped above, then we don't want to set to empty string, otherwise SN app will default to content\n           * for preview. We'll set a whitespace preview instead so SN doesn't go based on innate content.\n           */\n          note.content.preview_plain = preview.length > 0 ? preview : ' '\n        } else {\n          note.content.preview_plain = text\n        }\n\n        // We're only using plain in this block.\n        note.content.preview_html = null\n      }\n    })\n  }\n\n  /**\n   * Whether or not FileSafe is configured with integrations and keys, and can handle file uploads.\n   * If not, user should open files modal and configure FileSafe.\n   */\n  public canUploadFiles(): boolean {\n    const credentials = this.fileSafeInstance.getAllCredentials()\n    const integrations = this.fileSafeInstance.getAllIntegrations()\n    return credentials.length > 0 && integrations.length > 0\n  }\n\n  /**\n   * Encrypts and Uploads a Javascript file object to FileSafe.\n   * @param file The file to upload.\n   * @returns A file descriptor if successful.\n   */\n  public async uploadJSFileObject(file: Blob): Promise<void> {\n    const cursorIdentifier = this.fileLoader!.insertStatusAtCursor('Processing file...')\n    return this.fileSafeInstance.encryptAndUploadJavaScriptFileObject(file).then(() => {\n      this.fileLoader!.removeCursorStatus(cursorIdentifier)\n    })\n  }\n\n  /**\n   * saveItemWithPresave from the component relay.\n   */\n  public saveItemWithPresave(note: ItemMessagePayload, presave?: () => void): void {\n    this.componentRelay!.saveItemWithPresave(note, presave)\n  }\n\n  /**\n   * Gets the current platform where the component is running.\n   */\n   public get platform(): string | undefined {\n    return this.componentRelay!.platform\n  }\n\n  /**\n   * Gets the current environment where the component is running.\n   */\n  public get environment(): string | undefined {\n    return this.componentRelay!.environment\n  }\n\n  /**\n   * Whether or not FileSafe can be used.\n   */\n  public canUseFileSafe(): boolean {\n    return this.fileSafeInstance.hasLegacyAccess()\n  }\n\n  public getComponentDataValueForKey(key: string): any {\n    return this.componentRelay!.getComponentDataValueForKey(key)\n  }\n\n  public setComponentDataValueForKey(key: string, value: any): void {\n    this.componentRelay!.setComponentDataValueForKey(key, value)\n  }\n\n  public isRunningInMobileApplication(): boolean {\n    return this.componentRelay!.isRunningInMobileApplication()\n  }\n}\n"],"sourceRoot":""}