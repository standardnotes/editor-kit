{"version":3,"file":"editor-kit.js","mappings":"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","sources":["webpack://EditorKit/webpack/universalModuleDefinition","webpack://EditorKit/./node_modules/@standardnotes/component-relay/dist/dist.js","webpack://EditorKit/webpack/bootstrap","webpack://EditorKit/webpack/runtime/compat get default export","webpack://EditorKit/webpack/runtime/define property getters","webpack://EditorKit/webpack/runtime/hasOwnProperty shorthand","webpack://EditorKit/./src/Utils.ts","webpack://EditorKit/./src/EditorKit.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"EditorKit\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"EditorKit\"] = factory();\n\telse\n\t\troot[\"EditorKit\"] = factory();\n})(self, () => {\nreturn ","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(\"ComponentRelay\",[],t):\"object\"==typeof exports?exports.ComponentRelay=t():e.ComponentRelay=t()}(self,(()=>(()=>{\"use strict\";var e={d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};let n;var s;e.d(t,{default:()=>w}),function(e){e[e.Web=1]=\"Web\",e[e.Desktop=2]=\"Desktop\",e[e.Mobile=3]=\"Mobile\"}(n||(n={}));var i=new Uint8Array(16);function o(){if(!s&&!(s=\"undefined\"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||\"undefined\"!=typeof msCrypto&&\"function\"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error(\"crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported\");return s(i)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(e){return\"string\"==typeof e&&a.test(e)};for(var m=[],c=0;c<256;++c)m.push((c+256).toString(16).substr(1));const h=function(e,t,n){var s=(e=e||{}).random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=s[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+\"-\"+m[e[t+4]]+m[e[t+5]]+\"-\"+m[e[t+6]]+m[e[t+7]]+\"-\"+m[e[t+8]]+m[e[t+9]]+\"-\"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase();if(!r(n))throw TypeError(\"Stringified UUID is invalid\");return n}(s)},d=e=>{var t;const s={[n.Web]:\"web\",[n.Desktop]:\"desktop\",[n.Mobile]:\"mobile\"};return null!==(t=s[e])&&void 0!==t?t:s[n.Web]},p=()=>{};class l{static get isSupported(){return!(!window.console&&!console)}static get info(){return l.isSupported&&this.enabled?console.log.bind(console):p}static get error(){return l.isSupported?console.error.bind(console):p}}var u,v;let g,f,y;function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(v=\"enabled\")in(u=l)?Object.defineProperty(u,v,{value:false,enumerable:!0,configurable:!0,writable:!0}):u[v]=false,function(e){e.Shift=\"Shift\",e.Ctrl=\"Control\",e.Meta=\"Meta\"}(g||(g={})),function(e){e.Component=\"component\"}(f||(f={})),function(e){e.SetSize=\"set-size\",e.StreamItems=\"stream-items\",e.StreamContextItem=\"stream-context-item\",e.SaveItems=\"save-items\",e.CreateItem=\"create-item\",e.CreateItems=\"create-items\",e.DeleteItems=\"delete-items\",e.SetComponentData=\"set-component-data\",e.RequestPermissions=\"request-permissions\",e.DuplicateItem=\"duplicate-item\",e.ComponentRegistered=\"component-registered\",e.ActivateThemes=\"themes\",e.Reply=\"reply\",e.ThemesActivated=\"themes-activated\",e.KeyDown=\"key-down\",e.KeyUp=\"key-up\",e.Click=\"click\"}(y||(y={}));class w{constructor(e){var t,n;if(k(this,\"contentWindow\",void 0),k(this,\"component\",{activeThemes:[],acceptsThemes:!0}),k(this,\"sentMessages\",[]),k(this,\"messageQueue\",[]),k(this,\"lastStreamedItem\",void 0),k(this,\"pendingSaveItems\",void 0),k(this,\"pendingSaveTimeout\",void 0),k(this,\"pendingSaveParams\",void 0),k(this,\"messageHandler\",void 0),k(this,\"keyDownEventListener\",void 0),k(this,\"keyUpEventListener\",void 0),k(this,\"clickEventListener\",void 0),k(this,\"concernTimeouts\",[]),k(this,\"options\",void 0),k(this,\"params\",void 0),!e||!e.targetWindow)throw new Error(\"contentWindow must be a valid Window object.\");this.params=e,this.options=e.options||{},null==this.options.coallesedSaving&&(this.options.coallesedSaving=!0),null==this.options.coallesedSavingDelay&&(this.options.coallesedSavingDelay=250),null!=this.options.acceptsThemes&&(this.component.acceptsThemes=null===(n=this.options.acceptsThemes)||void 0===n||n),l.enabled=null!==(t=this.options.debug)&&void 0!==t&&t,this.contentWindow=e.targetWindow,this.registerMessageHandler(),this.registerKeyboardEventListeners(),this.registerMouseEventListeners()}deinit(){this.params.onReady=void 0,this.component={acceptsThemes:!0,activeThemes:[]},this.messageQueue=[],this.sentMessages=[],this.lastStreamedItem=void 0,this.pendingSaveItems=void 0,this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0,this.messageHandler&&(this.contentWindow.document.removeEventListener(\"message\",this.messageHandler),this.contentWindow.removeEventListener(\"message\",this.messageHandler)),this.keyDownEventListener&&this.contentWindow.removeEventListener(\"keydown\",this.keyDownEventListener),this.keyUpEventListener&&this.contentWindow.removeEventListener(\"keyup\",this.keyUpEventListener),this.clickEventListener&&this.contentWindow.removeEventListener(\"click\",this.clickEventListener)}registerMessageHandler(){this.messageHandler=e=>{if(l.info(\"Components API Message received:\",e.data),document.referrer&&new URL(document.referrer).origin!==new URL(e.origin).origin)return;const{data:t}=e,n=(e=>{if(\"string\"!=typeof e)return!1;try{const t=JSON.parse(e),n=Object.prototype.toString.call(t);return\"[object Object]\"===n||\"[object Array]\"===n}catch(e){return!1}})(t)?JSON.parse(t):t;if(n){if(void 0===this.component.origin&&n.action===y.ComponentRegistered)this.component.origin=e.origin;else if(e.origin!==this.component.origin)return;this.handleMessage(n)}else l.error(\"Invalid data received. Skipping...\")},this.contentWindow.document.addEventListener(\"message\",this.messageHandler,!1),this.contentWindow.addEventListener(\"message\",this.messageHandler,!1),l.info(\"Waiting for messages...\")}registerKeyboardEventListeners(){this.keyDownEventListener=e=>{l.info(\"A key has been pressed: \".concat(e.key)),e.ctrlKey?this.keyDownEvent(g.Ctrl):e.shiftKey?this.keyDownEvent(g.Shift):(e.metaKey||\"Meta\"===e.key)&&this.keyDownEvent(g.Meta)},this.keyUpEventListener=e=>{l.info(\"A key has been released: \".concat(e.key)),\"Control\"===e.key?this.keyUpEvent(g.Ctrl):\"Shift\"===e.key?this.keyUpEvent(g.Shift):\"Meta\"===e.key&&this.keyUpEvent(g.Meta)},this.contentWindow.addEventListener(\"keydown\",this.keyDownEventListener,!1),this.contentWindow.addEventListener(\"keyup\",this.keyUpEventListener,!1)}registerMouseEventListeners(){this.clickEventListener=e=>{l.info(\"A click has been performed.\"),this.mouseClickEvent()},this.contentWindow.addEventListener(\"click\",this.clickEventListener,!1)}handleMessage(e){switch(e.action){case y.ComponentRegistered:this.component.sessionKey=e.sessionKey,e.componentData&&(this.component.data=e.componentData),this.onReady(e.data),l.info(\"Component successfully registered with payload:\",e);break;case y.ActivateThemes:this.activateThemes(e.data.themes);break;default:{var t,n;if(!e.original)return;const s=null===(t=this.sentMessages)||void 0===t?void 0:t.filter((t=>{var n;return t.messageId===(null===(n=e.original)||void 0===n?void 0:n.messageId)}))[0];if(!s){const e=this.contentWindow.document.title,t=(\"The extension '\".concat(e,\"' is attempting to communicate with Standard Notes, \")+\"but an error is preventing it from doing so. Please restart this extension and try again.\").replace(\"  \",\" \");return void l.info(t)}null==s||null===(n=s.callback)||void 0===n||n.call(s,e.data);break}}}onReady(e){this.component.environment=e.environment,this.component.platform=e.platform,this.component.uuid=e.uuid;for(const e of this.messageQueue)this.postMessage(e.action,e.data,e.callback);this.messageQueue=[],l.info(\"Data passed to onReady:\",e),this.activateThemes(e.activeThemeUrls||[]),this.postMessage(y.ThemesActivated,{}),this.params.onReady&&this.params.onReady()}getSelfComponentUUID(){return this.component.uuid}isRunningInDesktopApplication(){return this.component.environment===d(n.Desktop)}isRunningInMobileApplication(){return this.component.environment===d(n.Mobile)}getComponentDataValueForKey(e){if(this.component.data)return this.component.data[e]}setComponentDataValueForKey(e,t){if(!this.component.data)throw new Error(\"The component has not been initialized.\");if(!e||e&&0===e.length)throw new Error(\"The key for the data value should be a valid string.\");this.component.data=S(S({},this.component.data),{},{[e]:t}),this.postMessage(y.SetComponentData,{componentData:this.component.data})}clearComponentData(){this.component.data={},this.postMessage(y.SetComponentData,{componentData:this.component.data})}postMessage(e,t,n){if(!this.component.sessionKey)return void this.messageQueue.push({action:e,data:t,api:f.Component,callback:n});e===y.SaveItems&&(t.height=this.params.handleRequestForContentHeight());const s={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.component.sessionKey,api:f.Component},i=JSON.parse(JSON.stringify(s));let o;i.callback=n,this.sentMessages.push(i),o=this.isRunningInMobileApplication()?JSON.stringify(s):s,l.info(\"Posting message:\",o),this.contentWindow.parent.postMessage(o,this.component.origin)}activateThemes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.component.acceptsThemes)return;l.info(\"Incoming themes:\",e);const{activeThemes:t}=this.component;if(t&&t.sort().toString()==e.sort().toString())return;let n=e;const s=[];for(const i of t)e.includes(i)?n=n.filter((e=>e!==i)):s.push(i);l.info(\"Deactivating themes:\",s),l.info(\"Activating themes:\",n);for(const e of s)this.deactivateTheme(e);this.component.activeThemes=e;for(const e of n){if(!e)continue;const t=this.contentWindow.document.createElement(\"link\");t.id=btoa(e),t.href=e,t.type=\"text/css\",t.rel=\"stylesheet\",t.media=\"screen,print\",t.className=\"custom-theme\",this.contentWindow.document.getElementsByTagName(\"head\")[0].appendChild(t)}this.params.onThemesChange&&this.params.onThemesChange()}themeElementForUrl(e){return Array.from(this.contentWindow.document.getElementsByClassName(\"custom-theme\")).slice().find((t=>t.id==btoa(e)))}deactivateTheme(e){const t=this.themeElementForUrl(e);t&&t.parentNode&&(t.setAttribute(\"disabled\",\"true\"),t.parentNode.removeChild(t))}generateUUID(){return h()}get platform(){return this.component.platform}get environment(){return this.component.environment}streamItems(e,t){this.postMessage(y.StreamItems,{content_types:e},(e=>{t(e.items)}))}streamContextItem(e){this.postMessage(y.StreamContextItem,{},(t=>{const{item:n}=t;(!this.lastStreamedItem||this.lastStreamedItem.uuid!==n.uuid)&&this.pendingSaveTimeout&&(clearTimeout(this.pendingSaveTimeout),this.performSavingOfItems(this.pendingSaveParams),this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0),this.lastStreamedItem=n,e(this.lastStreamedItem)}))}createItem(e,t){this.postMessage(y.CreateItem,{item:this.jsonObjectForItem(e)},(e=>{let{item:n}=e;!n&&e.items&&e.items.length>0&&(n=e.items[0]),t&&t(n)}))}createItems(e,t){const n=e.map((e=>this.jsonObjectForItem(e)));this.postMessage(y.CreateItems,{items:n},(e=>{t&&t(e.items)}))}deleteItem(e,t){this.deleteItems([e],t)}deleteItems(e,t){const n={items:e.map((e=>this.jsonObjectForItem(e)))};this.postMessage(y.DeleteItems,n,(e=>{t&&t(e)}))}sendCustomEvent(e,t,n){this.postMessage(e,t,(e=>{n&&n(e)}))}saveItem(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,n)}saveItemWithPresave(e,t,n){this.saveItemsWithPresave([e],t,n)}saveItemsWithPresave(e,t,n){this.saveItems(e,n,!1,t)}performSavingOfItems(e){let{items:t,presave:n,callback:s}=e;const i=setTimeout((()=>{this.concernTimeouts.forEach((e=>clearTimeout(e))),alert(\"This editor is unable to communicate with Standard Notes. Your changes may not be saved. Please backup your changes, then restart the application and try again.\")}),5e3);this.concernTimeouts.push(i),n&&n();const o=[];for(const e of t)o.push(this.jsonObjectForItem(e));this.postMessage(y.SaveItems,{items:o},(()=>{this.concernTimeouts.forEach((e=>clearTimeout(e))),null==s||s()}))}saveItems(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;if(this.pendingSaveItems||(this.pendingSaveItems=[]),this.options.coallesedSaving&&!n){this.pendingSaveTimeout&&clearTimeout(this.pendingSaveTimeout);const n=e.map((e=>e.uuid)),i=this.pendingSaveItems.filter((e=>!n.includes(e.uuid)));this.pendingSaveItems=i.concat(e),this.pendingSaveParams={items:this.pendingSaveItems,presave:s,callback:t},this.pendingSaveTimeout=setTimeout((()=>{this.performSavingOfItems(this.pendingSaveParams),this.pendingSaveItems=[],this.pendingSaveTimeout=void 0,this.pendingSaveParams=null}),this.options.coallesedSavingDelay)}else this.performSavingOfItems({items:e,presave:s,callback:t})}setSize(e,t){this.postMessage(y.SetSize,{type:\"container\",width:e,height:t})}keyDownEvent(e){this.postMessage(y.KeyDown,{keyboardModifier:e})}keyUpEvent(e){this.postMessage(y.KeyUp,{keyboardModifier:e})}mouseClickEvent(){this.postMessage(y.Click,{})}jsonObjectForItem(e){const t=Object.assign({},e);return t.children=null,t.parent=null,t}getItemAppDataValue(e,t){var n,s;const i=null==e||null===(n=e.content)||void 0===n||null===(s=n.appData)||void 0===s?void 0:s[\"org.standardnotes.sn\"];return null==i?void 0:i[t]}}return t.default})()));\n//# sourceMappingURL=dist.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","export const htmlToText = (html: string): string => {\n  const tmpDocument = document.implementation.createHTMLDocument().body\n  tmpDocument.innerHTML = html\n  return tmpDocument.textContent || tmpDocument.innerText || ''\n}\n\nexport const truncateString = (text: string, limit = 90): string => {\n  if (text.length <= limit) {\n    return text\n  }\n  return text.substring(0, limit) + '...'\n}\n\nexport const sleep = async (seconds: number): Promise<void> => {\n  await new Promise((resolve) => setTimeout(resolve, seconds * 1000))\n}\n","import ComponentRelay from '@standardnotes/component-relay'\nimport { truncateString, htmlToText } from './Utils'\nimport type { OutgoingItemMessagePayload, NoteContent, DecryptedTransferPayload } from '@standardnotes/models'\nimport { AppDataField } from '@standardnotes/models'\nimport { EditorKitDelegate } from './EditorKitDelegate'\nimport { EditorKitOptions } from './EditorKitOptions'\n\ntype NoteMessagePayload = DecryptedTransferPayload<NoteContent> & OutgoingItemMessagePayload<NoteContent>\n\nexport default class EditorKit {\n  private componentRelay?: ComponentRelay\n  private note?: NoteMessagePayload\n  private ignoreNextTextChange?: boolean\n\n  constructor(private delegate: EditorKitDelegate, private options: EditorKitOptions) {\n    this.connectToBridge()\n  }\n\n  private connectToBridge() {\n    const { coallesedSaving, coallesedSavingDelay, mode } = this.options\n\n    this.componentRelay = new ComponentRelay({\n      targetWindow: window,\n      options: {\n        coallesedSaving,\n        /**\n         * The editor does some debouncing for us, so we'll lower the\n         * default debounce value from 250 to 150\n         */\n        coallesedSavingDelay,\n      },\n      onReady: () => {\n        const { platform } = this.componentRelay!\n\n        if (platform) {\n          document.documentElement.classList.add(platform)\n        }\n      },\n      onThemesChange: this.delegate.onThemesChange,\n      handleRequestForContentHeight: () => {\n        return this.delegate.handleRequestForContentHeight()\n      },\n    })\n\n    this.componentRelay.streamContextItem(async (note: NoteMessagePayload) => {\n      /**\n       * TODO: If note has changed, release previous temp object URLs.\n       */\n      let isNewNoteLoad = true\n      if (this.note && this.note.uuid == note.uuid) {\n        isNewNoteLoad = false\n      }\n\n      const previousNote = this.note\n\n      this.note = note\n\n      // Only update UI on non-metadata updates.\n      if (note.isMetadataUpdate) {\n        return\n      }\n\n      const text = note.content?.text || ''\n\n      /**\n       * If we're an HTML editor, and we're dealing with a new note,\n       * check to see if it's in html format.\n       * If it's not, we don't want to convert it to HTML until the user makes an explicit change\n       * so we'll ignore the next change event in this case.\n       */\n      if (mode === 'html' && isNewNoteLoad) {\n        const isHtml = /<[a-z][\\s\\S]*>/i.test(text)\n        if (!isHtml) {\n          this.ignoreNextTextChange = true\n        }\n      }\n\n      this.delegate.onNoteValueChange && (await this.delegate.onNoteValueChange(note))\n      this.delegate.setEditorRawText(text)\n\n      if (this.delegate.onNoteLockToggle) {\n        const previousLockState = this.componentRelay!.getItemAppDataValue(previousNote, 'locked') ?? false\n        const newLockState = this.componentRelay!.getItemAppDataValue(this.note, 'locked') ?? false\n\n        if (previousLockState !== newLockState) {\n          this.delegate.onNoteLockToggle(newLockState)\n        }\n      }\n\n      if (isNewNoteLoad) {\n        this.delegate.clearUndoHistory?.()\n      }\n    })\n  }\n\n  private configureFileSafe() {\n    const requiredDelegateFunctions = [\n      'getCurrentLineText',\n      'getPreviousLineText',\n      'replaceText',\n      'getElementsBySelector',\n      'insertElement',\n      'preprocessElement',\n      'insertRawText',\n    ]\n\n    for (const functionName of requiredDelegateFunctions) {\n      if (!this.delegate[functionName]) {\n        throw Error(`Missing ${functionName} delegate function.`)\n      }\n    }\n  }\n\n  /**\n   * Called by consumer when the editor has a change/input event.\n   */\n  public onEditorValueChanged(text: string): void {\n    const { mode } = this.options\n\n    if (this.ignoreNextTextChange) {\n      this.ignoreNextTextChange = false\n      return\n    }\n\n    if (!this.note) {\n      return\n    }\n\n    const note = this.note\n\n    this.componentRelay!.saveItemWithPresave<NoteContent>(note, () => {\n      note.content!.text = text\n\n      if (this.delegate.generateCustomPreview) {\n        const result = this.delegate.generateCustomPreview(text)\n\n        note.content.preview_plain = result.plain ?? ' '\n        note.content.preview_html = result.html\n      } else {\n        if (mode === 'html') {\n          let preview = text\n          preview = truncateString(htmlToText(preview))\n          /**\n           * If the preview has no length due to either being an empty note, or having just 1 FileSafe file\n           * that is stripped above, then we don't want to set to empty string, otherwise SN app will default to content\n           * for preview. We'll set a whitespace preview instead so SN doesn't go based on innate content.\n           */\n          note.content.preview_plain = preview.length > 0 ? preview : ' '\n        } else {\n          note.content.preview_plain = text\n        }\n\n        // We're only using plain in this block.\n        note.content.preview_html = undefined\n      }\n    })\n  }\n\n  /**\n   * saveItemWithPresave from the component relay.\n   */\n  public saveItemWithPresave(note: NoteMessagePayload, presave?: () => void): void {\n    this.componentRelay!.saveItemWithPresave(note, presave)\n  }\n\n  /**\n   * Gets the current platform where the component is running.\n   */\n  public get platform(): string | undefined {\n    return this.componentRelay!.platform\n  }\n\n  /**\n   * Gets the current environment where the component is running.\n   */\n  public get environment(): string | undefined {\n    return this.componentRelay!.environment\n  }\n\n  public getComponentDataValueForKey(key: string): any {\n    return this.componentRelay!.getComponentDataValueForKey(key)\n  }\n\n  public setComponentDataValueForKey(key: string, value: any): void {\n    this.componentRelay!.setComponentDataValueForKey(key, value)\n  }\n\n  public isRunningInMobileApplication(): boolean {\n    return this.componentRelay!.isRunningInMobileApplication()\n  }\n\n  public getItemAppDataValue(key: AppDataField): any {\n    return this.note && this.componentRelay!.getItemAppDataValue(this.note, key)\n  }\n}\n"],"names":["htmlToText","html","tmpDocument","document","implementation","createHTMLDocument","body","innerHTML","textContent","innerText","truncateString","text","limit","length","substring","sleep","seconds","Promise","resolve","setTimeout","ComponentRelay","EditorKit","constructor","delegate","options","connectToBridge","coallesedSaving","coallesedSavingDelay","mode","componentRelay","targetWindow","window","onReady","platform","documentElement","classList","add","onThemesChange","handleRequestForContentHeight","streamContextItem","note","isNewNoteLoad","uuid","previousNote","isMetadataUpdate","content","isHtml","test","ignoreNextTextChange","onNoteValueChange","setEditorRawText","onNoteLockToggle","previousLockState","getItemAppDataValue","newLockState","clearUndoHistory","configureFileSafe","requiredDelegateFunctions","functionName","Error","onEditorValueChanged","saveItemWithPresave","generateCustomPreview","result","preview_plain","plain","preview_html","preview","undefined","presave","environment","getComponentDataValueForKey","key","setComponentDataValueForKey","value","isRunningInMobileApplication"],"sourceRoot":""}